function _extends(){return _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},_extends.apply(this,arguments)}var KEYCODE_ENTER=13,KEYCODE_TAB=9,KEYCODE_BACKSPACE=8,KEYCODE_Y=89,KEYCODE_Z=90,KEYCODE_M=77,KEYCODE_PARENS=57,KEYCODE_BRACKETS=219,KEYCODE_QUOTE=222,KEYCODE_BACK_QUOTE=192,KEYCODE_ESCAPE=27,HISTORY_LIMIT=100,HISTORY_TIME_GAP=3e3,isWindows="undefined"!=typeof window&&navigator&&/Win/i.test(navigator.platform),isMacLike="undefined"!=typeof window&&navigator&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),PrismEditor=Vue.defineComponent({props:{lineNumbers:{type:Boolean,default:!1},autoStyleLineNumbers:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1},modelValue:{type:String,default:""},highlight:{type:Function,required:!0},tabSize:{type:Number,default:2},insertSpaces:{type:Boolean,default:!0},ignoreTabKey:{type:Boolean,default:!1},placeholder:{type:String,default:""}},data:function(){return{capture:!0,history:{stack:[],offset:-1},lineNumbersHeight:"20px",codeData:""}},watch:{modelValue:{immediate:!0,handler:function(t){this.codeData=t||""}},content:{immediate:!0,handler:function(){var t=this;this.lineNumbers&&this.$nextTick((function(){t.setLineNumbersHeight()}))}},lineNumbers:function(){var t=this;this.$nextTick((function(){t.styleLineNumbers(),t.setLineNumbersHeight()}))}},computed:{isEmpty:function(){return 0===this.codeData.length},content:function(){return this.highlight(this.codeData)+"<br />"},lineNumbersCount:function(){return this.codeData.split(/\r\n|\n/).length}},mounted:function(){this._recordCurrentState(),this.styleLineNumbers()},methods:{setLineNumbersHeight:function(){this.lineNumbersHeight=getComputedStyle(this.$refs.pre).height},styleLineNumbers:function(){if(this.lineNumbers&&this.autoStyleLineNumbers){var t=this.$refs.pre,e=this.$el.querySelector(".prism-editor__line-numbers"),i=window.getComputedStyle(t);this.$nextTick((function(){var s="border-top-left-radius",n="border-bottom-left-radius";if(e){e.style[s]=i[s],e.style[n]=i[n],t.style[s]="0",t.style[n]="0";["background-color","margin-top","padding-top","font-family","font-size","line-height"].forEach((function(t){e.style[t]=i[t]})),e.style["margin-bottom"]="-"+i["padding-top"]}}))}},_recordCurrentState:function(){var t=this.$refs.textarea;if(t){var e=t.value,i=t.selectionStart,s=t.selectionEnd;this._recordChange({value:e,selectionStart:i,selectionEnd:s})}},_getLines:function(t,e){return t.substring(0,e).split("\n")},_applyEdits:function(t){var e=this.$refs.textarea,i=this.history.stack[this.history.offset];i&&e&&(this.history.stack[this.history.offset]=_extends({},i,{selectionStart:e.selectionStart,selectionEnd:e.selectionEnd})),this._recordChange(t),this._updateInput(t)},_recordChange:function(t,e){void 0===e&&(e=!1);var i=this.history,s=i.stack,n=i.offset;if(s.length&&n>-1){this.history.stack=s.slice(0,n+1);var r=this.history.stack.length;if(r>HISTORY_LIMIT){var a=r-HISTORY_LIMIT;this.history.stack=s.slice(a,r),this.history.offset=Math.max(this.history.offset-a,0)}}var o=Date.now();if(e){var l=this.history.stack[this.history.offset];if(l&&o-l.timestamp<HISTORY_TIME_GAP){var h,u,d=/[^a-z0-9]([a-z0-9]+)$/i,c=null===(h=this._getLines(l.value,l.selectionStart).pop())||void 0===h?void 0:h.match(d),f=null===(u=this._getLines(t.value,t.selectionStart).pop())||void 0===u?void 0:u.match(d);if(c&&f&&f[1].startsWith(c[1]))return void(this.history.stack[this.history.offset]=_extends({},t,{timestamp:o}))}}this.history.stack.push(_extends({},t,{timestamp:o})),this.history.offset++},_updateInput:function(t){var e=this.$refs.textarea;e&&(e.value=t.value,e.selectionStart=t.selectionStart,e.selectionEnd=t.selectionEnd,this.$emit("update:modelValue",t.value))},handleChange:function(t){var e=t.target,i=e.value,s=e.selectionStart,n=e.selectionEnd;this._recordChange({value:i,selectionStart:s,selectionEnd:n},!0),this.$emit("update:modelValue",i)},_undoEdit:function(){var t=this.history,e=t.stack,i=t.offset,s=e[i-1];s&&(this._updateInput(s),this.history.offset=Math.max(i-1,0))},_redoEdit:function(){var t=this.history,e=t.stack,i=t.offset,s=e[i+1];s&&(this._updateInput(s),this.history.offset=Math.min(i+1,e.length-1))},handleKeyDown:function(t){var e=this.tabSize,i=this.insertSpaces,s=this.ignoreTabKey;if(this.$emit("keydown",t),!t.defaultPrevented){t.keyCode===KEYCODE_ESCAPE&&(t.target.blur(),this.$emit("blur",t));var n=t.target,r=n.value,a=n.selectionStart,o=n.selectionEnd,l=(i?" ":"\t").repeat(e);if(t.keyCode===KEYCODE_TAB&&!s&&this.capture)if(t.preventDefault(),t.shiftKey){var h=this._getLines(r,a),u=h.length-1,d=this._getLines(r,o).length-1,c=r.split("\n").map((function(t,e){return e>=u&&e<=d&&t.startsWith(l)?t.substring(l.length):t})).join("\n");if(r!==c){var f=h[u];this._applyEdits({value:c,selectionStart:f.startsWith(l)?a-l.length:a,selectionEnd:o-(r.length-c.length)})}}else if(a!==o){var p=this._getLines(r,a),E=p.length-1,y=this._getLines(r,o).length-1,_=p[E];this._applyEdits({value:r.split("\n").map((function(t,e){return e>=E&&e<=y?l+t:t})).join("\n"),selectionStart:/\S/.test(_)?a+l.length:a,selectionEnd:o+l.length*(y-E+1)})}else{var m=a+l.length;this._applyEdits({value:r.substring(0,a)+l+r.substring(o),selectionStart:m,selectionEnd:m})}else if(t.keyCode===KEYCODE_BACKSPACE){var g=a!==o;if(r.substring(0,a).endsWith(l)&&!g){t.preventDefault();var v=a-l.length;this._applyEdits({value:r.substring(0,a-l.length)+r.substring(o),selectionStart:v,selectionEnd:v})}}else if(t.keyCode===KEYCODE_ENTER){if(a===o){var C=this._getLines(r,a).pop(),K=null==C?void 0:C.match(/^\s+/);if(K&&K[0]){t.preventDefault();var b="\n"+K[0],S=a+b.length;this._applyEdits({value:r.substring(0,a)+b+r.substring(o),selectionStart:S,selectionEnd:S})}}}else if(t.keyCode===KEYCODE_PARENS||t.keyCode===KEYCODE_BRACKETS||t.keyCode===KEYCODE_QUOTE||t.keyCode===KEYCODE_BACK_QUOTE){var k;t.keyCode===KEYCODE_PARENS&&t.shiftKey?k=["(",")"]:t.keyCode===KEYCODE_BRACKETS?k=t.shiftKey?["{","}"]:["[","]"]:t.keyCode===KEYCODE_QUOTE?k=t.shiftKey?['"','"']:["'","'"]:t.keyCode!==KEYCODE_BACK_QUOTE||t.shiftKey||(k=["`","`"]),a!==o&&k&&(t.preventDefault(),this._applyEdits({value:r.substring(0,a)+k[0]+r.substring(a,o)+k[1]+r.substring(o),selectionStart:a,selectionEnd:o+2}))}else!(isMacLike?t.metaKey&&t.keyCode===KEYCODE_Z:t.ctrlKey&&t.keyCode===KEYCODE_Z)||t.shiftKey||t.altKey?(isMacLike?t.metaKey&&t.keyCode===KEYCODE_Z&&t.shiftKey:isWindows?t.ctrlKey&&t.keyCode===KEYCODE_Y:t.ctrlKey&&t.keyCode===KEYCODE_Z&&t.shiftKey)&&!t.altKey?(t.preventDefault(),this._redoEdit()):t.keyCode!==KEYCODE_M||!t.ctrlKey||isMacLike&&!t.shiftKey||(t.preventDefault(),this.capture=!this.capture):(t.preventDefault(),this._undoEdit())}}},render:function(){var t=this,e=h("div",{class:"prism-editor__line-width-calc",style:"height: 0px; visibility: hidden; pointer-events: none;"},"999"),i=h("div",{class:"prism-editor__line-numbers",style:{"min-height":this.lineNumbersHeight},"aria-hidden":"true"},[e,Array.from(Array(this.lineNumbersCount).keys()).map((function(t,e){return h("div",{class:"prism-editor__line-number token comment"},""+ ++e)}))]),s=h("textarea",{ref:"textarea",onInput:this.handleChange,onKeydown:this.handleKeyDown,onClick:function(e){t.$emit("click",e)},onKeyup:function(e){t.$emit("keyup",e)},onFocus:function(e){t.$emit("focus",e)},onBlur:function(e){t.$emit("blur",e)},class:{"prism-editor__textarea":!0,"prism-editor__textarea--empty":this.isEmpty},spellCheck:"false",autocapitalize:"off",autocomplete:"off",autocorrect:"off","data-gramm":"false",placeholder:this.placeholder,"data-testid":"textarea",readonly:this.readonly,value:this.codeData}),n=h("pre",{ref:"pre",class:"prism-editor__editor","data-testid":"preview",innerHTML:this.content}),r=h("div",{class:"prism-editor__container"},[s,n]);return h("div",{class:"prism-editor-wrapper"},[this.lineNumbers&&i,r])}});export { PrismEditor };

