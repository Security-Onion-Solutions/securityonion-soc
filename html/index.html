<!doctype html>
<!--
// Copyright 2019 Jason Ertel (github.com/jertel).
// Copyright 2020-2023 Security Onion Solutions LLC and/or licensed to Security Onion Solutions LLC under one
// or more contributor license agreements. Licensed under the Elastic License 2.0 as shown at
// https://securityonion.net/license; you may not use this file except in compliance with the
// Elastic License 2.0.
-->

<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="mask-icon" href="images/favicon/onion.svg?v=VERSION_PLACEHOLDER">
    <link rel="alternate icon" class="so-favicon" type="image/png" href="images/favicon/onion.png?v=VERSION_PLACEHOLDER">
    <link rel="icon" class="so-favicon" type="image/svg+xml" href="images/favicon/onion.svg?v=VERSION_PLACEHOLDER">
    <link rel="stylesheet" href="css/external/vuetify-v2.7.1.min.css">
    <link rel="stylesheet" href="css/external/all-6.5.1.min.css">
    <link rel="stylesheet" href="css/external/daterangepicker-3.14.1.css">
    <link rel="stylesheet" href="css/app.css?v=VERSION_PLACEHOLDER">
    <title>Security Onion</title>
  </head>
  <body style="background-color: #242424;">
    <v-app id="app" style="display:none" :key="timestamp">
      <v-navigation-drawer v-model="toolbar" width="200" clipped overflow app>
        <v-list dense>
          <v-list-item @click="" to="/">
            <v-list-item-action>
              <v-icon>fa-home</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.home"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item @click="" to="/alerts">
            <v-list-item-action>
              <v-icon>fa-bell</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.alerts"></v-list-item-title>
            </v-list-item-content>
            <v-list-item-icon v-if="isNewAlert()">
              <v-icon color="warning">fa-exclamation</v-icon>
            </v-list-item-icon>
          </v-list-item>
          <v-list-item @click="" to="/dashboards">
            <v-list-item-action>
              <v-icon>fa-chart-pie</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.dashboards"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item @click="" to="/hunt">
            <v-list-item-action>
              <v-icon>fa-crosshairs</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.hunt"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item @click="" to="/cases" v-if="casesEnabled">
            <v-list-item-action>
              <v-icon>fa-briefcase</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.cases"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item @click="" to="/detections">
            <v-list-item-action>
              <v-icon>fa-magnifying-glass</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.detections"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <!-- <v-list-item @click="" to="/playbooks">
            <v-list-item-action>
              <v-icon>fa-book-bookmark</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.playbooks"></v-list-item-title>
            </v-list-item-content>
          </v-list-item> -->
          <v-list-item @click="" to="/jobs">
            <v-list-item-action>
              <v-icon>fa-stream</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.jobs"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item @click="" to="/grid">
            <v-list-item-action>
              <v-icon>fa-network-wired</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.grid"></v-list-item-title>
            </v-list-item-content>
            <v-list-item-icon v-if="isGridUnhealthy()">
              <v-icon color="warning">fa-exclamation</v-icon>
            </v-list-item-icon>
          </v-list-item>
          <v-list-item @click="" to="/downloads">
            <v-list-item-action>
              <v-icon>fa-download</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.downloads"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-group :value="false" prepend-icon="fa-screwdriver-wrench">
            <template v-slot:activator>
              <v-list-item-title v-text="i18n.admin"></v-list-item-title>
            </template>
            <v-list-item @click="" to="/users">
              <v-list-item-icon>
                <v-icon>fa-users</v-icon>
              </v-list-item-icon>
              <v-list-item-title v-text="i18n.users"></v-list-item-title>
            </v-list-item>
            <v-list-item v-if="$root.isUserAdmin()" @click="" to="/gridmembers">
              <v-list-item-icon>
                <v-icon>fa-circle-nodes</v-icon>
              </v-list-item-icon>
              <v-list-item-title v-text="i18n.gridMembers"></v-list-item-title>
            </v-list-item>
            <v-list-item v-if="$root.isUserAdmin()"  @click="" to="/config">
              <v-list-item-icon>
                <v-icon>fa-gear</v-icon>
              </v-list-item-icon>
              <v-list-item-title v-text="i18n.config"></v-list-item-title>
            </v-list-item>
            <v-list-item v-if="$root.isUserAdmin()"  @click="" to="/licensekey">
              <v-list-item-icon>
                <v-icon>fa-key</v-icon>
              </v-list-item-icon>
              <v-list-item-title v-text="i18n.licenseKey"></v-list-item-title>
            </v-list-item>
          </v-list-item-group>
        </v-list>
        <v-divider></v-divider>
        <v-list subheader dense id="external-tools-list">
          <v-subheader>Tools</v-subheader>
          <v-list-item v-for="tool in tools" v-if="tool.enabled" :key="tool.name" :id="tool.name" :target="$root.target(tool.target)" :href="tool.link" :title="$root.localizeMessage(tool.description)">
            <v-list-item-action>
              <v-icon>{{ tool.icon }}</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="$root.localizeMessage(tool.name)"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
        </v-list>
      </v-navigation-drawer>
      <v-app-bar clipped-left app >
        <v-app-bar-nav-icon @click.stop="toolbar = !toolbar">
          <v-icon>fa-bars</v-icon>
        </v-app-bar-nav-icon>
        <v-toolbar-title>
          <a href="/" id="title">
            <img class="pt-1" :title="i18n.product" :alt="i18n.product" height="45" src="images/so-logo.svg"></v-img>
          </a>
        </v-toolbar-title>
        <v-spacer></v-spacer>
        <div id="connection-indicator" v-if="!connected || reconnecting">
          <v-icon class="mr-2" color="warning">fa-satellite-dish</v-icon>
          <span v-if="reconnecting" v-text="i18n.reconnecting"></span>
          <span v-if="!reconnecting" v-text="i18n.disconnected"></span>
        </div>
        <v-spacer></v-spacer>
        <v-menu bottom left offset-y>
          <template v-slot:activator="{ on }">
            <v-btn icon v-on="on">
              <v-icon>fa-user</v-icon>
            </v-btn>
          </template>
          <v-list id="top-menu">
            <v-list-item>
              <v-list-item-content>
                <v-list-item-title v-text="username"></v-list-item-title>
              </v-list-item-content>
            </v-list-item>
            <v-divider></v-divider>
            <v-list-item @click.stop="toggleTheme">
              <v-list-item-action>
                <v-icon class="mx-auto">fa-adjust</v-icon>
              </v-list-item-action>
              <v-list-item-content>
                <v-list-item-title v-text="i18n.darkMode"></v-list-item-title>
              </v-list-item-content>
            </v-list-item>
            <v-list-item :target="$root.target('so-help')" :href="parameters.releaseNotesUrl">
              <v-list-item-action>
                <v-icon class="mx-auto">fa-gift</v-icon>
              </v-list-item-action>
              <v-list-item-content>
                <v-list-item-title v-text="i18n.whatsnew"></v-list-item-title>
              </v-list-item-content>
            </v-list-item>
            <v-list-item :target="$root.target('so-help')" :href="parameters.docsUrl">
              <v-list-item-action>
                <v-icon class="mx-auto">fa-question</v-icon>
              </v-list-item-action>
              <v-list-item-content>
                <v-list-item-title v-text="i18n.help"></v-list-item-title>
              </v-list-item-content>
            </v-list-item>
            <v-list-item :target="$root.target('so-cheatsheet')" :href="parameters.cheatsheetUrl">
              <v-list-item-action>
                <v-icon class="mx-auto">fa-scroll</v-icon>
              </v-list-item-action>
              <v-list-item-content>
                <v-list-item-title v-text="i18n.cheatsheet"></v-list-item-title>
              </v-list-item-content>
            </v-list-item>
            <v-list-item :target="$root.target('so-blog')" href="https://blog.securityonion.net/">
              <v-list-item-action>
                <v-icon class="mx-auto">fa-info</v-icon>
              </v-list-item-action>
              <v-list-item-content>
                <v-list-item-title v-text="i18n.blog"></v-list-item-title>
              </v-list-item-content>
            </v-list-item>
            <v-divider></v-divider>
            <v-list-item :href="settingsUrl">
              <v-list-item-action>
                <v-icon class="mx-auto">fa-user-edit</v-icon>
              </v-list-item-action>
              <v-list-item-content>
                <v-list-item-title v-text="i18n.settings"></v-list-item-title>
              </v-list-item-content>
            </v-list-item>
            <v-list-item @click.stop="logout">
              <v-list-item-action>
                <v-icon class="mx-auto">fa-sign-out-alt</v-icon>
              </v-list-item-action>
              <v-list-item-content>
                <v-list-item-title v-text="i18n.logout"></v-list-item-title>
              </v-list-item-content>
            </v-list-item>
          </v-list>
        </v-menu>
      </v-app-bar>
      <v-main>
        <v-overlay id="loading" :value="loading">
          <v-progress-circular indeterminate color="primary" width="2" size="64"></v-progress-circular>
        </v-overlay>
        <v-snackbar id="error" top centered rounded close :timeout="errorTimeout" v-model="error" color="error">
          <template v-slot:action="{ attrs }">
            <v-btn icon small v-bind="attrs" @click="error = false">
              <v-icon>fa-times</v-icon>
            </v-btn>
          </template>
          {{ errorMessage }}
          <div class="mt-2 no-underline">
            {{ i18n.errorHelp }}
            <a :target="$root.target('so-help')" :href="parameters.docsUrl + 'help.html'" class="text-decoration-none">
              <v-icon>fa-life-ring</v-icon>
            </a>
          </div>
          <div class="mt-2 no-underline">
            {{ i18n.huntForError }}
            <router-link :to="{ name: 'hunt', query: {q: i18n.huntForErrorQuery, rt: 5, rtu: 'minutes', socExcludeToggle: false }}" class="text-decoration-none error-hunt">
              <v-icon :title="i18n.huntForError">fa-crosshairs</v-icon>
            </router-link>
          </div>
        </v-snackbar>
        <v-snackbar id="warning" top centered rounded close :timeout="warningTimeout" v-model="warning" color="warning">
          <template v-slot:action="{ attrs }">
            <v-btn icon small v-bind="attrs" @click="warning = false">
              <v-icon>fa-times</v-icon>
            </v-btn>
          </template>
          {{ warningMessage }}
        </v-snackbar>
        <v-alert dismissible type="info" icon="fa-info" v-model="info" transition="scale-transition" v-html="infoMessage"></v-alert>
        <v-snackbar id="tip" top centered rounded close :timeout="tipTimeout" v-model="tip" color="info">
          <template v-slot:action="{ attrs }">
            <v-btn icon small v-bind="attrs" @click="tip = false">
              <v-icon>fa-times</v-icon>
            </v-btn>
          </template>
          {{ tipMessage }}
        </v-snackbar>
        <router-view id="main-view"></router-view>
      </v-main>
      <v-footer app>
        <span id="version" class="text-no-wrap">
          {{ i18n.version }}: {{ version }}
        </span>
        <v-spacer></v-spacer>
        <span class="text-no-wrap d-none d-md-flex">
          &copy; {{ new Date().getFullYear() }}
          <a class="footer mx-1" :target="$root.target('sos')" href="https://securityonionsolutions.com/">
            Security Onion Solutions, LLC
          </a>
        </span>
        <span class="text-no-wrap d-md-none">
          &copy; {{ new Date().getFullYear() }}
          <a class="footer mx-1" :target="$root.target('sos')" href="https://securityonionsolutions.com/">
            SOS
          </a>
        </span>
        <v-spacer></v-spacer>
        <span class="text-no-wrap">
          <router-link id="termsLink" to="/terms" class="footer">
            <span class="d-lg-inline">{{ i18n.license }}:</span>
            <span v-if="isLicenseUnprovisioned()"> {{ i18n.licenseShort }}</span>
            <v-chip v-else x-small :color="colorLicenseStatus(licenseStatus)">{{ localizeMessage(licenseStatus) }}</v-chip>
          </router-link>
        </span>
      </v-footer>
    </v-app>

    <script type="text/x-template" id="page-home">
      <v-container fluid>
        <v-row>
          <v-col>
            <h2 v-text="i18n.home"></h2>
          </v-col>
        </v-row>
        <v-row>
          <v-col cols="12" lg="6" class="mx-auto px-12">
            <div id="motd" class="markdown-body" :inner-html.prop="motd | formatMarkdown"></div>
          </v-col>
          <v-col cols="12" lg="6" class="mx-auto text-center">
            <div v-html="i18n.sponsorsIntro" class="mb-6"></div>
            <a :target="$root.target('sos')" href="https://securityonionsolutions.com/" class="text-decoration-none">
              <img v-if="!$vuetify.theme.dark" height="100" src="images/sos-logo.svg">
              <img v-if="$vuetify.theme.dark" height="100" src="images/sos-logo-white.svg">
            </a>
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-hunt">
      <v-container fluid>
        <v-row>
          <v-col cols="12" lg="3">
            <h2 v-text="i18n[category]"></h2>
          </v-col>
          <v-col cols="12" lg="5">
            <v-expansion-panels>
              <v-expansion-panel>
                <v-expansion-panel-header id="huntOptionsHeader">{{i18n.options}}</v-expansion-panel-header>
                <v-expansion-panel-content>
                  <v-switch v-if="isCategory('alerts') || isCategory('cases') || isCategory('detections')" id="enable-advanced" :disabled="loading()" v-model="advanced" dense hide-details class="my-0" :label="i18n.advanced"></v-switch>
                  <v-switch v-if="isAdvanced()" id="auto-hunt" :disabled="loading()" v-model="autohunt" dense hide-details class="my-0" :label="i18n.autohunt"></v-switch>
                  <v-switch v-for="toggle in filterToggles" :key="toggle.name"
                    :id="'filterToggle-' + toggle.name"
                    :disabled="loading()"
                    v-model="toggle['enabled']"
                    dense hide-details class="my-0"
                    @click="filterToggled($event, toggle)"
                    :label="$root.localizeMessage(toggle.name)" @click="notifyInputsChanged()"></v-switch>
                  <v-select id="autoRefresh" class="ml-" :disabled="loading()" v-model="autoRefreshInterval" :items="autoRefreshIntervals" :hint="i18n.autoRefresh" persistent-hint prepend-icon="fa-hourglass-half"></v-select>
                  <v-select :disabled="loading()" @change="saveTimezone" v-model="zone" :items="$root.timezones" :hint="i18n.timezoneHelp" persistent-hint prepend-icon="fa-user-clock"></v-select>
                </v-expansion-panel-content>
              </v-expansion-panel>
            </v-expansion-panels>
          </v-col>
          <v-spacer></v-spacer>
          <v-col cols="12" lg="2" align="end">
            <h4 v-if="loaded">{{ i18n.eventTotal }} {{ totalEvents.toLocaleString() }}</h4>
          </v-col>
        </v-row>
        <v-row align="start" v-if="createLink != ''">
          <v-col cols="12">
            <v-toolbar class="elevation-0" fixed>
              <router-link :to="createLink" style="text-decoration: none; cursor: 'pointer'">
                <v-btn color="primary" id="add-case-button">
                  <v-icon :title="i18n.create">fa-plus</v-icon>
                </v-btn>
              </router-link>
            </v-toolbar>
          </v-col>
        </v-row>
        <v-row align="start">
          <v-col cols="12" md="7">
            <v-textarea :clearable="isAdvanced()" :auto-grow="isAdvanced()" :readonly="!isAdvanced()" :disabled="loading()" @change="notifyInputsChanged" class="mx-2" v-model="$data[isAdvanced() ? 'query' : 'queryName']" :hint="isAdvanced() ? i18n.queryHelp : ''" rows="1" persistent-hint prepend-icon="fa-search" @keydown.enter.prevent="hunt" id="hunt-query-input">
              <template v-slot:prepend-inner>
                <v-menu dense bottom three-line offset-y>
                  <template v-slot:activator="{ on: menu }">
                    <v-tooltip bottom>
                      <template v-slot:activator="{ on: tooltip }">
                        <v-btn icon small v-on="{ ...tooltip, ...menu }" id="hunt-query-dropdown-button">
                          <v-icon>fa-angle-down</v-icon>
                        </v-btn>
                      </template>
                      <span>{{ i18n.queriesHelp }}</span>
                    </v-tooltip>
                  </template>
                  <v-list dense class="overflow-y-auto" style="max-height: 600px" id="hunt-query-dropdown-list">
                    <v-list-item v-if="isAdvanced() && mruQueryLimit > 0" v-for="query in mruQueries" :key="query">
                      <v-list-item-content @click="huntQuery(query)" :style="{ cursor: 'pointer'}">
                        <v-list-item-title v-text="query"></v-list-item-title>
                        <v-list-item-subtitle>
                          <span class="text-primary">{{ i18n.mruQuery }} &mdash;</span>
                          {{ i18n.mruQueryHelp }}
                        </v-list-item-subtitle>
                      </v-list-item-content>
                    </v-list-item>
                    <v-divider v-if="isAdvanced()"></v-divider>
                    <v-list-item v-for="query in queries" :key="query.query">
                      <v-list-item-content @click="huntQuery(query.query)" :style="{ cursor: 'pointer'}" :title="query.description">
                        <v-list-item-title class="text-primary">
                          {{ query.name }}
                        </v-list-item-title>
                        <v-list-item-subtitle v-if="query.showSubtitle" v-text="query.query"></v-list-item-subtitle>
                      </v-list-item-content>
                    </v-list-item>
                  </v-list>
                </v-menu>
              </template>
              <template v-if="!isCategory('hunt')" v-slot:append-outer>
                <v-btn small icon id="switch-to-hunt-button" :title="i18n.huntHelp" @click="switchToHunt()">
                  <v-icon>fa-crosshairs</v-icon>
                </v-btn>
              </template>
            </v-textarea>
          </v-col>
          <v-col cols="12" md="5" class="d-flex flex-nowrap align-center">
            <v-text-field :disabled="loading()" v-if="relativeTimeEnabled" id="huntrelativetimevalue" @change="notifyInputsChanged" class="mx-2"
                v-model="relativeTimeValue" :hint="i18n.relativeTimeHelp" persistent-hint="true" type="number">
              <template v-slot:prepend>
                <v-btn v-if="relativeTimeEnabled" icon x-small @click="showAbsoluteTime" id="show-absolute-time">
                  <v-icon>fa-history</v-icon>
                </v-btn>
                <div v-if="relativeTimeEnabled" class="pt-1 px-4">
                  {{ i18n.last }}
                </div>
              </template>
              <template v-slot:append-outer>
                <v-select id="huntrelativetimeunit" class="my-n1 py-0" :disabled="loading()" v-if="relativeTimeEnabled" @change="notifyInputsChanged"
                  v-model="relativeTimeUnit" :items="relativeTimeUnits"></v-select>
              </template>
            </v-text-field>
            <v-text-field :disabled="loading()" v-if="!relativeTimeEnabled" id="huntdaterange" @change="notifyInputsChanged" class="mx-2"
              v-model="dateRange" :hint="i18n.timePickerHelp" persistent-hint="true"
              prepend-inner-icon="fa-angle-down" @click:prepend-inner="showDateRangePicker">
              <template v-slot:prepend>
                <v-btn v-if="!relativeTimeEnabled" icon x-small @click="showRelativeTime" id="show-relative-time">
                  <v-icon>fa-calendar-alt</v-icon>
                </v-btn>
              </template>
            </v-text-field>
            <v-btn id="hunt" :disabled="loading()" :color="huntPending ? 'light-green accent-4' : (autoRefreshInterval ? 'secondary' : 'primary')" @click.stop="hunt">
              <span v-if="isCategory('hunt')" class="d-sm-none d-lg-inline pr-2" v-text="i18n.hunt"></span>
              <span v-if="!isCategory('hunt')" class="d-sm-none d-lg-inline pr-2" v-text="i18n.refresh"></span>
              <v-icon v-if="isCategory('hunt') && !autoRefreshInterval">fa-crosshairs</v-icon>
              <v-icon v-if="!isCategory('hunt') && !autoRefreshInterval">fa-sync</v-icon>
              <v-icon v-if="autoRefreshInterval">fa-hourglass-half</v-icon>
            </v-btn>
          </v-col>
        </v-row>
        <v-row v-if="loaded && (queryFilters.length > 0 || queryGroupBys.length > 0 || querySortBys.length > 0)">
          <v-col cols="12">
            <span v-for="filter in queryFilters" :key="filter">
              <v-chip class="filter mx-1 my-1" color="primary" close @click:close="removeFilter(filter)">{{ formatSafeString(filter) }}</v-chip>
            </span>
            <span v-for="sortBy in querySortBys" :key="sortBy">
              <v-chip class="sortBy mx-1 my-1" color="secondary" close @click:close="removeSortBy(sortBy)">{{ i18n.sortedBy }} {{ formatSafeString(sortBy) }}</v-chip>
            </span>
          </v-col>
        </v-row>
        <v-col id="graphs" v-if="loaded && isAdvanced() && !isCategory('detections')">
          <v-toolbar dense flat>
            <v-toolbar-title>{{ i18n.standardMetrics }}</v-toolbar-title>
            <v-spacer />
            <v-btn
              plain
              icon
              small
              class="mr-1"
              @click="toggleShowSection('hunt-graphs')"
            >
              <v-icon v-if="!isExpandedSection('hunt-graphs')">fa-angle-down</v-icon>
              <v-icon v-if="isExpandedSection('hunt-graphs')">fa-angle-up</v-icon>
            </v-btn>
          </v-toolbar>
          <v-expand-transition>
            <div v-if="isExpandedSection('hunt-graphs')">
              <v-row v-if="!metricsEnabled">
                <v-col cols="12">
                  <line-chart :height="chartHeight" :chartdata="timelineChartData" :options="timelineChartOptions"/>
                </v-col>
              </v-row>
              <v-row v-if="metricsEnabled">
                <v-col cols="12" md="4">
                  <bar-chart id="topChart" :height="chartHeight" :chartdata="topChartData" :options="topChartOptions"/>
                </v-col>
                <v-col cols="12" md="4">
                  <line-chart id="timelineChart" :height="chartHeight" :chartdata="timelineChartData" :options="timelineChartOptions"/>
                </v-col>
                <v-col cols="12" md="4">
                  <bar-chart id="bottomChart" :height="chartHeight" :chartdata="bottomChartData" :options="bottomChartOptions"/>
                </v-col>
              </v-row>
            </div>
          </v-expand-transition>
        </v-col>
        <v-col id="group-metrics" v-if="metricsEnabled">
          <v-toolbar v-if="isAdvanced()" dense flat>
            <v-toolbar-title>{{ i18n.groups }}</v-toolbar-title>
            <v-spacer />
            <v-btn
              plain
              icon
              small
              class="mr-1"
              @click="toggleShowSection('hunt-groups')"
            >
              <v-icon v-if="!isExpandedSection('hunt-groups')">fa-angle-down</v-icon>
              <v-icon v-if="isExpandedSection('hunt-groups')">fa-angle-up</v-icon>
            </v-btn>
          </v-toolbar>
          <v-expand-transition>
            <v-row v-if="isExpandedSection('hunt-groups')">
              <v-col cols="12">
                <v-container fluid>
                  <v-row>
                    <v-col cols="4"></v-col>
                    <v-col cols="2">
                      <v-select :disabled="loading()" @change="notifyInputsChanged" v-model="groupByLimit" :items="groupByLimitOptions" :label="i18n.fetchLimit"></v-select>
                    </v-col>
                    <v-col cols="6">
                      <v-text-field v-model="groupByFilter" clearable prepend-icon="fa-filter" :label="i18n.filterResults" single-line hide-details></v-text-field>
                    </v-col>
                  </v-row>
                  <v-row>
                    <v-col v-for="(group, groupIdx) in groupBys" class="groupBy">
                      <div v-if="group.chart_type">
                        <router-link class="mx-1" :to="buildGroupWithoutOptionsRoute(groupIdx)" :title="i18n.showTable" style="text-decoration: none; cursor: 'pointer'">
                          <v-icon>fa-table-cells</v-icon>
                        </router-link>
                        <router-link class="mx-1" :to="buildToggleLegendRoute(group, groupIdx)" :title="i18n.toggleLegend" style="text-decoration: none; cursor: 'pointer'">
                          <v-icon>fa-list</v-icon>
                        </router-link>
                        <router-link class="mx-1" :to="buildMaximizeRoute(group, groupIdx)" :title="i18n.maximize" style="text-decoration: none; cursor: 'pointer'">
                          <v-icon>fa-expand</v-icon>
                        </router-link>
                        <v-btn icon class="mx-1" @click="removeGroupBy(groupIdx, -1)" :title="i18n.remove">
                          <v-icon class="tiny-icon">fa-circle-xmark</v-icon>
                        </v-btn>
                        <pie-chart v-if="group.chart_type == 'pie'" :id="'group-' + groupIdx" :chartdata="group.chart_data" :options="group.chart_options"/>
                        <bar-chart v-if="group.chart_type == 'bar'" :id="'group-' + groupIdx" :chartdata="group.chart_data" :options="group.chart_options"/>
                        <sankey-chart v-if="group.chart_type == 'sankey'" :id="'group-' + groupIdx" :chartdata="group.chart_data" :options="group.chart_options"/>
                      </div>
                      <v-data-table v-if="!group.chart_type" :id="'group-' + groupIdx" class="elevation-1"
                        :search="groupByFilter" dense
                        :footer-props="groupByFooters" :sort-by.sync="group.sortBy" :sort-desc.sync="group.sortDesc"
                        @update:sort-by="updateGroupBySort" @update:sort-desc="updateGroupBySort"
                        :items-per-page.sync="groupByItemsPerPage" must-sort :headers="group.headers" :items="group.data" :custom-sort="sortEvents">
                        <template v-if="!group.maximized" v-for="(header, headerIdx) in group.headers" v-slot:["header." + header.value]="{ props }">
                          {{ header.text }}
                          <span class="table-header-actions mx-2">
                            <router-link v-if="header.value == 'count' && isAdvanced()" :to="buildGroupOptionRoute(groupIdx, [], 'pie')" :title="i18n.showPieChart" style="text-decoration: none; cursor: 'pointer'">
                              <v-icon>fa-chart-pie</v-icon>
                            </router-link>
                            <router-link v-if="header.value == 'count' && isAdvanced()" :to="buildGroupOptionRoute(groupIdx, [], 'bar')" :title="i18n.showBarChart" style="text-decoration: none; cursor: 'pointer'">
                              <v-icon>fa-chart-column</v-icon>
                            </router-link>
                            <router-link v-if="header.value == 'count' && isAdvanced() && isGroupSankeyCapable(group, groupIdx)" icon x-small :to="buildGroupOptionRoute(groupIdx, [], 'sankey')" :title="i18n.showSankeyChart" style="text-decoration: none; cursor: 'pointer'">
                              <v-icon>fa-diagram-project</v-icon>
                            </router-link>
                            <router-link v-if="header.value == 'count' && isAdvanced()" class="mx-1" :to="buildMaximizeRoute(group, groupIdx)" :title="i18n.maximize" style="text-decoration: none; cursor: 'pointer'">
                              <v-icon>fa-expand</v-icon>
                            </router-link>
                            <v-btn v-if="header.value != 'count' && header.value != ''" icon x-small @click.stop="removeGroupBy(groupIdx,headerIdx - getGroupByFieldStartIndex())" :title="i18n.remove">
                              <v-icon class="tiny-icon">fa-circle-xmark</v-icon>
                            </v-btn>
                          </span>
                        </template>
                        <template v-if="!group.maximized" v-slot:item="{ item, index }">
                          <tr>
                            <td v-if="aggregationActionsEnabled">
                              <v-btn id="alertButton" v-if="ackEnabled && item['event.severity_label']" class="mx-2" icon x-small
                                @click="ack($event, item, index, !isFilterToggleEnabled('acknowledged'), false, null, groupIdx)"
                                :color="item['event.severity_label'] + '_' + isFilterToggleEnabled('acknowledged') | colorSeverity">
                                <v-icon :title="isFilterToggleEnabled('acknowledged') ? i18n.alertUndoAcknowledge : i18n.alertAcknowledge">fa-bell</v-icon>
                              </v-btn>
                              <v-btn id="escalateButton" v-if="escalateEnabled" class="mx-2" icon x-small
                                @click="toggleEscalationMenu($event, item, groupIdx)"
                                :color="isFilterToggleEnabled('escalated') || item['event.escalated'] == true ? 'secondary' : 'primary'">
                                <v-icon :title="isFilterToggleEnabled('escalated') || item['event.escalated'] == true ? i18n.alertEscalated : i18n.escalate">fa-exclamation-triangle</v-icon>
                              </v-btn>
                            </td>
                            <td>
                              <v-tooltip bottom v-if="loaded && eventsEnabled && metricsEnabled && ( (group.headers.length==3 && group.headers[1]['value']=='count' ) || (group.headers.length==5 && group.headers[1]['value']=='count' && group.headers[2]['value']=='rule.name' && group.headers[3]['value']=='event.module' && group.headers[4]['value']=='event.severity_label') ) ">
                                <template v-slot:activator="{ on, attrs }">
                                  <span v-bind="attrs" v-on="on">
                                    <div class="count-drilldown d-inline-block" v-text="item.count.toLocaleString()" v-bind="attrs" @click="countDrilldown(item)"></div>
                                  </span>
                                </template>
                                <span>{{ i18n.quickDrilldown }}</span>
                              </v-tooltip>
                               <div v-else class="count-drilldown d-inline-block" v-text="item.count.toLocaleString()"></div>
                            </td>
                            <td v-for="field in group.headers.slice(getGroupByFieldStartIndex())" :key="field.value">
                              <div class="quick-action-trigger d-inline-block" @click="toggleQuickAction($event, item, field.value, item[field.value])">{{ item[field.value] }}<span class="resolved-host" v-if="$root.pickHostname(item[field.value])"> - {{ $root.pickHostname(item[field.value]) }}</span></div>
                            </td>
                          </tr>
                        </template>

                      </v-data-table>
                    </v-col>
                  </v-row>
                </v-container>
              </v-col>
            </v-row>
          </v-expand-transition>
        </v-col>
        <v-col id="events" v-if="loaded && eventsEnabled && (isAdvanced() || !metricsEnabled)">
          <v-toolbar v-if="isAdvanced()" dense flat>
            <v-toolbar-title>{{ i18n.events }}</v-toolbar-title>
            <v-spacer />
            <v-btn
              plain
              icon
              small
              class="mr-1"
              @click="toggleShowSection('hunt-events')"
            >
              <v-icon v-if="!isExpandedSection('hunt-events')">fa-angle-down</v-icon>
              <v-icon v-if="isExpandedSection('hunt-events')">fa-angle-up</v-icon>
            </v-btn>
          </v-toolbar>
          <v-expand-transition>
            <v-row v-if="isExpandedSection('hunt-events')">
              <v-col cols="12">
                <v-data-table :search="eventFilter" :sort-by.sync="sortBy" item-key="soc_id" :expanded.sync="expanded" :sort-desc.sync="sortDesc" :footer-props="footerProps"
                  :items-per-page.sync="itemsPerPage" must-sort :headers="eventHeaders" :items="eventData" show-expand :page.sync="eventPage" :custom-sort="sortEvents">
                  <template v-slot:top v-if="isAdvanced()">
                    <v-container fluid>
                      <v-row>
                        <v-col cols="4"></v-col>
                        <v-col cols="2">
                          <v-select :disabled="loading()" @change="notifyInputsChanged" v-model="eventLimit" :items="eventLimitOptions" :label="i18n.fetchLimit"></v-select>
                        </v-col>
                        <v-col cols="6">
                          <v-text-field v-model="eventFilter" clearable prepend-icon="fa-filter" :label="i18n.filterResults" single-line hide-details></v-text-field>
                        </v-col>
                      </v-row>
                    </v-container>
                  </template>
                  <template v-for="(header, headerIdx) in eventHeaders" v-slot:["header." + header.value]="{ props }">
                    <span :id="'col_' + header.value">
                      <span v-if="header.value != ''" class="table-header-actions">
                        <v-btn :id="'col_move_left_' + header.value" icon x-small @click.stop="moveColumnHeader(header.value, true)" :title="i18n.moveLeft">
                          <v-icon class="tiny-icon">fa-caret-left</v-icon>
                        </v-btn>
                      </span>
                      <span :id="'col_label_' + header.value">
                        {{ header.text }}
                      </span>
                      <span v-if="header.value != ''" class="table-header-actions">
                        <v-btn :id="'col_move_right_' + header.value" icon x-small @click.stop="moveColumnHeader(header.value, false)" :title="i18n.moveRight">
                          <v-icon class="tiny-icon">fa-caret-right</v-icon>
                        </v-btn>
                        <v-btn :id="'col_del_' + header.value" icon x-small @click.stop="removeColumnHeader(header.value)" :title="i18n.remove">
                          <v-icon class="tiny-icon">fa-circle-xmark</v-icon>
                        </v-btn>
                      </span>
                    </span>
                  </template>
                  <template v-slot:item="{ item, index }">
                    <tr>
                      <td>
                        <v-btn id="expandEvent" icon small @click="expand(item)">
                          <v-icon v-if="isExpanded(item)" :alt="i18n.eventExpand" :title="i18n.eventExpandHelp">fa-angle-down</v-icon>
                          <v-icon v-if="!isExpanded(item)" :alt="i18n.eventExpand" :title="i18n.eventExpandHelp">fa-angle-right</v-icon>
                        </v-btn>
                        <v-btn id="alertButton" v-if="ackEnabled && item['event.severity_label']" class="mx-2" icon x-small
                          @click="ack($event, item, index, !isFilterToggleEnabled('acknowledged'), false, null, -1)"
                          :color="item['event.severity_label'] + '_' + isFilterToggleEnabled('acknowledged') | colorSeverity">
                          <v-icon :title="isFilterToggleEnabled('acknowledged') ? i18n.alertUndoAcknowledge : i18n.alertAcknowledge">fa-bell</v-icon>
                        </v-btn>
                        <v-btn id="escalateButton" v-if="escalateEnabled" class="mx-2" icon x-small
                          @click="toggleEscalationMenu($event, item, -1)"
                          :color="isFilterToggleEnabled('escalated') || item['event.escalated'] == true ? 'secondary' : 'primary'">
                          <v-icon :title="isFilterToggleEnabled('escalated') || item['event.escalated'] == true ? i18n.alertEscalated : i18n.escalate">fa-exclamation-triangle</v-icon>
                        </v-btn>
                        <router-link :to="{ name: 'case', params: {id: item.soc_id}}" style="text-decoration: none; cursor: 'pointer'" v-if="viewEnabled && category === 'cases'">
                          <v-icon class="mr-2" :title="i18n.view">fa-binoculars</v-icon>
                        </router-link>
                        <router-link :to="{ name: 'detection', params: {id: item.soc_id}}" style="text-decoration: none; cursor: 'pointer'" v-if="viewEnabled && category === 'detections'">
                          <v-icon class="mr-2" :title="i18n.view">fa-binoculars</v-icon>
                        </router-link>
                        <router-link :to="{ name: 'playbook', params: {id: item.soc_id}}" style="text-decoration: none; cursor: 'pointer'" v-if="viewEnabled && category === 'playbooks'">
                          <v-icon class="mr-2" :title="i18n.view">fa-binoculars</v-icon>
                        </router-link>
                      </td>
                      <td v-for="field in eventHeaders" :key="field.value">
                        <div class="quick-action-trigger d-inline-block" @click="toggleQuickAction($event, item, field.value, item[field.value])">
                          <span v-if="field.value != 'soc_timestamp'">{{ item[field.value] }}<span class="resolved-host" v-if="$root.pickHostname(item[field.value])"><br/>- {{ $root.pickHostname(item[field.value]) }}</span></span>
                          <span v-if="field.value == 'soc_timestamp'" v-text="$root.formatLocalTimestamp(item[field.value], zone)"/>
                        </div>
                      </td>
                    </tr>
                  </template>
                  <template v-slot:expanded-item="{ headers, item }">
                    <tr>
                      <td :colspan="headers.length" class="px-0">
                        <v-data-table dense disable-pagination hide-default-header hide-default-footer must-sort :headers="expandedHeaders" :items="getExpandedData()">
                          <template v-slot:item="{ item }">
                            <tr class="pt-3">
                              <td class="expansion">
                                <div class="d-inline-block semi-transparent">
                                  <v-btn :id="'groupby_' + item.key" :disabled="!canQuery(item.key)" icon x-small :to="buildGroupByNewRoute(item.key)">
                                    <v-icon :alt="i18n.groupNew" :title="i18n.groupNewHelp">fa-layer-group</v-icon>
                                  </v-btn>
                                  <v-btn :id="'col_toggle_' + item.key" icon x-small @click="toggleColumnHeader(item.key)">
                                    <v-icon :alt="i18n.addColumnHeader" :color="isColumnHeader(item.key) ? 'info' : ''" :title="i18n.addColumnHeaderHelp">fa-table-columns</v-icon>
                                  </v-btn>
                                </div>
                                <div class="d-inline-block expansion" v-text="item.key"></div>
                              </td>
                              <td class="expansion">
                                <div class="quick-action-trigger d-inline-block expansion hardwrap" @click="toggleQuickAction($event, expanded[0], item.key, item.value)">{{item.value}}<span class="resolved-host" v-if="$root.pickHostname(item.value)"> - {{ $root.pickHostname(item.value) }}</span></div>
                              </td>
                            </tr>
                          </template>
                        </v-data-table>
                      </td>
                    </tr>
                  </template>
                </v-data-table>
              </v-col>
            </v-row>
          </v-expand-transition>
        </v-col>
        <v-row v-if="loaded && isAdvanced()">
          <v-col cols="6">
            <v-subheader inset>{{ i18n.eventFetchTook }} {{ fetchTimeSecs }} {{ i18n.seconds }}. {{ i18n.eventRoundTripTook }} {{ roundTripTimeSecs }} {{ i18n.seconds }}.</v-subheader>
          </v-col>
          <v-spacer></v-spacer>
        </v-row>
        <v-menu v-model="quickActionVisible" :position-x="quickActionX" :position-y="quickActionY" absolute>
          <v-list id="hunt-quick-action" color="secondary">
            <v-list-item id="actionFilterInclude" dense :to="filterRouteInclude" :title="i18n.filterIncludeHelp">
              <v-list-item-icon>
                <v-icon :alt="i18n.filterInclude" color="white">fa-search-plus</v-icon>
              </v-list-item-icon>
              <v-list-item-title class="white--text">
                {{ i18n.filterInclude }}
              </v-list-item-title>
            </v-list-item>
            <v-list-item id="actionFilterExclude" dense :to="filterRouteExclude" :title="i18n.filterExcludeHelp">
              <v-list-item-icon>
                <v-icon :alt="i18n.filterExclude" color="white">fa-search-minus</v-icon>
              </v-list-item-icon>
              <v-list-item-title class="white--text">
                {{ i18n.filterExclude }}
              </v-list-item-title>
            </v-list-item>
            <v-list-item id="actionFilterExact" dense :to="filterRouteExact" :title="i18n.filterExactHelp">
              <v-list-item-icon>
                <v-icon :alt="i18n.filterExact" color="white">fa-search</v-icon>
              </v-list-item-icon>
              <v-list-item-title class="white--text">
                {{ i18n.filterExact }}
              </v-list-item-title>
            </v-list-item>
            <v-list-item id="actionDrilldown" dense :to="filterRouteDrilldown" :title="i18n.filterDrilldownHelp" v-if="!isAdvanced() && metricsEnabled">
              <v-list-item-icon>
                <v-icon :alt="i18n.filterDrilldown" color="white">fa-angle-double-down</v-icon>
              </v-list-item-icon>
              <v-list-item-title class="white--text">
                {{ i18n.filterDrilldown }}
              </v-list-item-title>
            </v-list-item>
            <v-list-item id="actionGroupBy" dense :to="groupByRoute" :title="i18n.groupIncludeHelp">
              <v-list-item-icon>
                <v-icon :alt="i18n.groupInclude" color="white">fa-layer-group</v-icon>
              </v-list-item-icon>
              <v-list-item-title class="white--text">
                {{ i18n.groupInclude }}
              </v-list-item-title>
            </v-list-item>
            <v-list-item id="actionGroupByNew" dense :to="groupByNewRoute" :title="i18n.groupNewHelp">
              <v-list-item-icon>
                <v-icon :alt="i18n.groupNew" color="white">fa-layer-group</v-icon>
              </v-list-item-icon>
              <v-list-item-title class="white--text">
                {{ i18n.groupNew }}
              </v-list-item-title>
            </v-list-item>
            <v-list-group dense @click.stop class="flex-group" v-if="quickActionVisible && quickActionIsNumeric">
              <template v-slot:activator>
                <v-list-item-icon>
                  <v-icon :alt="i18n.groupNumeric" color="white">fa-calculator</v-icon>
                </v-list-item-icon>
                <v-list-item-content>
                  <v-list-item-title class="white--text">{{ i18n.numericOps }}</v-list-item-title>
                </v-list-item-content>
              </template>
              <v-list-item dense id="filterLessThan" class="half-width" :to="filterRouteLessThan">
                <v-list-item-title class="white--text">
                  &lt;
                </v-list-item-title>
              </v-list-item>
              <v-list-item dense id="filterLessThanEqual" class="half-width" :to="filterRouteLessThanEqual">
                <v-list-item-title class="white--text">
                  &le;
                </v-list-item-title>
              </v-list-item>
              <div class="flex-break"></div> <!-- line break -->
              <v-list-item dense id="filterGreaterThan" class="half-width" :to="filterRouteGreaterThan">
                <v-list-item-title class="white--text">
                  &gt;
                </v-list-item-title>
              </v-list-item>
              <v-list-item dense id="filterGreaterThanEqual" class="half-width" :to="filterRouteGreaterThanEqual">
                <v-list-item-title class="white--text">
                  &ge;
                </v-list-item-title>
              </v-list-item>
              <v-list-item dense id="filterBetween" @click="showBetweenDialog()">
                <v-list-item-title class="white--text text-center">
                  {{ i18n.betweenOp }}
                </v-list-item-title>
              </v-list-item>
            </v-list-group>
            <v-list-group dense @click.stop>
              <template v-slot:activator>
                <v-list-item-icon>
                  <v-icon color="white">fa-clipboard</v-icon>
                </v-list-item-icon>
                <v-list-item-title class="white--text">
                  {{ i18n.share }}
                </v-list-item-title>
              </template>
              <v-list-item id="actionCopyValue" dense @click="$root.copyToClipboard(quickActionValue)">
                <v-list-item-icon>
                  <v-icon color="white">fa-copy</v-icon>
                </v-list-item-icon>
                <v-list-item-title class="white--text">
                  {{ i18n.copyFieldToClipboard }}
                </v-list-item-title>
              </v-list-item>
              <v-list-item id="actionCopyFieldValue" dense @click="$root.copyToClipboard(quickActionField + ': ' + quickActionValue)">
                <v-list-item-icon>
                  <v-icon color="white">fa-copy</v-icon>
                </v-list-item-icon>
                <v-list-item-title class="white--text">
                  {{ i18n.copyFieldValueToClipboard }}
                </v-list-item-title>
              </v-list-item>
              <v-list-item id="actionCopyEventAsJson" dense @click="$root.copyToClipboard(quickActionEvent, 'json')">
                <v-list-item-icon>
                  <v-icon color="white">fa-copy</v-icon>
                </v-list-item-icon>
                <v-list-item-title class="white--text">
                  {{ i18n.copyEventToClipboardAsJson }}
                </v-list-item-title>
              </v-list-item>
              <v-list-item id="actionCopyEventAsKvp" dense @click="$root.copyToClipboard(quickActionEvent, 'kvp')">
                <v-list-item-icon>
                  <v-icon color="white">fa-copy</v-icon>
                </v-list-item-icon>
                <v-list-item-title class="white--text">
                  {{ i18n.copyEventToClipboardAsKvp }}
                </v-list-item-title>
              </v-list-item>
            </v-list-group>
            <v-list-group dense @click.stop color="white">
              <template v-slot:activator>
                <v-list-item-icon>
                  <v-icon color="white">fa-external-link-alt</v-icon>
                </v-list-item-icon>
                <v-list-item-title class="white--text">
                  {{ i18n.quickActions }}
                </v-list-item-title>
              </template>
              <v-list-item dense v-for="action in actions" class="custom-quick-action-button" v-if="action.enabled" :key="action.name" :href="action.background ? '' : action.linkFormatted" :title="$root.localizeMessage(action.description)" :target="$root.target(action.target)" @click="performAction($event, action) || $root.performAction($event, action)">
                <v-list-item-icon>
                  <v-icon :alt="action.name" color="white">{{ action.icon }}</v-icon>
                </v-list-item-icon>
                <v-list-item-title class="white--text">
                  {{ $root.localizeMessage(action.name) }}
                </v-list-item-title>
              </v-list-item>
            </v-list-group>
          </v-list>
        </v-menu>

        <v-menu v-model="escalationMenuVisible" :position-x="escalationMenuX" :position-y="escalationMenuY" absolute>
          <v-list id="hunt-escalate-menu" color="secondary">
            <v-list-item id="escalateNewMenuItem" dense @click="ack($event, escalationItem, 0, true, true, null, escalationGroupIdx)" :title="i18n.escalateNewCaseHelp">
              <v-list-item-icon>
                <v-icon :alt="i18n.escalateNewCase" color="white">fa-plus</v-icon>
              </v-list-item-icon>
              <v-list-item-title class="white--text">
                {{ i18n.escalateNewCase }}
              </v-list-item-title>
            </v-list-item>
            <v-divider></v-divider>
            <v-subheader class="white--text">{{ i18n.escalateExistingCase }}</v-subheader>
            <v-list-item dense v-for="socCase in mruCases" :title="i18n.escalateExistingCaseHelp" @click="ack($event, escalationItem, 0, true, true, socCase.id, escalationGroupIdx)">
              <v-list-item-icon>
                <v-icon :alt="i18n.escalateExistingCase" color="white">fa-link</v-icon>
              </v-list-item-icon>
              <v-list-item-title class="white--text">
                {{ formatCaseSummary(socCase) }}
              </v-list-item-title>
            </v-list-item>
          </v-list>
        </v-menu>

        <v-dialog v-model="betweenDialogVisible" persistent max-width="800">
          <v-card>
            <v-card-title class="text-h5" v-text="i18n.betweenOp" />
            <v-card-text>
              <div class="between-body">
              <v-responsive class="inline" max-width="120px">
                <v-text-field v-model="betweenStart" id="betweenStart" label="Start" />
              </v-responsive>
              <v-responsive class="inline" max-width="50px">
                <v-select v-model="betweenStartEquals" id="betweenStartEquals" :items="equalityOperators"></v-select>
              </v-responsive>
              <v-responsive class="inline text-center" max-width="290px">
                {{ quickActionField }}
              </v-responsive>
              <v-responsive class="inline" max-width="50px">
                <v-select v-model="betweenEndEquals" id="betweenEndEquals" :items="equalityOperators"></v-select>
              </v-responsive>
              <v-responsive class="inline" max-width="120px">
                <v-text-field v-model="betweenEnd" id="betweenEnd" label="End" />
              </v-responsive>
            </div>
            <div v-if="betweenError" class="red--text">
              {{ betweenError }}
            </div>
            </v-card-text>
            <v-card-actions>
              <v-spacer></v-spacer>
              <v-btn text id="hunt-between-proceed-button" @click="huntBetween()" v-text="i18n.accept" />
              <v-btn text id="hunt-between-cancel-button" @click="cancelBetweenDialog()" v-text="i18n.cancel" />
            </v-card-actions>
          </v-card>
        </v-dialog>

        <v-dialog v-model="addToCaseDialogVisible" persistent max-width="800">
          <v-card>
            <v-card-title class="text-h5" v-text="i18n.actionAddToCase" />
            <v-card-text>
              <v-select id="case-select" v-if="addToCaseDialogVisible" v-model="selectedMruCase" :items="mruCases" :label="i18n.mruCases"></v-select>
            </v-card-text>
            <v-card-actions>
              <v-spacer></v-spacer>
              <v-btn text id="add-to-case-proceed-button" @click="addToCase(false)" v-text="i18n.add" />
              <v-btn text id="add-to-case-proceed-new-tab-button" @click="addToCase(true)" v-text="i18n.addInNewTab" />
              <v-btn text id="add-to-case-cancel-button" @click="cancelAddToCaseDialog()" v-text="i18n.cancel" />
            </v-card-actions>
          </v-card>
        </v-dialog>
      </v-container>
    </script>

    <script type="text/x-template" id="page-detection">
      <v-container fluid v-if="detect">
        <div class="mx-sm-12 mx-lg-6 mt-2 mb-6 mb-md-1">
          <!-- Title -->
          <h2 id="detection-title" @click="startEdit('detection-title', 'title')" v-if="!isEdit('detection-title')">{{ detect.title }}</h2>
          <v-text-field id="detection-title-edit" v-else hide-details="auto" outlined v-model="detect.title" :rules="[rules.required]" persistent-hint :hint="i18n.detectionTitle" v-on:keyup.enter="stopEdit(true)" v-on:keyup.esc="stopEdit(false)"></v-text-field>
        </div>

        <div class="row mx-sm-8 mx-md-12 mx-lg-4 flex-column flex-md-row">
          <div class="main col-md-9 order-md-1 col-12 order-2">
            <div v-if="isNew()">
              <!-- Create View -->
              <v-form ref="detection" v-model="editForm.valid">
                <div class="col pt-5" style="background-color: rgb(53, 53, 53); border-radius: 4px;">
                  <!-- Description -->
                  <v-textarea id="detection-description-create" hide-details="auto" outlined v-model="detect.description" :rules="[rules.required]" persistent-hint :hint="i18n.detectionDescription" auto-grow rows="5"></v-textarea>

                  <!-- PublicID -->
                  <v-text-field id="detection-publicId-create" class="mt-0" v-model="detect.publicId" :rules="[rules.required, rules.minLength(5)]" persistent-hint :hint="i18n.publicID">
                    <template v-slot:append v-if="!detect.publicId">
                      <v-btn id="gen-public-id-create" text small color="primary" @click="generatePublicID()">Generate</v-btn>
                    </template>
                  </v-text-field>

                  <!-- Author -->
                  <v-text-field id="detection-author-create" v-model="detect.author" :rules="[rules.required]" persistent-hint :hint="i18n.author"></v-text-field>

                  <!-- Severity -->
                  <v-select id="detection-severity-create" v-model="detect.severity" :items="getPresets('severity')" persistent-hint :hint="i18n.detectionSeverity"/>

                  <!-- Engine -->
                  <v-select id="detection-engine-create" v-model="detect.engine" :items="getPresets('engine')" persistent-hint :hint="i18n.engine" :rules="[rules.required]" v-on:change="onDetectionChange"/>

                  <!-- Reporting -->
                  <v-checkbox id="detection-reporting-create" class="mt-5" v-model="detect.isReporting" :label="i18n.reporting"/>

                  <!-- Signature -->
                  <div class="font-weight-bold mb-1">{{ i18n.signature }}:</div>
                  <v-textarea class="config-editor" outlined v-model="detect.content" rows="10" :rules="[rules.required]" @input="onDetectionChange()" />
                </div>
                <div class="d-flex align-center align-self-end text-body-2 mt-2">
                  <div class="d-inline-flex justify-end">
                    <v-btn id="detection-create-cancel" text small color="primary" class="align-self-end" @click="cancelDetection()">
                      {{ i18n.cancel }}
                    </v-btn>
                    <v-btn id="detection-create-create" text small color="primary" class="align-self-end" @click="saveDetection(true)">
                      {{ i18n.create }}
                    </v-btn>
                  </div>
                </div>
              </v-form>
            </div>

            <v-tabs grow v-model="activeTab" v-else>
              <v-tab id="detection_summaryTab" href="#summary">
                <v-icon left>fa-clipboard</v-icon>
                <div class="d-none d-lg-block">Summary</div>
              </v-tab>
              <v-tab id="detection_signatureTab" href="#signature">
                <v-icon left>fa-signature</v-icon>
                <div class="d-none d-lg-block">Signature</div>
              </v-tab>
              <v-tab id="detection_notesTab" href="#notes">
                <v-icon left>fa-pencil</v-icon>
                <div class="d-none d-lg-block">Notes</div>
              </v-tab>
              <!-- <v-tab id="detection_playbookTab" href="#playbook">
                <v-icon left>fa-book-bookmark</v-icon>
                <div class="d-none d-lg-block">Investigative Playbook</div>
              </v-tab> -->
              <v-tab id="detection_tuningTab" href="#tuning">
                <v-icon left>fa-wrench</v-icon>
                <div class="d-none d-lg-block">Tuning</div>
              </v-tab>
              <v-tab id="detection_historyTab" href="#history">
                <v-icon left>fa-history</v-icon>
                <div class="d-none d-lg-block">History</div>
              </v-tab>

              <v-tab-item value="summary">
                <div class="col pt-5" style="background-color: rgb(53, 53, 53); border-radius: 4px;">
                  <div>
                    <!-- Description -->
                    <span class="font-weight-bold">{{i18n.description}}:</span><br/>
                    <span id="detection-description" @click="startEdit('detection-description', 'description')" v-if="!isEdit('detection-description')">{{ detect.description }}</span>
                    <v-textarea id="detection-description-edit" v-else hide-details="auto" outlined v-model="detect.description" :rules="requestRules([rules.required])" persistent-hint :hint="i18n.detectionDescription" v-on:keyup.enter="stopEdit(true)" v-on:keyup.esc="stopEdit(false)" auto-grow rows="5"></v-textarea>
                  </div>
                  <!-- Engine -->
                  <v-select id="detection-engine-edit" v-model="detect.engine" :readonly="detect.isCommunity" :items="getPresets('engine')" persistent-hint :hint="i18n.engine" @change="stopEdit(true)" v-on:keyup.esc="stopEdit(false)"/>
                  <!-- Author -->
                  <v-text-field id="detection-author-edit" v-model="detect.author" :readonly="detect.isCommunity" :rules="requestRules([rules.required])" persistent-hint :hint="i18n.author" v-on:keyup.enter="stopEdit(true)" v-on:keyup.esc="stopEdit(false)"></v-text-field>
                  <!-- Severity -->
                  <v-select id="detection-severity-edit" class="text-capitalize" :readonly="detect.isCommunity" v-model="detect.severity" :items="getPresets('severity')" persistent-hint :hint="i18n.severity" @change="stopEdit(true)" v-on:keyup.esc="stopEdit(false)"/>
                  <!-- Enabled -->
                  <v-checkbox id="detection-enabled-edit" v-model="detect.isEnabled" @change="stopEdit(true)" :label="i18n.detectionEnabled"/>
                  <!-- Reporting -->
                  <v-checkbox id="detection-reporting-edit" v-model="detect.isReporting" @change="stopEdit(true)" :label="i18n.reporting"/>
                </div>
                <div class="d-flex justify-end text-body-2 mt-2">
                  <div class="d-inline-flex justify-end">
                    <v-btn v-if="!isNew()" id="detection-duplicate" text small color="primary" class="align-self-end" @click="duplicateDetection()">
                      {{i18n.duplicate}}
                    </v-btn>
                    <v-btn v-if="!isNew() && !detect.isCommunity" id="detection-delete" text small color="error" class="align-self-end" @click="deleteDetection()">
                      {{i18n.delete}}
                    </v-btn>
                  </div>
                </div>
              </v-tab-item>
              <v-tab-item value="signature">
                <div class="col" style="background-color: rgb(53, 53, 53); border-radius: 4px;">
                  <!-- PublicID -->
                  <v-text-field id="detection-publicId-edit" v-model="detect.publicId" :readonly="detect.isCommunity" :rules="requestRules([rules.required, rules.minLength(5)])" persistent-hint :hint="i18n.publicID" v-on:keyup.enter="stopEdit(true)" v-on:keyup.esc="stopEdit(false)">
                    <template v-slot:append v-if="!detect.publicId && !detect.isCommunity">
                      <v-btn id="gen-public-id" text small color="primary" @click="extractPublicID()">{{i18n.extract}}</v-btn>
                    </template>
                  </v-text-field>
                  <!-- Signature -->
                  <v-textarea class="config-editor mt-2" :readonly="detect.isCommunity" outlined v-model="detect.content" auto-grow rows="15" />
                </div>
                <div class="d-flex align-center align-self-end justify-end text-body-2 mt-2">
                  <div class="d-inline-flex justify-end">
                    <v-btn id="detection-cancel" text small color="primary" class="align-self-end" @click="cancelDetection()">
                      {{ i18n.cancel }}
                    </v-btn>
                    <v-btn id="detection-update" v-if="!detect.isCommunity" text small color="primary" class="align-self-end" @click="saveDetection(false)">
                      {{i18n.update}}
                    </v-btn>
                  </div>
                </div>
              </v-tab-item>
              <v-tab-item value="notes">
                <div class="col" style="background-color: rgb(53, 53, 53); border-radius: 4px;">
                  <!-- Notes -->
                  <v-textarea class="config-editor" outlined v-model="detect.note" auto-grow rows="15" />
                </div>
                <div class="d-flex align-center align-self-end justify-end text-body-2 mt-2">
                  <div class="d-inline-flex justify-end">
                    <v-btn id="detection-cancel" text small color="primary" class="align-self-end" @click="cancelDetection()">
                      {{ i18n.cancel }}
                    </v-btn>
                    <v-btn id="detection-update" text small color="primary" class="align-self-end" @click="saveDetection(false)">
                      {{i18n.update}}
                    </v-btn>
                  </div>
                </div>
              </v-tab-item>
              <!-- <v-tab-item value="playbook">
                <div class="col pa-2" style="background-color: rgb(53, 53, 53); border-radius: 4px;">
                  <div class="col ma-2">
                    <div class="row my-2">
                      <span class="font-weight-bold">Title:&nbsp;</span>
                      <a :href="'#/playbook/' + associatedPlaybook.onionId" style="text-decoration: none; cursor: 'pointer'">
                        {{associatedPlaybook.title}}
                      </router-link>
                    </div>
                    <div class="row my-2">
                      <span class="font-weight-bold">Description:&nbsp;</span>{{associatedPlaybook.description}}
                    </div>
                    <div class="row my-2">
                      <span class="font-weight-bold">Severity:&nbsp;</span>{{associatedPlaybook.severity}}
                    </div>
                  </div>
                </div>
              </v-tab-item> -->
              <v-tab-item value="tuning">
                <div class="col" style="background-color: rgb(53, 53, 53); border-radius: 4px;">
                  <v-col v-if="canAddOverride()" cols="12" style="padding-left: 0px; padding-right: 0px;">
                    <v-toolbar class="elevation-0" fixed>
                      <v-btn color="primary" id="add-override-button" style="text-decoration: none; cursor: 'pointer'" @click="createNewOverride()">
                        <v-icon :title="i18n.create">fa-plus</v-icon>
                      </v-btn>
                    </v-toolbar>
                    <div v-if="newOverride != null">
                      <v-form ref="OverrideCreate">
                        <v-select id="new-override-type" v-model="newOverride.type" :items="getOverrideTypes()" persistent-hint :hint="i18n.type" @change="createOverrideTypeChange()"></v-select>
                        <!--
                          1. Regex   - modify
                          2. Value   - modify
                          3. Type    - threshold
                          3. Track   - suppress, threshold
                          4. IP      - suppress
                          5. Count   - threshold
                          6. Seconds - threshold
                          7. Custom Filter - engine:elastalert
                        -->
                        <!-- Suricata -->
                        <div v-if="detect.engine === 'suricata'">
                          <!-- regex -->
                          <v-text-field v-if="newOverride.type === 'modify'" id="new-override-regex-edit" v-model="newOverride.regex" :rules="[rules.required]" persistent-hint :hint="i18n.regex"></v-text-field>
                          <!-- value -->
                          <v-text-field v-if="newOverride.type === 'modify'" id="new-override-value-edit" v-model="newOverride.value" :rules="[rules.required]" persistent-hint :hint="i18n.value"></v-text-field>
                          <!-- (threshold) type -->
                          <v-select v-if="newOverride.type === 'threshold'" id="new-override-threshold-type-edit" v-model="newOverride.thresholdType" :items="thresholdTypes" :rules="[rules.required]" persistent-hint :hint="i18n.thresholdType"></v-select>
                          <!-- track -->
                          <v-select v-if="['threshold', 'suppress'].includes(newOverride.type)" id="new-override-track-edit" v-model="newOverride.track" :items="trackOptions" :rules="[rules.required]" persistent-hint :hint="i18n.track"></v-select>
                          <!-- ip -->
                          <v-text-field v-if="newOverride.type === 'suppress'" id="new-override-ip-edit" v-model="newOverride.ip" :rules="[rules.required, rules.cidrFormat]" persistent-hint :hint="i18n.ipCidr"></v-text-field>
                          <!-- count -->
                          <v-text-field v-if="newOverride.type === 'threshold'" id="new-override-count-edit" v-model="newOverride.count" :rules="[rules.required, rules.number]" persistent-hint :hint="i18n.count"></v-text-field>
                          <!-- seconds -->
                          <v-text-field v-if="newOverride.type === 'threshold'" id="new-override-seconds-edit" v-model="newOverride.seconds" :rules="[rules.required, rules.number]" persistent-hint :hint="i18n.secondsLabel"></v-text-field>
                        </div>
                        <!-- ElastAlert -->
                        <div v-if="detect.engine === 'elastalert'">
                          <!-- custom filter -->
                          <v-text-field id="new-override-custom-filter-edit" v-model="newOverride.customFilter" :rules="[rules.required]" persistent-hint :hint="i18n.customFilter"></v-text-field>
                        </div>
                        <div v-if="newOverride" class="d-flex justify-end text-body-2 mt-2">
                          <div class="d-inline-flex">
                            <v-btn id="detection-create-cancel" text small color="primary" class="align-self-end" @click="newOverride = null">
                              {{ i18n.cancel }}
                            </v-btn>
                            <v-btn v-if="newOverride.type" id="detection-create-create" text small color="primary" class="align-self-end" @click="addNewOverride()">
                              {{ i18n.create }}
                            </v-btn>
                          </div>
                        </div>
                      </v-form>
                    </div>
                  </v-col>
                  <v-data-table :sort-by.sync="sortBy" :expanded.sync="expanded" :sort-desc.sync="sortDesc" must-sort :headers="overrideHeaders"
                    :items="detect.overrides" item-value="index" show-expand single-expand :custom-sort="sortOverrides" hide-default-footer="true">
                    <template v-slot:item="{ item, index }">
                      <tr>
                        <td>
                          <v-btn id="expandOverrideArrow" icon small @click="expand(item)">
                            <v-icon v-if="isExpanded(item)" :alt="i18n.overrideExpand" :title="i18n.eventExpandHelp">fa-angle-down</v-icon>
                            <v-icon v-if="!isExpanded(item)" :alt="i18n.overrideExpand" :title="i18n.eventExpandHelp">fa-angle-right</v-icon>
                          </v-btn>
                        </td>
                        <td v-for="field in overrideHeaders" :key="field.value">
                          <div class="d-inline-block">
                            <span v-if="!field.format">{{ item[field.value] }}</span>
                            <span v-else v-text="$root.formatLocalTimestamp(item[field.value], zone)"/>
                          </div>
                        </td>
                      </tr>
                    </template>
                    <template v-slot:expanded-item="{ headers, item }">
                      <tr>
                        <td :colspan="headers.length" class="pa-4" v-if="detect.engine === 'suricata'">
                          <!--
                            1. Regex   - modify
                            2. Value   - modify
                            3. Type    - threshold
                            3. Track   - suppress, threshold
                            4. IP      - suppress
                            5. Count   - threshold
                            6. Seconds - threshold
                            7. Custom Filter - engine:elastalert
                          -->
                          <!-- isEnabled -->
                          <div>
                            <div class="font-weight-bold mt-4">
                              {{i18n.enabled}}:
                            </div>
                            <span id="override-enabled" v-if="!isOverrideEdit('override-enabled')" @click="startOverrideEdit('override-enabled', item, 'isEnabled')">
                              {{item.isEnabled}}
                            </span>
                            <v-checkbox v-else id="override-enabled-edit" ref="override-enabled" hide-details="auto" outlined v-model="item.isEnabled"
                              persistent-hint :hint="i18n.enabled" v-on:change="stopOverrideEdit(true)"></v-checkbox>
                          </div>
                          <!-- regex -->
                          <div v-if="item.type === 'modify'">
                            <div class="font-weight-bold mt-4">
                              Regex:
                            </div>
                            <span id="override-regex" v-if="!isOverrideEdit('override-regex')" @click="startOverrideEdit('override-regex', item, 'regex')">
                              {{item.regex}}
                            </span>
                            <v-text-field v-else id="override-regex-edit" ref="override-regex" hide-details="auto" outlined v-model="item.regex" :rules="[rules.required]"
                              persistent-hint :hint="i18n.regex" v-on:keyup.enter="stopOverrideEdit(true)" v-on:keyup.esc="stopOverrideEdit(false)"></v-text-field>
                          </div>
                          <!-- value -->
                          <div v-if="item.type === 'modify'">
                            <div class="font-weight-bold mt-4">
                              Value:
                            </div>
                            <span id="override-value" v-if="!isOverrideEdit('override-value')" @click="startOverrideEdit('override-value', item, 'value')">
                              {{item.value}}
                            </span>
                            <v-text-field v-else id="override-value-edit" ref="override-value" hide-details="auto" outlined v-model="item.value" :rules="[rules.required]"
                              persistent-hint :hint="i18n.value" v-on:keyup.enter="stopOverrideEdit(true)" v-on:keyup.esc="stopOverrideEdit(false)"></v-text-field>
                          </div>
                          <!-- type (threshold) -->
                          <div v-if="item.type === 'threshold'">
                            <div class="font-weight-bold mt-4">
                              Type:
                            </div>
                            <span id="override-threshold-type" v-if="!isOverrideEdit('override-threshold-type')" @click="startOverrideEdit('override-threshold-type', item, 'thresholdType')">
                              {{item.thresholdType}}
                            </span>
                            <v-select v-else id="override-threshold-type-edit" ref="override-threshold-type" v-model="item.thresholdType" :items="thresholdTypes" :rules="[rules.required]" persistent-hint :hint="i18n.type" @change="stopOverrideEdit(true)"></v-select>
                          </div>
                          <!-- track -->
                          <div v-if="['suppress', 'threshold'].includes(item.type)">
                            <div class="font-weight-bold mt-4">
                              Track:
                            </div>
                            <span id="override-track" v-if="!isOverrideEdit('override-track')" @click="startOverrideEdit('override-track', item, 'track')">
                              {{item.track}}
                            </span>
                            <v-select v-else id="override-track-edit" ref="override-track" v-model="item.track" :items="trackOptions" :rules="[rules.required]" persistent-hint :hint="i18n.type" @change="stopOverrideEdit(true)"></v-select>
                          </div>
                          <!-- ip -->
                          <div v-if="item.type === 'suppress'">
                            <div class="font-weight-bold mt-4">
                              IP:
                            </div>
                            <span id="override-ip" v-if="!isOverrideEdit('override-ip')" @click="startOverrideEdit('override-ip', item, 'ip')">
                              {{item.ip}}
                            </span>
                            <v-text-field v-else id="override-ip-edit" ref="override-ip" hide-details="auto" outlined v-model="item.ip" :rules="[rules.required, rules.ciderFormat]"
                              persistent-hint :hint="i18n.cidr" v-on:keyup.enter="stopOverrideEdit(true)" v-on:keyup.esc="stopOverrideEdit(false)"></v-text-field>
                          </div>
                          <!-- count -->
                          <div v-if="item.type === 'threshold'">
                            <div class="font-weight-bold mt-4">
                              Count:
                            </div>
                            <span id="override-count" v-if="!isOverrideEdit('override-count')" @click="startOverrideEdit('override-count', item, 'count')">
                              {{item.count}}
                            </span>
                            <v-text-field v-else id="override-count-edit" ref="override-count" hide-details="auto" outlined v-model="item.count" :rules="[rules.required, rules.number]"
                              persistent-hint :hint="i18n.count" v-on:keyup.enter="stopOverrideEdit(true)" v-on:keyup.esc="stopOverrideEdit(false)"></v-text-field>
                          </div>
                          <!-- seconds -->
                          <div v-if="item.type === 'threshold'">
                            <div class="font-weight-bold mt-4">
                              Seconds:
                            </div>
                            <span id="override-seconds" v-if="!isOverrideEdit('override-seconds')" @click="startOverrideEdit('override-seconds', item, 'seconds')">
                              {{item.seconds}}
                            </span>
                            <v-text-field v-else id="override-seconds-edit" ref="override-seconds" hide-details="auto" outlined v-model="item.seconds" :rules="[rules.required, rules.number]"
                              persistent-hint :hint="i18n.secondsLabel" v-on:keyup.enter="stopOverrideEdit(true)" v-on:keyup.esc="stopOverrideEdit(false)"></v-text-field>
                          </div>
                          <div class="d-flex justify-end text-body-2 mt-4">
                            <div class="d-inline-flex">
                              <v-btn id="override-edit-delete" text small color="red" @click="deleteOverride(item)">
                                {{ i18n.delete }}
                              </v-btn>
                            </div>
                          </div>
                        </td>
                        <td :colspan="headers.length" class="pa-4" v-else-if="detect.engine === 'elastalert'">
                          <!-- isEnabled -->
                          <div>
                            <div class="font-weight-bold mt-2">
                              {{i18n.enabled}}:
                            </div>
                            <span id="override-enabled" v-if="!isOverrideEdit('override-enabled')" @click="startOverrideEdit('override-enabled', item, 'isEnabled')">
                              {{item.isEnabled}}
                            </span>
                            <v-checkbox v-else id="override-enabled-edit" ref="override-enabled" hide-details="auto" outlined v-model="item.isEnabled"
                              persistent-hint :hint="i18n.enabled" @change="stopOverrideEdit(true, $event)"></v-checkbox>
                          </div>
                          <!-- custom filter -->
                          <div>
                            <div class="font-weight-bold mt-2">
                              Custom Filter:
                            </div>
                            <span id="override-custom-filter" v-if="!isOverrideEdit('override-custom-filter')" @click="startOverrideEdit('override-custom-filter', item, 'customFilter')">
                              {{item.customFilter}}
                            </span>
                            <v-text-field v-else id="override-custom-filter-edit" ref="override-custom-filter" hide-details="auto" outlined v-model="item.customFilter" :rules="[rules.required]"
                              persistent-hint :hint="i18n.customFilter" v-on:keyup.enter="stopOverrideEdit(true)" v-on:keyup.esc="stopOverrideEdit(false)"></v-text-field>
                          </div>
                          <div class="d-flex justify-end text-body-2 mt-2">
                            <div class="d-inline-flex">
                              <v-btn id="override-edit-delete" text small color="red" @click="deleteOverride(item)">
                                {{ i18n.delete }}
                              </v-btn>
                            </div>
                          </div>
                        </td>
                        <td :colspan="headers.length" class="pa-4" v-else-if="detect.engine === 'yara'"></td>
                      </tr>
                    </template>
                  </v-data-table>
                </div>
              </v-tab-item>
              <v-tab-item value="history">
                <div class="col" style="background-color: rgb(53, 53, 53); border-radius: 4px;">
                  Coming Soon!
                </div>
              </v-tab-item>
            </v-tabs>
          </div>
          <div class="col-md-3 order-md-2 col-12 order-1">
            <v-expansion-panels focusable multiple v-model="panel">
              <v-expansion-panel v-if="!isNew()">
                <v-expansion-panel-header id="detection-related-playbooks">
                  <h3>Cases</h3>
                </v-expansion-panel-header>
                <v-expansion-panel-content>
                  Related Cases:
                  <ul>
                    <li>123</li>
                    <li>456</li>
                    <li>ABC</li>
                    <li>XYZ</li>
                  </ul>
                </v-expansion-panel-content>
              </v-expansion-panel>
              <v-expansion-panel v-if="!isNew()">
                <v-expansion-panel-header id="detection-related-playbooks">
                  <h3>Alerts</h3>
                </v-expansion-panel-header>
                <v-expansion-panel-content>
                  Recent Alerts:
                  <ul>
                    <li>123</li>
                    <li>456</li>
                    <li>ABC</li>
                    <li>XYZ</li>
                  </ul>
                </v-expansion-panel-content>
              </v-expansion-panel>
            </v-expansion-panels>
          </div>
        </div>
      </v-container>
    </script>

    <script type="text/x-template" id="page-playbook">
      <v-container fluid v-if="playbook">
        <div class="mx-sm-12 mx-lg-6 mt-2 mb-6 mb-md-1">
          <!-- Title -->
          <h2 id="playbook-title" @click="startEdit('playbook-title', 'title')" v-if="!isEdit('playbook-title')">{{ playbook.title }}</h2>
          <v-text-field id="playbook-title-edit" v-else hide-details="auto" outlined v-model="playbook.title" :rules="[rules.required]" persistent-hint :hint="i18n.playbookTitle" v-on:keyup.enter="stopEdit(true)" v-on:keyup.esc="stopEdit(false)"></v-text-field>
        </div>

        <div class="row mb-6 mb-md-1 mt-2 mx-lg-6 mx-sm-12">
          <!-- Description -->
          <span id="playbook-description" @click="startEdit('playbook-description', 'description')" v-if="!isEdit('playbook-description')">{{ playbook.description }}</span>
          <v-textarea id="playbook-description-edit" v-else hide-details="auto" outlined v-model="playbook.description" :rules="[rules.required]" persistent-hint :hint="i18n.playbookDescription" v-on:keyup.enter="stopEdit(true)" v-on:keyup.esc="stopEdit(false)" auto-grow rows="5"></v-textarea>
        </div>

        <div class="row mx-sm-8 mx-md-12 mx-lg-4 flex-column flex-md-row">
          <div class="main col-md-9 order-md-1 col-12 order-2">
            <v-tabs grow v-model="activeTab">
              <v-tab id="playbook_notesTab" href="#notes">
                <v-icon left>fa-comments</v-icon>
                <div class="d-none d-lg-block">Observational Notes</div>
              </v-tab>
              <v-tab id="playbook_questionsTab" href="#questions">
                <v-icon left>fa-circle-question</v-icon>
                <div class="d-none d-lg-block">Investigative Questions</div>
              </v-tab>
              <v-tab id="playbook_casesTab" href="#cases">
                <v-icon left>fa-briefcase</v-icon>
                <div class="d-none d-lg-block">Cases</div>
              </v-tab>
              <v-tab id="playbook_historyTab" href="#history">
                <v-icon left>fa-history</v-icon>
                <div class="d-none d-lg-block">{{ i18n.history }}</div>
              </v-tab>

              <v-tab-item value="notes">
                <div class="col pt-0" style="background-color: rgb(53, 53, 53); border-radius: 4px;">
                  <!-- PublicID -->
                  <v-text-field id="playbook-publicId-edit" v-model="playbook.publicId" :rules="[rules.required]" persistent-hint :hint="i18n.publicID" v-on:keyup.enter="stopEdit(true)" v-on:keyup.esc="stopEdit(false)">
                    <template v-slot:append v-if="!playbook.publicId">
                      <v-btn id="gen-public-id" text small color="primary" @click="generatePublicID()">Generate</v-btn>
                    </template>
                  </v-text-field>
                  <!-- Contributors -->
                  <v-combobox id="playbook-contributors" v-model="playbook.contributors" persistent-hint :hint="i18n.contributors" multiple>
                    <template #selection="{ item }">
                      <v-chip color="primary">{{item}}</v-chip>
                    </template>
                  </v-combobox>

                  <!-- Severity -->
                  <v-select id="playbook-severity-edit" v-model="playbook.severity" :items="severityOptions" persistent-hint :hint="i18n.severity" @change="stopEdit(true)" v-on:keyup.esc="stopEdit(false)"/>

                  <!-- Mechanism -->
                  <v-select id="playbook-engine-edit" v-model="playbook.mechanism" :items="engineOptions" persistent-hint :hint="i18n.playbookMechanism" @change="stopEdit(true)" v-on:keyup.esc="stopEdit(false)"/>

                  <!-- Tags -->
                  <v-combobox id="playbook-tags" v-model="playbook.tags" :items="tags" persistent-hint :hint="i18n.caseTagsHelp" multiple>
                    <template #selection="{ item }">
                      <v-chip color="primary">{{item}}</v-chip>
                    </template>
                  </v-combobox>

                  <!-- IsCommunity -->
                  <div class="my-3">
                    <span class="font-weight-bold">Community Playbook:</span> {{ playbook.userEditable ? 'No' : 'Yes' }}
                  </div>
                  <div class="row">
                    <div class="col">
                      <!-- Content -->
                      <span class="font-weight-bold">Note:</span>
                      <v-textarea class="config-editor" outlined v-model="playbook.note" auto-grow rows="5" />
                    </div>
                  </div>
                </div>
                <div class="d-flex align-center align-self-end text-body-2 mt-2">
                  <div class="d-inline-flex justify-end">
                    <v-btn id="playbook-cancel" text small color="primary" class="align-self-end" @click="cancelPlaybook()">
                      {{ i18n.cancel }}
                    </v-btn>
                    <v-btn id="playbook-create" text small color="primary" class="align-self-end" @click="savePlaybook(true)" v-if="isNew()">
                      {{ i18n.create }}
                    </v-btn>
                    <v-btn id="playbook-update" text small color="primary" class="align-self-end" @click="savePlaybook(false)" v-else>
                      {{ i18n.update }}
                    </v-btn>
                  </div>
                </div>
              </v-tab-item>

              <v-tab-item value="questions">
                <div class="col pt-0" style="background-color: rgb(53, 53, 53); border-radius: 4px;">
                  <h2>Add Investigative Question</h2>
                  <v-text-field id="playbook-question-add" v-model="addQuestion" persistent-hint :hint="i18n.playbookQuestionHint"></v-text-field>
                  <v-text-field id="playbook-context-add" v-model="addContext" persistent-hint :hint="i18n.playbookAddContext"></v-text-field>
                  <v-combobox id="playbook-datasources-add" v-model="addDataSources" persistent-hint :hint="i18n.playbookDatasources" multiple>
                    <template #selection="{ item }">
                      <v-chip color="primary">{{item}}</v-chip>
                    </template>
                  </v-combobox>

                  <v-btn id="playbook-add-question" color="primary" class="mt-2" @click="appendQuestion()">
                    Add
                  </v-btn>
                </div>

                <v-text-field v-model="search" clearable prepend-icon="fa-filter" :label="i18n.filterResults" single-line></v-text-field>
                <div v-for="q in playbook.questions" class="col px-5 py-2" style="background-color: rgb(40, 40, 40); border-radius: 4px;">
                  <div class="font-italic my-2">{{q.question}}</div>
                  <div class="my-2"><span class="font-weight-bold">Context:</span> {{ q.context }}</div>
                  <div class="my-2"><span class="font-weight-bold">Data Sources:</span> {{ q.dataSources.join(', ') }}</div>
                  <div class="my-2">
                    <div><span class="font-weight-bold">Query:</span> {{ q.query }}</div>
                    <v-data-table v-if="q.query" :headers="questionHeaders" :items="q.results">
                      <template v-slot:item="result">
                        <tr>
                          <td v-text="result.item.payload['@timestamp']"></td>
                          <td v-text="result.item.payload['@version']"></td>
                          <td v-text="result.item.payload['message']"></td>
                        </tr>
                      </template>
                    </v-data-table>
                  </div>
                </div>
              </v-tab-item>
              <v-tab-item value="cases">
                Coming Soon!
              </v-tab-item>
              <v-tab-item value="history">
                Coming Soon!
              </v-tab-item>
            </v-tabs>
          </div>
          <div class="col-md-3 order-md-2 col-12 order-1">
            <v-expansion-panels focusable multiple v-model="panel">
              <v-expansion-panel v-if="!isNew()">
                <v-expansion-panel-header id="playbook-related-playbooks">
                  <h3>Playbooks</h3>
                </v-expansion-panel-header>
                <v-expansion-panel-content>
                  Related Playbooks:
                  <ul>
                    <li>123</li>
                    <li>456</li>
                    <li>ABC</li>
                    <li>XYZ</li>
                  </ul>
                </v-expansion-panel-content>
              </v-expansion-panel>
              <v-expansion-panel v-if="!isNew()">
                <v-expansion-panel-header id="detection-related-playbooks">
                  <h3>Alerts</h3>
                </v-expansion-panel-header>
                <v-expansion-panel-content>
                  Recent Alerts:
                  <ul>
                    <li>123</li>
                    <li>456</li>
                    <li>ABC</li>
                    <li>XYZ</li>
                  </ul>
                </v-expansion-panel-content>
              </v-expansion-panel>
            </v-expansion-panels>
          </div>
        </div>
      </v-container>
    </script>

    <script type="text/x-template" id="page-terms">
      <v-container fluid>
        <v-row>
          <v-col>
            <h2 v-text="i18n.licensing"></h2>
          </v-col>
        </v-row>
        <v-row>
          <v-col>
            <v-tabs v-model="tab">

              <v-tab id="license_key" href="#key">
                <v-icon left>fa-key</v-icon>
                {{ i18n.licenseKey }}
              </v-tab>
              <v-tab id="license_terms" href="#terms">
                <v-icon left>fa-file-lines</v-icon>
                {{ i18n.licenseTerms }}
              </v-tab>

              <v-tab-item value="key">
                <v-card outlined class="my-2 pt-2 pb-10">
                  <v-card-title>
                    <span class="mr-2">
                      {{ i18n.licenseKey }}
                    </span>
                    <router-link v-if="$root.isUserAdmin()" :to="{ name: 'config', query: {s: 'soc.config.licenseKey'}}" style="text-decoration: none; cursor: 'pointer'">
                      <v-btn icon>
                        <v-icon class="mx-2" :title="i18n.view">fa-pencil</v-icon>
                      </v-btn>
                    </router-link>
                  </v-card-title>
                  <v-card-text>
                    <v-container v-if="$root.licenseKey" fluid id="licenseDetails" class="float-left">
                      <v-row class="my-1">
                        <v-col cols="3" class="pa-1 text-right font-weight-bold">{{ i18n.licenseStatus }}:</v-col>
                        <v-col cols="9" class="px-1 py-0">
                          <v-chip small :color="$root.colorLicenseStatus($root.licenseStatus)">
                            {{ $root.localizeMessage($root.licenseStatus) }}
                          </v-chip>
                        </v-col>
                      </v-row>
                      <span v-if="$root.licenseKey && ($root.licenseStatus != LICENSE_STATUS_UNPROVISIONED && $root.licenseStatus != LICENSE_STATUS_INVALID)">
                        <v-row class="my-1">
                          <v-col cols="3" class="pa-1 text-right font-weight-bold text-no-wrap">{{ i18n.licenseId }}:</v-col>
                          <v-col cols="9" class="pa-1">{{ $root.licenseKey.id }}</v-col>
                        </v-row>
                        <v-row class="my-1">
                          <v-col cols="3" class="pa-1 text-right font-weight-bold text-no-wrap">{{ i18n.licenseName }}:</v-col>
                          <v-col cols="9" class="pa-1">{{ $root.licenseKey.name }}</v-col>
                        </v-row>
                        <v-row class="my-1">
                          <v-col cols="3" class="pa-1 text-right font-weight-bold text-no-wrap">{{ i18n.licensee }}:</v-col>
                          <v-col cols="9" class="pa-1">{{ $root.licenseKey.licensee }}</v-col>
                        </v-row>
                        <v-row class="my-1">
                          <v-col cols="3" class="pa-1 text-right font-weight-bold text-no-wrap">{{ i18n.licenseEffective }}:</v-col>
                          <v-col cols="9" class="pa-1">{{ $root.licenseKey.effective | formatDateTime }}</v-col>
                        </v-row>
                        <v-row class="my-1">
                          <v-col cols="3" class="pa-1 text-right font-weight-bold text-no-wrap">{{ i18n.licenseExpiration }}:</v-col>
                          <v-col cols="9" class="pa-1">{{ $root.licenseKey.expiration | formatDateTime }}</v-col>
                        </v-row>
                      </span>
                    </v-container>
                    <v-container v-if="$root.licenseKey && ($root.licenseStatus != LICENSE_STATUS_UNPROVISIONED && $root.licenseStatus != LICENSE_STATUS_INVALID)" fluid id="licenseDetails" class="float">
                      <v-row class="my-1">
                        <v-col cols="3" class="pa-1 text-right font-weight-bold text-no-wrap">{{ i18n.userLimit }}:</v-col>
                        <v-col v-if="$root.licenseKey.users > 0" cols="9" class="pa-1">{{ $root.licenseKey.users }}</v-col>
                        <v-col v-else cols="9" class="pa-1">{{ i18n.unlimited }}</v-col>
                      </v-row>
                      <v-row class="my-1">
                        <v-col cols="3" class="pa-1 text-right font-weight-bold text-no-wrap">{{ i18n.nodeLimit }}:</v-col>
                        <v-col v-if="$root.licenseKey.nodes > 0" cols="9" class="pa-1">{{ $root.licenseKey.nodes }}</v-col>
                        <v-col v-else cols="9" class="pa-1">{{ i18n.unlimited }}</v-col>
                      </v-row>
                      <v-row class="my-1">
                        <v-col cols="3" class="pa-1 text-right font-weight-bold text-no-wrap">{{ i18n.socUrl }}:</v-col>
                        <v-col v-if="$root.licenseKey.socUrl" cols="9" class="pa-1">{{ $root.licenseKey.socUrl }}</v-col>
                        <v-col v-else cols="9" class="pa-1">{{ i18n.unlocked }}</v-col>
                      </v-row>
                      <v-row class="my-1">
                        <v-col cols="3" class="pa-1 text-right font-weight-bold text-no-wrap">{{ i18n.dataUrl }}:</v-col>
                        <v-col v-if="$root.licenseKey.dataUrl" cols="9" class="pa-1">{{ $root.licenseKey.dataUrl }}</v-col>
                        <v-col v-else cols="9" class="pa-1">{{ i18n.unlocked }}</v-col>
                      </v-row>
                      <v-row class="my-1">
                        <v-col cols="3" class="pa-1 text-right font-weight-bold text-no-wrap">{{ i18n.features }}:</v-col>
                        <v-col v-if="$root.licenseKey.features" cols="9" class="pa-1">
                          <v-chip v-for="feature in $root.licenseKey.features" small class="mx-1">
                            {{ $root.localizeMessage(feature) }}
                          </v-chip>
                        </v-col>
                        <v-col v-else cols="9" class="pa-1">{{ i18n.all }}</v-col>
                      </v-row>
                    </v-container>
                  </v-card-text>
                </v-card>
              </v-tab-item>

              <v-tab-item value="terms">
                <v-card outlined class="my-4">
                  <v-card-text>
                    <div class="text-h5 mt-8 mb-3 grey--text">
                      Elastic License 2.0 (ELv2) Terms
                    </div>

                    <div class="text-h6 mt-8 mb-3">
                      Acceptance
                    </div>
                    By using the software, you agree to all of the terms and conditions below.

                    <div class="text-h6 mt-8 mb-3">
                      Copyright License
                    </div>
                    The licensor grants you a non-exclusive, royalty-free, worldwide, non-sublicensable, non-transferable license to use, copy, distribute, make available, and prepare derivative works of the software, in each case subject to the limitations and conditions below.

                    <div class="text-h6 mt-8 mb-3">
                      Limitations
                    </div>
                    You may not provide the software to third parties as a hosted or managed service, where the service provides users with access to any substantial set of the features or functionality of the software.
                    <p class="mb-3" />
                    You may not move, change, disable, or circumvent the license key functionality in the software, and you may not remove or obscure any functionality in the software that is protected by the license key.
                    <p class="mb-3" />
                    You may not alter, remove, or obscure any licensing, copyright, or other notices of the licensor in the software. Any use of the licensor’s trademarks is subject to applicable law.

                    <div class="text-h6 mt-8 mb-3">
                      Patents
                    </div>
                    The licensor grants you a license, under any patent claims the licensor can license, or becomes able to license, to make, have made, use, sell, offer for sale, import and have imported the software, in each case subject to the limitations and conditions in this license. This license does not cover any patent claims that you cause to be infringed by modifications or additions to the software. If you or your company make any written claim that the software infringes or contributes to infringement of any patent, your patent license for the software granted under these terms ends immediately. If your company makes such a claim, your patent license ends immediately for work on behalf of your company.

                    <div class="text-h6 mt-8 mb-3">
                      Notices
                    </div>
                    You must ensure that anyone who gets a copy of any part of the software from you also gets a copy of these terms.
                    <p class="mb-3" />
                    If you modify the software, you must include in any modified copies of the software prominent notices stating that you have modified the software.

                    <div class="text-h6 mt-8 mb-3">
                      No Other Rights
                    </div>
                    These terms do not imply any licenses other than those expressly granted in these terms.

                    <div class="text-h6 mt-8 mb-3">
                      Termination
                    </div>
                    If you use the software in violation of these terms, such use is not licensed, and your licenses will automatically terminate. If the licensor provides you with a notice of your violation, and you cease all violation of this license no later than 30 days after you receive that notice, your licenses will be reinstated retroactively. However, if you violate these terms after such reinstatement, any additional violation of these terms will cause your licenses to terminate automatically and permanently.

                    <div class="text-h6 mt-8 mb-3">
                      No Liability
                    </div>
                    <b><i>As far as the law allows, the software comes as is, without any warranty or condition, and the licensor will not be liable to you for any damages arising out of these terms or the use or nature of the software, under any kind of legal claim.</i></b>

                    <div class="text-h6 mt-8 mb-3">
                      Definitions
                    </div>
                    The <b>licensor</b> is the entity offering these terms, and the <b>software</b> is the software the licensor makes available under these terms, including any portion of it.
                    <p class="mb-3" />
                    <b>you</b> refers to the individual or entity agreeing to these terms.
                    <p class="mb-3" />
                    <b>your company</b> is any legal entity, sole proprietorship, or other kind of organization that you work for, plus all organizations that have control over, are under the control of, or are under common control with that organization. <b>control</b> means ownership of substantially all the assets of an entity, or the power to direct its management and policies by vote, contract, or otherwise. Control can be direct or indirect.
                    <p class="mb-3" />
                    <b>your licenses</b> are all the licenses granted to you for the software under these terms.
                    <p class="mb-3" />
                    <b>use</b> means anything you do with the software requiring one of your licenses.
                    <p class="mb-3" />
                    <b>trademark</b> means trademarks, service marks, and similar rights.
                  </v-card-text>
                </v-card>
              </v-tab-item>
            </v-tabs>
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-downloads">
      <v-container fluid>
        <v-row>
          <v-col>
            <h2 v-text="i18n.downloads"></h2>
          </v-col>
        </v-row>
        <v-row>
          <v-col>
            <h3 class="my-2" v-text="i18n.downloadsElasticAgent" id="download-elasticagent"></h3>
            <v-alert v-if="remoteAgentSupported" id="firewallTip" type="info" v-html="i18n.downloadsFirewallTip"></v-alert>
            <v-alert v-else type="error" id="agentUnavailable" v-html="i18n.downloadsAgentUnavailable"></v-alert>
            <ul id="installer-list">
              <li><a href="/packages/so-elastic-agent_windows_amd64" download="so-elastic-agent_windows_amd64.exe">Windows x86_64 Installer</a></li>
              <li><a href="/packages/so-elastic-agent_linux_amd64" download="so-elastic-agent_linux_amd64">Linux x86_64 Installer</a></li>
              <li><a href="/packages/so-elastic-agent_darwin_amd64" download="so-elastic-agent_darwin_amd64">macOS x86_64 Installer</a></li>
              <li><a href="/packages/so-elastic-agent_darwin_arm64" download="so-elastic-agent_darwin_arm64">macOS arm64 Installer</a></li>
            </ul>
            <p></p>
            <div v-html="i18n.downloadsInfo"></div>
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-users">
      <v-container fluid>
        <v-row>
          <v-col cols="12" lg="3">
            <h2 v-text="i18n.users"></h2>
          </v-col>
          <v-col cols="12" lg="5">
            <v-expansion-panels v-if="$root.isUserAdmin()">
              <v-expansion-panel>
                <v-expansion-panel-header id="users-options-header">{{i18n.options}}</v-expansion-panel-header>
                <v-expansion-panel-content>
                  <v-btn id="users-sync-button" @click.stop="sync()" class="mt-6 mb-1">
                    {{ i18n.usersSynchronize }}
                  </v-btn>
                  <div class="text-caption" v-text="i18n.usersSynchronizeHelp"/>
                </v-expansion-panel-content>
              </v-expansion-panel>
            </v-expansion-panels>
          </v-col>
          <v-spacer></v-spacer>
          <v-col cols="12" lg="2" align="end">
            <h4 v-if="!$root.loading">{{ i18n.usersEnabled }} {{ countUsersEnabled() }} / {{ countUsers() }} </h4>
          </v-col>
        </v-row>
        <v-row>
          <v-col>
            <v-toolbar v-if="$root.isUserAdmin()" class="elevation-0">
              <v-btn id="add-user-button" class="action" color="blue" @click.stop="showAdd()">
                <v-icon>fa-plus</v-icon>
              </v-btn>
            </v-toolbar>
            <v-dialog v-model="dialog" persistent width="800px">
              <v-card>
                <v-card-title class="lighten-4 py-4 title">{{ i18n.add }} {{ i18n.user }}</v-card-title>
                <v-form v-model="form.valid">
                  <v-container grid-list-sm class="pa-4">
                    <v-row>
                      <v-col xs12>
                        <v-text-field id="email-input" v-model="form.email" :placeholder="i18n.email" autofocus="true" :rules="[rules.required]"></v-text-field>
                        <v-text-field id="password-input" v-model="form.password" :placeholder="i18n.password" :type="showPassword ? 'text' : 'password'"
                          @click:append="showPassword = !showPassword" :append-icon="showPassword ? 'fa-eye-slash' : 'fa-eye'"
                          :rules="[rules.required, rules.maxpasslen, rules.minpasslen, rules.badpasschs]"></v-text-field>
                        <v-select id="roles-select" v-model="form.role" :items="roles" :label="i18n.role" :rules="[rules.required]"></v-select>
                        <v-text-field id="firstname-input" v-model="form.firstName" :placeholder="i18n.firstName"></v-text-field>
                        <v-text-field id="lastname-input" v-model="form.lastName" :placeholder="i18n.lastName"></v-text-field>
                        <v-text-field id="note-input" v-model="form.note" :placeholder="i18n.note"></v-text-field>
                      </v-col>
                    </v-row>
                  </v-container>
                  <v-card-actions>
                    <v-spacer></v-spacer>
                    <v-btn id="add-cancel-button" text @click="dialog = false">{{ i18n.cancel }}</v-btn>
                    <v-btn id="add-confirm-button" :disabled="!form.valid" color="primary" @click="add()" v-text="i18n.add"></v-btn>
                  </v-card-actions>
                </v-form>
              </v-card>
            </v-dialog>
            <v-dialog v-model="deleteUserDialog" persistent max-width="390">
              <v-card>
                <v-card-title class="headline" v-text="i18n.deleteUserTitle"></v-card-title>
                <v-card-text v-text="i18n.deleteUserConfirm"></v-card-text>
                <v-card-text id="email-output" v-text="form.email" class="font-weight-bold"></v-card-text>
                <v-card-text v-text="i18n.continue"></v-card-text>
                <v-card-actions>
                  <v-spacer></v-spacer>
                  <v-btn id="delete-cancel-button" text @click.stop="hideDeleteConfirm()" v-text="i18n.cancel"></v-btn>
                  <v-btn id="delete-confirm-button" color="warning" text @click.stop="removeUser(form.id)" v-text="i18n.delete"></v-btn>
                </v-card-actions>
              </v-card>
            </v-dialog>
            <v-data-table :sort-by.sync="sortBy" :sort-desc.sync="sortDesc" :footer-props="footerProps"
              :items-per-page.sync="itemsPerPage" must-sort :headers="headers" :items="users" :expanded.sync="expanded" :show-expand="$root.isUserAdmin()">
              <template v-slot:item="props">
                <tr>
                  <td v-if="$root.isUserAdmin()">
                    <v-btn id="expandNode" icon small @click="expand(props.item)">
                      <v-icon v-if="isExpanded(props.item)" :alt="i18n.expand" :title="i18n.nodeExpandHelp">fa-angle-down</v-icon>
                      <v-icon v-if="!isExpanded(props.item)" :alt="i18n.expand" :title="i18n.nodeExpandHelp">fa-angle-right</v-icon>
                    </v-btn>
                  </td>
                  <td v-text="props.item.email"></td>
                  <td v-text="props.item.firstName" class="d-none d-lg-table-cell"></td>
                  <td v-text="props.item.lastName" class="d-none d-lg-table-cell"></td>
                  <td v-text="props.item.note" class="d-none d-lg-table-cell"></td>
                  <td v-text="$root.formatStringArray(props.item.roles)" class="d-none d-lg-table-cell"></td>
                  <td>
                    <div v-if="$root.isUserAdmin() || $root.isMyUser(props.item)">
                      <v-icon v-if="props.item.oidcStatus == 'enabled'" color="info" class="px-1" :title="i18n.oidcLinked">fa-link</v-icon>
                      <v-icon v-if="props.item.totpStatus == 'enabled'" color="info" :title="i18n.totpActive">fa-user-shield</v-icon>
                      <v-icon v-if="props.item.webauthnStatus == 'unused-due-to-always-showing-enabled'" color="info" class="px-1" :title="i18n.webauthnActive">fa-fingerprint</v-icon>
                      <v-icon v-if="props.item.status == 'locked'" color="grey" :title="i18n.loginDisabled">fa-user-slash</v-icon>
                      <v-icon v-if="!props.item.passwordChanged && props.item.oidcStatus != 'enabled'" color="warning" class="px-1" :title="i18n.passwordNeedsChanged">fa-exclamation-triangle</v-icon>
                    </div>
                  </td>
                </tr>
              </template>
              <template v-slot:expanded-item="{ item }">
                <tr>
                  <td :colspan="headers.length + 1" class="px-0">
                    <v-container fluid grid-list-sm class="pa-4">
                      <v-row>
                        <v-col cols="12" lg="4">
                          <v-card>
                            <v-card-title v-text="i18n.profile"/>
                            <v-card-text>
                              <v-text-field id="firstname-input" v-model="form.firstName" :placeholder="i18n.firstName"></v-text-field>
                              <v-text-field id="lastname-input" v-model="form.lastName" :placeholder="i18n.lastName"></v-text-field>
                              <v-text-field id="note-input" v-model="form.note" :placeholder="i18n.note"></v-text-field>

                              <v-btn id="update-profile-button" @click="updateProfile(item)" v-text="i18n.update"></v-btn>
                            </v-card-text>
                          </v-card>
                        </v-col>
                        <v-col cols="12" lg="4">
                          <v-card>
                            <v-card-title>{{ i18n.roles }}</v-card-title>
                            <v-card-text>
                              <v-checkbox v-for="role in roles" :key="role" :id="'role-checkbox-' + role" dense :input-value="hasRole(item, role)" :label="role" @click.stop="return toggleRole(item, role)">
                            </v-card-text>
                          </v-card>
                        </v-col>
                        <v-col cols="12" lg="4">
                          <v-card>
                            <v-card-title>{{ i18n.access }}</v-card-title>
                            <v-card-text>
                              <v-alert v-if="item.oidcStatus == 'enabled'" class="mt-2" type="warning" icon="fa-shield-halved" text dense>
                                {{ i18n.oidcResetPasswordHelp }}
                              </v-alert>

                              <v-form v-model="form.valid">
                                <v-text-field id="password-input" v-model="form.password" :placeholder="i18n.passwordChange" :type="showPassword ? 'text' : 'password'"
                                  @click:append="showPassword = !showPassword" :append-icon="showPassword ? 'fa-eye-slash' : 'fa-eye'"
                                  :rules="[rules.required, rules.maxpasslen, rules.minpasslen, rules.badpasschs]"></v-text-field>
                              </v-form>
                              <v-btn id="update-password-button" :disabled="!form.valid" @click="updatePassword(item)" v-text="i18n.passwordReset" class="mr-2 mb-2"></v-btn>
                              <v-btn id="toggle-locked-button" v-text="item.status == 'locked' ? i18n.unlock : i18n.lock" @click.stop="toggleStatus(item)" class="mr-2 mb-2"/>
                              <v-btn id="delete-user-button" v-text="i18n.delete" color="error" @click.stop="showDeleteConfirm(item)" class="mb-2"/>
                            </v-card-text>
                          </v-card>
                        </v-col>
                      </v-row>
                    </v-container>
                  </td>
                </tr>
              </template>
            </v-data-table>
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-jobs">
      <v-container fluid>
        <v-row>
          <v-col>
            <h2 v-if="isKind('pcap')" v-text="i18n.jobs"></h2>
            <h2 v-if="!isKind('pcap')" v-text="kind"></h2>
          </v-col>
        </v-row>
        <v-row>
          <v-col>
            <v-toolbar v-if="isKind('pcap')" class="elevation-0" fixed>
              <v-btn color="primary" @click.stop="dialog = !dialog" id="add-pcap-job-button">
                <v-icon>fa-plus</v-icon>
              </v-btn>
            </v-toolbar>
            <v-data-table :sort-by.sync="sortBy" :sort-desc.sync="sortDesc" :footer-props="footerProps" :items-per-page.sync="itemsPerPage"
              must-sort :headers="headers" :items="jobs">
              <template v-slot:item="props">
                <tr>
                  <td>
                    <router-link :to="{ name: 'job', params: {jobId: props.item.id}}" :style="{ cursor: 'pointer'}">
                      {{ props.item.id }}
                    </router-link>
                  </td>
                  <td>{{ props.item.owner }}</td>
                  <td>{{ props.item.createTime | formatTimestamp }}</td>
                  <td>{{ props.item.completeTime | formatTimestamp }}</td>
                  <td v-text="props.item.nodeId"></td>
                  <td><v-chip :color="props.item | colorJobStatus">{{ props.item | formatJobStatus }}</v-chip></td>
                  <td>
                    <router-link :to="{ name: 'job', params: {jobId: props.item.id}}" style="text-decoration: none; cursor: 'pointer'">
                      <v-icon class="mr-2" :title="i18n.view">fa-binoculars</v-icon>
                    </router-link>
                    <v-icon class="mr-2" :title="i18n.delete" @click.stop="deleteJob(props.item)">fa-times-circle</v-icon>
                  </td>
                </tr>
              </template>
            </v-data-table>
            <v-dialog v-model="dialog" width="800px">
              <v-card id="pcap-job-dialog">
                <v-card-title class="lighten-4 py-4 title">{{ i18n.add }} {{ i18n.job }}</v-card-title>
                <v-form v-model="form.valid">
                  <v-container grid-list-sm class="pa-4">
                    <v-row>
                      <v-col xs12>
                        <v-text-field v-model="form.sensorId" :placeholder="i18n.sensorId" persistent-hint :hint="i18n.sensorIdHelp"></v-text-field>
                        <v-text-field v-model="form.importId" :placeholder="i18n.importId" persistent-hint :hint="i18n.importIdHelp"></v-text-field>
                        <v-text-field v-model="form.protocol" :placeholder="i18n.protocol" persistent-hint :hint="i18n.protocolHelp"></v-text-field>
                        <v-text-field v-model="form.srcIp" :placeholder="i18n.srcIp" persistent-hint :hint="i18n.srcIpHelp"></v-text-field>
                        <v-text-field v-model="form.srcPort" :placeholder="i18n.srcPort" persistent-hint :hint="i18n.srcPortHelp"></v-text-field>
                        <v-text-field v-model="form.dstIp" :placeholder="i18n.dstIp" persistent-hint :hint="i18n.dstIpHelp"></v-text-field>
                        <v-text-field v-model="form.dstPort" :placeholder="i18n.dstPort" persistent-hint :hint="i18n.dstPortHelp"></v-text-field>
                        <v-text-field v-model="form.beginTime" :placeholder="i18n.beginTime" persistent-hint :hint="i18n.beginTimeHelp"></v-text-field>
                        <v-text-field v-model="form.endTime" :placeholder="i18n.endTime" persistent-hint :hint="i18n.endTimeHelp"></v-text-field>
                      </v-col>
                    </v-row>
                  </v-container>
                  <v-card-actions>
                    <v-spacer></v-spacer>
                    <v-btn text @click="clearAddJobForm()" v-text="i18n.clear"></v-btn>
                    <v-btn text @click="dialog = false" v-text="i18n.cancel"></v-btn>
                    <v-btn :disabled="!form.valid" text color="primary" @click="submitAddJob" v-text="i18n.add"></v-btn>
                  </v-card-actions>
                </v-form>
              </v-card>
            </v-dialog>
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-job">
      <v-container fluid @click="jobClickHandler()">
        <v-row>
          <v-col>
            <h2>{{ i18n.viewJob }}</h2>
          </v-col>
        </v-row>
        <v-row>
          <v-col>
            <v-expansion-panels>
              <v-expansion-panel>
                <v-expansion-panel-header>
                  <v-chip label class="mx-2">
                    <v-avatar>
                      <v-icon>fa-hashtag</v-icon>
                    </v-avatar>
                    <span id="jobDetailsId">{{ job.id }}</span>
                  </v-chip>
                  <v-chip label class="mx-2">
                    <v-avatar>
                      <v-icon>fa-ethernet</v-icon>
                    </v-avatar>
                    <span id="jobDetailsSensorId">{{ job.nodeId }}</span>
                  </v-chip>
                  <v-chip v-if="job.filter" label class="mx-2">
                    <v-avatar>
                      <v-icon>fa-file-export</v-icon>
                    </v-avatar>
                    <span id="jobDetailsSrc">{{ job.filter.srcIp }}<span v-if="job.filter.srcPort != 0">:{{ job.filter.srcPort }}</span><span class="resolved-host" v-if="$root.pickHostname(job.filter.srcIp)"> - {{ $root.pickHostname(job.filter.srcIp) }}</span></span>
                  </v-chip>
                  <v-chip v-if="job.filter" label class="mx-2">
                    <v-avatar>
                      <v-icon>fa-file-import</v-icon>
                    </v-avatar>
                    <span id="jobDetailsDst">{{ job.filter.dstIp }}<span v-if="job.filter.dstPort != 0">:{{ job.filter.dstPort }}</span><span class="resolved-host" v-if="$root.pickHostname(job.filter.dstIp)"> - {{ $root.pickHostname(job.filter.dstIp) }}</span></span>
                  </v-chip>
                </v-expansion-panel-header>
                <v-expansion-panel-content>
                  <v-container fluid grid-list-sm class="pa-4">
                    <v-row>
                      <v-col>
                        <div>
                          <span class="filter label">{{ i18n.job }}:</span>
                          <span class="filter value">{{ job.id }}</span>
                        </div>
                        <div>
                          <span class="filter label">{{ i18n.owner }}:</span>
                          <span class="filter value">{{ job.owner }}</span>
                        </div>
                        <div>
                          <span class="filter label">{{ i18n.sensorId }}:</span>
                          <span class="filter value">{{ job.nodeId }}</span>
                        </div>
                        <div>
                          <span class="filter label">{{ i18n.importId }}:</span>
                          <span v-if="job.filter" class="filter value">{{ job.filter.importId }}&nbsp;</span>
                        </div>
                        <div>
                          <span class="filter label">{{ i18n.protocol }}:</span>
                          <span v-if="job.filter" class="filter value">{{ job.filter.protocol }}&nbsp;</span>
                        </div>
                        <div>
                          <span class="filter label">{{ i18n.srcIp }}:</span>
                          <span v-if="job.filter" class="filter value">{{ job.filter.srcIp }}&nbsp;<span class="resolved-host" v-if="$root.pickHostname(job.filter.srcIp)"> - {{ $root.pickHostname(job.filter.srcIp) }}</span></span>
                        </div>
                        <div>
                          <span class="filter label">{{ i18n.srcPort }}:</span>
                          <span v-if="job.filter" class="filter value">{{ job.filter.srcPort }}&nbsp;</span>
                        </div>
                        <div>
                          <span class="filter label">{{ i18n.dstIp }}:</span>
                          <span v-if="job.filter" class="filter value">{{ job.filter.dstIp }}&nbsp;<span class="resolved-host" v-if="$root.pickHostname(job.filter.dstIp)"> - {{ $root.pickHostname(job.filter.dstIp) }}</span></span>
                        </div>
                        <div>
                          <span class="filter label">{{ i18n.dstPort }}:</span>
                          <span v-if="job.filter" class="filter value">{{ job.filter.dstPort }}&nbsp;</span>
                        </div>
                        <div>
                          <span class="filter label">{{ i18n.dateQueued }}:</span>
                          <span class="filter value">{{ job.createTime | formatDateTime}}&nbsp;</span>
                        </div>
                        <div>
                          <span class="filter label">{{ i18n.dateCompleted }}:</span>
                          <span class="filter value">{{ job.completeTime | formatDateTime}}&nbsp;</span>
                        </div>
                        <div>
                          <span class="filter label">{{ i18n.dateFailed }}:</span>
                          <span class="filter value">{{ job.failTime | formatDateTime}}&nbsp;</span>
                        </div>
                        <div>
                          <span class="filter label">{{ i18n.beginTime }}:</span>
                          <span v-if="job.filter" class="filter value">{{ job.filter.beginTime | formatTimestamp }}&nbsp;</span>
                        </div>
                        <div>
                          <span class="filter label">{{ i18n.endTime }}:</span>
                          <span v-if="job.filter" class="filter value">{{ job.filter.endTime | formatTimestamp }}&nbsp;</span>
                        </div>
                      </v-col>
                    </v-row>
                  </v-container>
                </v-expansion-panel-content>
              </v-expansion-panel>
            </v-expansion-panels>
          </v-col>
        </v-row>
        <v-row v-if="job.status == 0" row>
          <v-col>
            <v-alert :value="true" color="info" icon="fa-info">
              {{ i18n.jobInProgress }}
            </v-alert>
          </v-col>
        </v-row>
        <v-row v-if="job.status == 1">
          <v-col>
            <v-toolbar fixed class="elevation-0">
              <v-text-field v-model="search" clearable prepend-icon="fa-filter" :label="i18n.filterResults" single-line hide-details></v-text-field>
              <v-spacer></v-spacer>
              <v-btn-toggle v-model="packetOptions" class="transparent" multiple>
                <v-btn value="packets" icon :title="i18n.packetStreamHelp" text @click="captureLayoutAsStream()">
                  <v-icon>fa-list</v-icon>
                </v-btn>
                <v-btn value="hex" :title="i18n.hexHelp" text>
                  {{ i18n.hex }}
                </v-btn>
                <v-btn value="unwrap" :title="i18n.unwrapHelp" text @click="toggleWrap">
                  <v-icon>fa-envelope-open-text</v-icon>
                </v-btn>
              </v-btn-toggle>
              <v-spacer></v-spacer>
              <v-btn icon @click="expandPackets(false)" :title="i18n.collapseHelp" text>
                <v-icon>fa-window-minimize</v-icon>
              </v-btn>
              <v-btn icon @click="expandPackets(true)" :title="i18n.expandHelp" text>
                <v-icon>fa-window-maximize</v-icon>
              </v-btn>
              <v-spacer></v-spacer>
              <v-btn text icon @click="transcriptCyberChef()" :title="i18n.transcriptCyberChefHelp">
                <v-icon>fas fa-bread-slice</v-icon>
              </v-btn>
              <v-btn text icon :href="downloadUrl()" download :title="i18n.downloadPackets">
                <v-icon>fa-download</v-icon>
              </v-btn>
            </v-toolbar>
            <v-data-table ref="packetTable" :sort-by.sync="sortBy" :sort-desc.sync="sortDesc" :items-per-page.sync="itemsPerPage"
              :search="search" :footer-props="footerProps" must-sort :headers="headers" :hide-default-header="!isOptionEnabled('packets')"
              :items="packets" item-key="number" :loading="packetsLoading" :expanded="expanded">
              <template v-slot:item="props">
                <tr @click="expandRow(props.item)" v-if="isOptionEnabled('packets')">
                  <td v-text="props.item.number"></td>
                  <td>{{ props.item.timestamp | formatTimestamp }}</td>
                  <td><v-chip :color="props.item.type | colorType">{{ props.item.type }}</v-chip></td>
                  <td>{{ props.item.srcIp }}<span class="resolved-host" v-if="$root.pickHostname(props.item.srcIp)"> - {{ $root.pickHostname(props.item.srcIp) }}</span></td>
                  <td>{{ props.item.srcPort }}</td>
                  <td>{{ props.item.dstIp }}<span class="resolved-host" v-if="$root.pickHostname(props.item.dstIp)"> - {{ $root.pickHostname(props.item.dstIp) }}</span></td>
                  <td>{{ props.item.dstPort }}</td>
                  <td><v-chip v-for="flag in props.item.flags" :color="flag | colorFlag" :key="flag">{{ flag }}</v-chip></td>
                  <td>{{ props.item.length }}</td>
                </tr>
              </template>
              <template v-slot:expanded-item="props">
                <tr v-if="isOptionEnabled('packets') || props.item.payloadOffset > 0">
                  <td :colspan="getPacketColumnSpan()" :class="getPacketClass(props.item)">
                    <pre class="hardwrap">{{ props.item | formatPacketView }}</pre>
                  </td>
                </tr>
              </template>
              <template v-slot:no-results>
                <v-alert :value="true" color="info" icon="fa-info">
                  {{ i18n.noSearchResults }}
                </v-alert>
              </template>
            </v-data-table>
            <div class="text-xs-center pt-2">
                <v-btn v-text="i18n.loadMore" @click="loadPackets()"></v-btn>
            </div>
          </v-col>
        </v-row>
        <v-row v-if="job.status == 2">
          <v-col>
            <v-alert :value="true" color="info" icon="fa-exclamation-triangle">
              {{ i18n.jobIncomplete }}
              <hr>
              {{ job.failTime | formatDateTime }}
              <br>
              {{ i18n.attempt }} {{ job.failCount }}: {{ job.failure }}
            </v-alert>
          </v-col>
        </v-row>
        <v-menu v-model="quickActionVisible" :position-x="quickActionX" :position-y="quickActionY" absolute>
          <v-list id="job-common-action" color="secondary">
              <v-list-item id="actionCopyValue" dense @click="$root.copyToClipboard(quickActionValue)">
                <v-list-item-icon>
                  <v-icon color="white">fa-copy</v-icon>
                </v-list-item-icon>
                <v-list-item-title class="white--text">
                  {{ i18n.copyToClipboard }}
                </v-list-item-title>
              </v-list-item>
          </v-list>
          <v-list id="job-quick-action" color="secondary">
              <template v-slot:activator>
                <v-list-item-icon>
                  <v-icon color="white">fa-external-link-alt</v-icon>
                </v-list-item-icon>
                <v-list-item-title class="white--text">
                  {{ i18n.quickActions }}
                </v-list-item-title>
              </template>
              <v-list-item dense v-for="action in actions" class="custom-quick-action-button" v-if="action.enabled" :key="action.link" :href="action.background ? '' : action.linkFormatted" :title="$root.localizeMessage(action.description)" :target="$root.target(action.target)" @click="$root.performAction($event, action)">
                <v-list-item-icon>
                  <v-icon :alt="action.name" color="white">{{ action.icon }}</v-icon>
                </v-list-item-icon>
                <v-list-item-title class="white--text">
                  {{ $root.localizeMessage(action.name) }}
                </v-list-item-title>
              </v-list-item>
          </v-list>
        </v-menu>
      </v-container>
    </script>

    <script type="text/x-template" id="page-case">
      <v-container fluid>
        <div class="mx-sm-12 mx-lg-6 mt-2 mb-6 mb-md-1">
          <div tabindex="0" class="case detail-field clicktoedit d-flex align-start pa-2" v-if="!isEdit('case-title')"
            @click="startEdit('case-title-input', caseObj.title, 'case-title', 'title', modifyCase)" @keypress.space.prevent="startEdit('case-title-input', caseObj.title, 'case-title', 'title', modifyCase)">
            <h2 id="case-title" class="rounded">{{ caseObj.title }}</h2>
          </div>
          <div class="d-flex flex-column" v-if="isEdit('case-title')">
            <div class="mb-2">
              <v-form v-model="editForm.valid" @submit.prevent>
                <v-text-field id="case-title-input" hide-details="auto" outlined v-model="editForm.val" :rules="[rules.required]" persistent-hint :hint="i18n.caseTitleHelp"/>
              </v-form>
            </div>
            <div class="d-inline-flex justify-end">
              <v-btn text small color="primary" class="align-self-end" @click="stopEdit()">
                {{ i18n.cancel }}
              </v-btn>
              <v-btn :disabled="!editForm.valid" text small color="primary" class="align-self-end" @click="stopEdit(true)">
                {{ i18n.save }}
              </v-btn>
            </div>
          </div>
        </div>
        <v-row class="mx-sm-8 mx-md-12 mx-lg-4 flex-column flex-md-row">
          <v-col cols="12" md="9" class="case main" order="2" order-md="1">
            <div class="d-block d-md-none">
              <h2>{{ i18n.description }}</h2>
            </div>
            <div class="mb-6 mb-md-3">
              <div tabindex="0" class="clicktoedit d-flex align-start pa-2" v-if="!isEdit('case-description')" @click="startEdit('case-desc-input',  caseObj.description, 'case-description', 'description', modifyCase, [], true)"
              @keypress.space.prevent="startEdit('case-desc-input',  caseObj.description, 'case-description', 'description', modifyCase, [], true)">
                <div class="d-block" style="width: 100%;">
                  <div id="case-description" class="rounded case detail-field markdown-body" :inner-html.prop="caseObj.description | formatMarkdown"></div>
                </div>
              </div>
              <div class="d-flex flex-column" v-if="isEdit('case-description')">
                <div class="mb-2 pt-1 px-2 rounded rounded-md contrast-bg d-flex flex-column">
                  <div class="d-flex flex-column flex-sm-row align-sm-center align-self-start text-body-2 mb-1 ml-1">
                    <a class="case markdown-icon" href="https://www.markdownguide.org/cheat-sheet/" target="_blank" :title="i18n.markdownFormattingSupported"><v-icon>fab fa-markdown</v-icon></a>
                  </div>
                  <v-form v-model="editForm.valid" @submit.prevent>
                    <v-textarea id="case-desc-input" solo flat hide-details="auto" rows="5" dense color="text--black" v-model="editForm.val" :rules="[rules.required]" persistent-hint :hint="i18n.caseDescriptionHelp"/>
                  </form>
                </div>
                <div class="d-inline-flex justify-end">
                  <v-btn text small color="primary" class="align-self-end" @click="stopEdit()">
                    {{ i18n.cancel }}
                  </v-btn>
                  <v-btn :disabled="!editForm.valid" text small color="primary" class="align-self-end" @click="stopEdit(true)">
                    {{ i18n.save }}
                  </v-btn>
                </div>
              </div>
            </div>
            <v-row>
              <v-tabs grow v-model="activeTab">
                <v-tab id="case_commentsTab" href="#comments">
                  <v-icon left>fa-comments</v-icon>
                  <div class="d-none d-lg-block">{{ i18n.comments }}</div>
                </v-tab>
                <v-tab id="case_attachmentTab" href="#attachments">
                  <v-icon left>fa-paperclip</v-icon>
                  <div class="d-none d-lg-block">{{ i18n.attachments }}</div>
                </v-tab>
                <v-tab id="case_evidenceTab" href="#evidence">
                  <v-icon left>fa-eye</v-icon>
                  <div class="d-none d-lg-block">{{ i18n.evidence }}</div>
                </v-tab>
                <v-tab id="case_eventsTab" href="#events">
                  <v-icon left>fa-link</v-icon>
                  <div class="d-none d-lg-block">{{ i18n.events }}</div>
                </v-tab>
                <v-tab id="case_historyTab" href="#history">
                  <v-icon left>fa-history</v-icon>
                  <div class="d-none d-lg-block">{{ i18n.history }}</div>
                </v-tab>

                <v-tab-item value="comments">
                  <v-row>
                    <v-col>
                      <v-toolbar class="elevation-0" fixed>
                        <v-btn :title="i18n.addCommentHelp" color="primary" @click.stop="prepareForInput('comment-input')" id="add-comment-button">
                          <v-icon>fa-plus</v-icon>
                        </v-btn>
                        <v-btn class="mx-1" :title="i18n.refreshCommentsHelp" color="secondary" @click.stop="reloadAssociation('comments', true)" id="refresh-comments-button">
                          <v-icon>fa-sync</v-icon>
                        </v-btn>
                      </v-toolbar>
                    </v-col>
                  </v-row>
                  <div id="comment-list">
                    <div v-for="(comment, index) in associations.comments" class="mb-8" v-if="shouldRenderAssociationRecord('comments', comment, index)">
                      <div class="d-flex flex-column align-start my-4">
                        <v-col class="d-flex flex-column align-start pt-2 pt-md-0">
                          <div class="mt-1 mt-md-3 pt-1 pb-2 px-2 contrast-bg rounded rounded-md" style="width: 100%;">
                            <div class="d-flex flex-column align-start">
                              <div v-if="!isEdit(`comment-${index}`)" class="case d-block comment-body mt-2">
                                <div class="mb-2">
                                  <div :id="`comment-${index}`" class="markdown-body" :inner-html.prop="comment.description | formatMarkdown"></div>
                                </div>
                              </div>
                              <div v-else class="d-flex flex-column" style="width: 100%;">
                                <div class="d-flex flex-column flex-sm-row align-sm-center align-self-start text-body-2 mb-1 ml-1">
                                  <a class="case markdown-icon" href="https://www.markdownguide.org/cheat-sheet/" :target="$root.target('_blank')" :title="i18n.markdownFormattingSupported"><v-icon>fab fa-markdown</v-icon></a>
                                </div>
                                <div class="mb-3">
                                  <v-form v-model="editForm.valid" @submit.prevent>
                                    <v-textarea id="comment-desc-input" solo flat hide-details="auto" rows="5" dense color="text--black" v-model="editForm.val" class="mb-1" :rules="[rules.required]"/>
                                  </v-form>
                                  <div class="d-inline-flex justify-end">
                                    <v-btn text small color="primary" class="align-self-end" @click="stopEdit()">
                                      {{ i18n.cancel }}
                                    </v-btn>
                                    <v-btn :disabled="!editForm.valid" text small color="primary" class="align-self-end" @click="stopEdit(true)">
                                      {{ i18n.update }}
                                    </v-btn>
                                  </div>
                                </div>
                              </div>

                              <div v-if="$root.isLicensed(FEAT_TTR)">
                                <div v-if="!isEdit(`comment-hours-${index}`)" class="case d-block comment-body mt-2">
                                  <div class="ml-2 mb-2 clicktoedit" @click="startEdit('comment-hours-input', comment.hours, `comment-hours-${index}`, 'hours', modifyAssociation, ['comments', comment], false)" @keypress.space.prevent="startEdit('comment-hours-input', comment.hours, `comment-hours-${index}`, 'hours', modifyAssociation, ['comments', comment], false)">
                                    <div :id="`comment-hours-${index}`">
                                      <v-icon class="mr-2">fa-clock</v-icon>{{ comment.hours | formatHours }} {{ i18n.hours }}
                                    </div>
                                  </div>
                                </div>
                                <div v-else class="d-flex flex-column" style="width: 100%;">
                                  <div class="mb-3">
                                    <v-form v-model="editForm.valid" @submit.prevent>
                                      <v-text-field id="comment-hours-input" solo flat dense color="text--black" v-model="editForm.val" class="mb-1" :rules="[rules.hours]"/>
                                    </v-form>
                                    <div class="d-inline-flex justify-end">
                                      <v-btn text small color="primary" class="align-self-end" @click="stopEdit()">
                                        {{ i18n.cancel }}
                                      </v-btn>
                                      <v-btn :disabled="!editForm.valid" text small color="primary" class="align-self-end" @click="stopEdit(true)">
                                        {{ i18n.update }}
                                      </v-btn>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <div class="d-flex flex-column flex-sm-row align-self-end text-body-2">
                                <div class="d-inline-flex align-center mr-1">
                                  <v-avatar color="primary" size="24" class="mr-2 d-none d-sm-inline-flex white--text">
                                    <div class="case avatar-font" :title="comment.owner">
                                      {{ $root.getAvatar(comment.owner) }}
                                    </div>
                                  </v-avatar>
                                  <div >
                                    {{ comment.owner }}
                                  </div>
                                </div>
                                <div class="mt-1 mr-1 d-none d-sm-block">
                                  &bull;
                                </div>
                                <div class="mt-1">
                                  {{ comment.createTime | formatDateTime }}
                                </div>
                                <div v-if="isEdited(comment)" :title="$root.formatDateTime(comment.updateTime)" class="mx-sm-2">
                                  {{ i18n.edited }}
                                </div>
                                <div class="ml-1 d-flex mt-1 mt-sm-0">
                                  <v-btn text small icon color="primary" v-if="!isEdit(`comment-${index}`)" @click="startEdit('comment-desc-input', comment.description, `comment-${index}`, 'description', modifyAssociation, ['comments', comment], true)"
                                    @keypress.space.prevent="startEdit('comment-desc-input', comment.description, `comment-${index}`, 'description', modifyAssociation, ['comments', comment], true)">
                                    <v-icon class="tiny-icon">fa-edit</v-icon>
                                  </v-btn>
                                  <v-btn text small color="red" @click="deleteAssociation('comments', comment)" icon><v-icon class="tiny-icon">fa-circle-xmark</v-icon></v-btn>
                                </div>
                              </div>
                            </div>
                          </div>
                        </v-col>
                      </div>
                      <div v-if="shouldRenderShowAll('comments', index)" class="d-flex-block justify-center my-4 show-all">
                        <div class="d-flex justify-center">
                          <div>{{ getUnrenderedCount('comments') }} {{ i18n.hidden }} {{ i18n.comments }}</div>
                        </div>
                        <div class="d-flex justify-center">
                          <v-btn @click="renderAllAssociations('comments')">{{ i18n.showAll }}</v-btn>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex flex-column align-start my-4">
                    <v-col id="new-comment" class="d-flex flex-column align-start pt-2 pt-md-0">
                      <div class="mt-1 mt-md-3 pb-3 pt-1 contrast-bg rounded rounded-md" style="width: 100%;">
                        <div class="d-flex flex-column align-start">
                          <div class="d-inline-flex align-center mt-3 mx-2 mb-4">
                            <v-avatar color="primary" size="28" class="mr-2 white--text">
                              <div class="font-weight-bold" :title="$root.username">
                              {{ $root.getAvatar($root.username) }}
                              </div>
                            </v-avatar>
                            <h3 class="text--primary">{{ i18n.commentAdd }}</h3>
                          </div>
                          <div class="d-flex flex-column" style="width: 100%;">
                            <div class="d-flex flex-column flex-sm-row align-sm-center align-self-start text-body-2 mb-1 ml-3">
                              <a class="case markdown-icon" href="https://www.markdownguide.org/cheat-sheet/" :target="$root.target('_blank')" :title="i18n.markdownFormattingSupported"><v-icon>fab fa-markdown</v-icon></a>
                            </div>
                            <div class="mx-2">
                              <v-form ref="comments" v-model="associatedForms['comments'].valid" @submit.prevent>
                                <v-textarea id="comment-input" solo flat hide-details="auto" rows="5" color="text--black" :value="associatedForms['comments'].description" @change="val => associatedForms['comments'].description = val" :rules="[rules.required]" class="mb-1" persistent-hint :hint="i18n.commentDescriptionHelp"/>
                                <v-row v-if="$root.isLicensed(FEAT_TTR)">
                                  <v-col cols="4">
                                    <v-text-field id="comment-hours-input" solo flat color="text--black" :value="associatedForms['comments'].hours" @change="val => associatedForms['comments'].hours = val" class="mb-1" persistent-hint :hint="i18n.commentHoursHelp" :rules="[rules.hours]"/>
                                  </v-col>
                                  <v-col cols="8"></span>
                                </v-row>
                              </v-form>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="d-flex align-center align-self-end text-body-2 mt-2">
                        <div class="d-inline-flex justify-end">
                          <v-btn text small color="primary" class="align-self-end" @click="resetForm('comments')">
                          {{ i18n.cancel }}
                          </v-btn>
                          <v-btn :disabled="!associatedForms['comments'].valid" text small color="primary" class="align-self-end" @click="addComment()">
                          {{ i18n.add }}
                          </v-btn>
                        </div>
                      </div>
                    </v-col>
                  </div>
                </v-tab-item>

                <v-tab-item value="attachments">
                  <v-row v-if="!isAdding('attachments')">
                    <v-col>
                      <v-toolbar class="elevation-0" fixed>
                        <v-btn :title="i18n.addAttachmentHelp" color="primary" @click.stop="enableAdding('attachments')" id="add-attachment-button">
                          <v-icon>fa-plus</v-icon>
                        </v-btn>
                        <v-btn class="mx-1" :title="i18n.refreshAttachmentsHelp" color="secondary" @click.stop="reloadAssociation('attachments', true)" id="refresh-attachments-button">
                          <v-icon>fa-sync</v-icon>
                        </v-btn>
                      </v-toolbar>
                    </v-col>
                  </v-row>
                  <v-row v-if="isAdding('attachments')">
                    <v-col>
                      <div class="ml-1 ml-md-3 py-3 px-4 contrast-bg rounded rounded-md" style="width: 100%;">
                      <div class="d-flex flex-column align-start">
                        <div class="d-flex flex-column" style="width: 100%;">
                        <div class="mb-2">
                          <div class="d-inline-flex align-center mb-3">
                            <v-avatar color="primary" size="28" class="mr-2 white--text">
                              <div class="font-weight-bold" :title="$root.username">
                              {{ $root.getAvatar($root.username) }}
                              </div>
                            </v-avatar>
                            <h3 class="text--primary">{{ i18n.attachmentAdd }}</h3>
                          </div>
                          <v-form ref="attachments" v-model="associatedForms['attachments'].valid" @submit.prevent>
                            <v-file-input id="attachments-file" show-size v-model="attachment" persistent-hint :hint="getAttachmentHelp()" :rules="[rules.fileSizeLimit, rules.fileNotEmpty]" @change="associatedForms['attachments'].protected = false"/>
                            <v-checkbox v-model="associatedForms['attachments'].protected" id="attachments-protect" :label="i18n.artifactProtected" persistent-hint :hint="i18n.artifactProtectedHint" />
                            <v-textarea id="attachments-description" rows="2" :value="associatedForms['attachments'].description"
                              @change="val => associatedForms['attachments'].description = val"
                              :placeholder="i18n.artifactDescription" persistent-hint :hint="i18n.artifactDescriptionHelp"/>
                            <v-select id="attachments-tlp" v-if="!isPresetCustomEnabled('tlp')" v-model="associatedForms['attachments'].tlp" :items="selectList('tlp')" persistent-hint :hint="i18n.caseTlpHelp"/>
                            <v-combobox id="attachments-tlp" v-if="isPresetCustomEnabled('tlp')" v-model="associatedForms['attachments'].tlp" :items="selectList('tlp')" persistent-hint :hint="i18n.caseTlpHelp"/>
                            <v-select id="attachments-tags" v-if="!isPresetCustomEnabled('tags')" v-model="associatedForms['attachments'].tags" :items="selectList('tags')" persistent-hint :hint="i18n.caseTagsHelp" multiple>
                              <template #selection="{ item }">
                                <v-chip color="primary">{{item}}</v-chip>
                              </template>
                            </v-select>
                            <v-combobox id="attachments-tags" v-if="isPresetCustomEnabled('tags')" v-model="associatedForms['attachments'].tags" :items="selectList('tags')" persistent-hint :hint="i18n.caseTagsHelp" multiple>
                              <template #selection="{ item }">
                                <v-chip color="primary">{{item}}</v-chip>
                              </template>
                            </v-combobox>
                          </v-form>
                        </div>
                        </div>
                      </div>
                      </div>
                      <div class="d-flex align-center align-self-end text-body-2 mt-2">
                      <div class="d-inline-flex justify-end">
                        <v-btn id="attachment-cancel" text small color="primary" class="align-self-end" @click="resetForm('attachments')">
                          {{ i18n.cancel }}
                        </v-btn>
                        <v-btn id="attachment-add" :disabled="!associatedForms['attachments'].valid" text small color="primary" class="align-self-end" @click="addAssociation('attachments', {'groupType': 'attachments', 'artifactType':'file'})">
                          {{ i18n.add }}
                        </v-btn>
                      </div>
                      </div>
                    </v-col>
                  </v-row>
                  <v-text-field v-model="associatedTable['attachments'].search" clearable prepend-icon="fa-filter" :label="i18n.filterResults" single-line hide-details></v-text-field>
                  <v-data-table ref="attachmentsTable" :sort-by.sync="associatedTable['attachments'].sortBy" :sort-desc.sync="associatedTable['attachments'].sortDesc" :items-per-page.sync="associatedTable['attachments'].itemsPerPage"
                    :search="associatedTable['attachments'].search" :footer-props="associatedTable['attachments'].footerProps" must-sort :headers="associatedTable['attachments'].headers"
                    :items="associations['attachments']" item-key="id" :loading="associatedTable['attachments'].loading" :expanded="associatedTable['attachments'].expanded" class="case-table">
                    <template v-slot:item="props">
                      <tr>
                        <td class="associated actions">
                          <v-btn :id="`attachments-${props.index}-expand`" icon small @click="expandRow('attachments', props.item)">
                            <v-icon v-if="isExpanded('attachments', props.item)" :alt="i18n.expand" :title="i18n.expandHelp">fa-angle-down</v-icon>
                            <v-icon v-if="!isExpanded('attachments', props.item)" :alt="i18n.expand" :title="i18n.expandHelp">fa-angle-right</v-icon>
                          </v-btn>
                        </td>
                        <td class="associated">{{ props.item.createTime | formatDateTime }}</td>
                        <td class="associated">{{ props.item.updateTime | formatDateTime }}</td>
                        <td class="associated">{{ props.item.value }}</td>
                      </tr>
                    </template>
                    <template v-slot:expanded-item="props">
                      <tr>
                        <td :colspan="4" class="case">
                          <v-container fluid class="py-1">
                            <a :target="$root.target('soc-download')" :href="`/api/case/artifactstream?id=${props.item.id}`" class="no-underline">
                              <v-icon>fa-download</v-icon>
                              {{ props.item.value }}
                              ({{ props.item.streamLength | formatCount }}
                              {{ i18n.bytes }})
                            </a>
                            <div class="mt-4">
                              <div class="font-weight-bold">{{i18n.sha256}}: </div>
                              <div :id="`attachments-${props.index}-sha256`" class="case">
                                {{ withDefault(props.item.sha256, i18n.unknown) }}
                                <v-icon class="ml-1" @click="$root.copyToClipboard(props.item.sha256)" :title="i18n.copyToClipboard">fa-copy</v-icon>
                                <v-icon class="ml-1" @click="populateAddObservableForm('sha256', props.item.sha256)" :title="i18n.addObservable">fa-eye</v-icon>
                              </div>
                            </div>
                            <div class="mt-2">
                              <div class="font-weight-bold">{{i18n.sha1}}: </div>
                              <div :id="`attachments-${props.index}-sha1`" class="case">
                                {{ withDefault(props.item.sha1, i18n.unknown) }}
                                <v-icon class="ml-1" @click="$root.copyToClipboard(props.item.sha1)" :title="i18n.copyToClipboard">fa-copy</v-icon>
                                <v-icon class="ml-1" @click="populateAddObservableForm('sha1', props.item.sha1)" :title="i18n.addObservable">fa-eye</v-icon>
                              </div>
                            </div>
                            <div class="mt-2">
                              <div class="font-weight-bold">{{i18n.md5}}: </div>
                              <div :id="`attachments-${props.index}-md5`" class="case">
                                {{ withDefault(props.item.md5, i18n.unknown) }}
                                <v-icon class="ml-1" @click="$root.copyToClipboard(props.item.md5)" :title="i18n.copyToClipboard">fa-copy</v-icon>
                                <v-icon class="ml-1" @click="populateAddObservableForm('md5', props.item.md5)" :title="i18n.addObservable">fa-eye</v-icon>
                              </div>
                            </div>
                          </v-container>
                          <v-container fluid class="pt-2 pb-0">
                            <div tabindex="0" class="clicktoedit" @click="startEdit(`attachments-${props.index}-description-input`, props.item.description, `attachments-${props.index}-description`, 'description', modifyAssociation, ['attachments', props.item], true)"
                              @keypress.space.prevent="startEdit(`attachments-${props.index}-description-input`, props.item.description, `attachments-${props.index}-description`, 'description', modifyAssociation, ['attachments', props.item], true)">
                              <div class="font-weight-bold">{{i18n.artifactDescription}}: </div>
                              <div :id="`attachments-${props.index}-description`" class="case detail-field markdown-body" v-if="!isEdit(`attachments-${props.index}-description`)" :inner-html.prop="props.item.description | formatMarkdown"></div>
                            </div>
                            <div class="d-flex flex-column" v-if="isEdit(`attachments-${props.index}-description`)">
                              <v-form v-model="editForm.valid" @submit.prevent>
                                <div class="mb-2">
                                  <v-textarea full-width rows="3" multiline :id="`attachments-${props.index}-description-input`" hide-details="auto" outlined v-model="editForm.val" persistent-hint :hint="i18n.artifactDescriptionHelp"/>
                                </div>
                              </v-form>
                              <div class="d-inline-flex justify-end">
                                <v-btn text small color="primary" class="align-self-end" @click="stopEdit()">
                                  {{ i18n.cancel }}
                                </v-btn>
                                <v-btn :disabled="!editForm.valid" text small color="primary" class="align-self-end" @click="stopEdit(true)">
                                  {{ i18n.save }}
                                </v-btn>
                              </div>
                            </div>
                          </v-container>
                          <v-container fluid class="py-2">
                            <div tabindex="0" class="clicktoedit" @click="startEdit(`attachments-${props.index}-tlp-input`, props.item.tlp, `attachments-${props.index}-tlp`, 'tlp', modifyAssociation, ['attachments', props.item])"
                              @keypress.space.prevent="startEdit(`attachments-${props.index}-tlp-input`, props.item.tlp, `attachments-${props.index}-tlp`, 'tlp', modifyAssociation, ['attachments', props.item])">
                              <div class="font-weight-bold">{{i18n.caseTlp}}: </div>
                              <v-chip :id="`attachments-${props.index}-tlp`" :color="colorizeChip(props.item.tlp)" outlined v-if="!isEdit(`attachments-${props.index}-tlp`)">{{ withDefault(props.item.tlp, i18n.unknown) }}</v-chip>
                            </div>
                            <v-select :id="`attachments-${props.index}-tlp-input`" v-if="isEdit(`attachments-${props.index}-tlp`) && !isPresetCustomEnabled('tlp')"
                              dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.caseTlpHelp"
                              v-model="editForm.val"
                              :items="selectList('tlp', props.item.tlp)"
                              v-on:change="stopEdit(true)"
                              />
                              <v-combobox :id="`attachments-${props.index}-tlp-input`" v-if="isEdit(`attachments-${props.index}-tlp`) && isPresetCustomEnabled('tlp')"
                                dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.caseTlpHelp"
                                v-model="editForm.val"
                                :items="selectList('tlp', props.item.tlp)"
                                v-on:change="stopEdit(true)"
                              />
                            </v-select>
                          </v-container>
                          <v-container fluid class="py-2">
                            <div tabindex="0" class="clicktoedit" @click="startEdit(`attachments-${props.index}-tags-input`, props.item.tags, `attachments-${props.index}-tags`, 'tags', modifyAssociation, ['attachments', props.item])"
                              @keypress.space.prevent="startEdit(`attachments-${props.index}-tags-input`, props.item.tags, `attachments-${props.index}-tags`, 'tags', modifyAssociation, ['attachments', props.item])">
                              <div class="font-weight-bold">{{i18n.caseTags}}: </div>
                              <div :id="`attachments-${props.index}-tags`" class="case detail-field mt-1" v-if="!isEdit(`attachments-${props.index}-tags`)">
                                <v-chip class="mx-1" v-for="tag in props.item.tags" color="primary">{{ tag }}</v-chip>
                              </div>
                            </div>
                            <v-select :id="`attachments-${props.index}-tags-input`" v-if="isEdit(`attachments-${props.index}-tags`) && !isPresetCustomEnabled('tags')"
                              dense eager outlined hide-details="auto" class="case-select" multiple persistent-hint :hint="i18n.caseTagsHelp"
                              v-model="editForm.val"
                              :items="selectList('tags', props.item.tags)"
                              v-on:change="stopEdit(true)">
                              <template #selection="{ item }">
                                <v-chip color="primary">{{item}}</v-chip>
                              </template>
                            </v-select>
                            <v-combobox :id="`attachments-${props.index}-tags-input`" v-if="isEdit(`attachments-${props.index}-tags`) && isPresetCustomEnabled('tags')"
                              dense eager outlined hide-details="auto" class="case-select" multiple persistent-hint :hint="i18n.caseTagsHelp"
                              v-model="editForm.val"
                              :items="selectList('tags', props.item.tags)"
                              v-on:change="stopEdit(true)">
                              <template #selection="{ item }">
                                <v-chip color="primary">{{item}}</v-chip>
                              </template>
                            </v-combobox>
                          </v-container>
                          <v-container fluid class="py-2">
                            <div tabindex="0" class="clicktoedit" @click="startEdit(`attachments-${props.index}-protected-input`, props.item.protected, `attachments-${props.index}-protected`, 'protected', modifyAssociation, ['attachments', props.item])">
                              <div class="font-weight-bold">{{i18n.artifactProtected}}: </div>
                              <div :id="`attachments-${props.index}-protected`" class="case detail-field" v-if="!isEdit(`attachments-${props.index}-protected`)">{{ props.item.protected ? i18n.yes : i18n.no }}</div>
                            </div>
                            <v-checkbox :id="`attachments-${props.index}-protected-input`" v-if="isEdit(`attachments-${props.index}-protected`)" v-model="editForm.val" v-on:change="stopEdit(true)" persistent-hint :hint="i18n.artifactProtectedHint"/>
                          </v-container>

                          <div class="d-flex flex-column flex-sm-row align-end align-sm-center align-self-end text-body-2">
                            <v-spacer/>
                            <v-avatar color="primary" size="24" class="mr-2 d-none d-sm-inline-flex white--text">
                              <div class="case avatar-font" :title="props.item.owner">
                                {{ $root.getAvatar(props.item.owner) }}
                              </div>
                            </v-avatar>
                            <div class="mr-1">
                              {{ props.item.owner }}
                            </div>
                            <div class="mr-1 d-none d-sm-block">
                              &bull;
                            </div>
                            <div>
                              {{ props.item.createTime | formatDateTime }}
                            </div>
                            <div v-if="isEdited(props.item)" :title="$root.formatDateTime(props.item.updateTime)" class="mx-2">
                              {{ i18n.edited }}
                            </div>
                            <div class="ml-1 d-flex">
                              <v-btn text small color="red" @click="deleteAssociation('attachments', props.item)" icon><v-icon class="tiny-icon">fa-circle-xmark</v-icon></v-btn>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </template>
                    <template v-slot:no-results>
                      <v-alert :value="true" color="info" icon="fa-info">
                        {{ i18n.noSearchResults }}
                      </v-alert>
                    </template>
                  </v-data-table>
                  <div class="text-xs-center pt-2 d-none">
                      <v-btn v-text="i18n.loadMore" @click="loadAssociation('attachments')"></v-btn>
                  </div>
                </v-tab-item>

                <v-tab-item value="evidence">
                  <v-row v-if="!isAdding('evidence')">
                    <v-col>
                      <v-toolbar class="elevation-0" fixed>
                        <v-btn :title="i18n.addObservableHelp" color="primary" @click.stop="enableAdding('evidence')" id="add-evidence-button">
                          <v-icon>fa-plus</v-icon>
                        </v-btn>
                        <v-btn class="mx-1" :title="i18n.refreshObservablesHelp" color="secondary" @click.stop="reloadAssociation('evidence', true)" id="refresh-observables-button">
                          <v-icon>fa-sync</v-icon>
                        </v-btn>
                      </v-toolbar>
                    </v-col>
                  </v-row>
                  <v-row v-if="isAdding('evidence')">
                    <v-col>
                      <div class="ml-1 ml-md-3 py-3 px-4 contrast-bg rounded rounded-md" style="width: 100%;">
                      <div class="d-flex flex-column align-start">
                        <div class="d-flex flex-column" style="width: 100%;">
                        <div class="mb-2">
                          <div class="d-inline-flex align-center mb-3">
                            <v-avatar color="primary" size="28" class="mr-2 white--text">
                              <div class="font-weight-bold" :title="$root.username">
                              {{ $root.getAvatar($root.username) }}
                              </div>
                            </v-avatar>
                            <h3 class="text--primary">{{ i18n.evidenceAdd }}</h3>
                          </div>
                          <v-form ref="evidence" v-model="associatedForms['evidence'].valid" @submit.prevent>
                            <v-select id="evidence-type" v-if="!isPresetCustomEnabled('artifactType')" v-model="associatedForms['evidence'].artifactType" :items="selectList('artifactType')" persistent-hint :hint="i18n.artifactTypeHelp"/>
                            <v-combobox id="evidence-type" v-if="isPresetCustomEnabled('artifactType')" v-model="associatedForms['evidence'].artifactType" :items="selectList('artifactType')" persistent-hint :hint="i18n.artifactTypeHelp"/>
                            <v-file-input id="evidence-value" v-if="associatedForms['evidence'].artifactType == 'file'" show-size v-model="attachment" persistent-hint :hint="getAttachmentHelp()" :rules="[rules.fileSizeLimit, rules.fileNotEmpty, rules.fileRequired]"/>
                            <v-textarea id="evidence-value" v-if="associatedForms['evidence'].artifactType != 'file'" rows="2" :value="associatedForms['evidence'].value" @change="val => associatedForms['evidence'].value = val" :rules="[rules.required]" :placeholder="i18n.artifactValue" persistent-hint :hint="i18n.artifactValueHelp"/>
                            <v-checkbox v-if="isEvidenceBulkCapable()" id="evidence-bulk" v-model="associatedForms['evidence'].bulk" persistent-hint :hint="i18n.artifactBulkHelp"/>
                            <v-textarea id="evidence-description" rows="2" :value="associatedForms['evidence'].description" @change="val => associatedForms['evidence'].description = val" :placeholder="i18n.artifactDescription" persistent-hint :hint="i18n.artifactDescriptionHelp"/>
                            <v-checkbox id="evidence-ioc" v-model="associatedForms['evidence'].ioc" persistent-hint :hint="i18n.artifactIocHelp"/>
                            <v-select id="evidence-tlp" v-if="!isPresetCustomEnabled('tlp')" v-model="associatedForms['evidence'].tlp" :items="selectList('tlp')" persistent-hint :hint="i18n.caseTlpHelp"/>
                            <v-combobox id="evidence-tlp" v-if="isPresetCustomEnabled('tlp')" v-model="associatedForms['evidence'].tlp" :items="selectList('tlp')" persistent-hint :hint="i18n.caseTlpHelp"/>
                            <v-select id="evidence-tags" v-if="!isPresetCustomEnabled('tags')" v-model="associatedForms['evidence'].tags" :items="selectList('tags')" persistent-hint :hint="i18n.caseTagsHelp" multiple>
                              <template #selection="{ item }">
                                <v-chip color="primary">{{item}}</v-chip>
                              </template>
                            </v-select>
                            <v-combobox id="evidence-tags" v-if="isPresetCustomEnabled('tags')" v-model="associatedForms['evidence'].tags" :items="selectList('tags')" persistent-hint :hint="i18n.caseTagsHelp" multiple>
                              <template #selection="{ item }">
                                <v-chip color="primary">{{item}}</v-chip>
                              </template>
                            </v-combobox>
                          </v-form>
                        </div>
                        </div>
                      </div>
                      </div>
                      <div class="d-flex align-center align-self-end text-body-2 mt-2">
                      <div class="d-inline-flex justify-end">
                        <v-btn id="evidence-cancel" text small color="primary" class="align-self-end" @click="resetForm('evidence')">
                          {{ i18n.cancel }}
                        </v-btn>
                        <v-btn id="evidence-add" :disabled="!associatedForms['evidence'].valid" text small color="primary" class="align-self-end" @click="addAssociation('evidence', {'groupType': 'evidence'})">
                          {{ i18n.add }}
                        </v-btn>
                      </div>
                      </div>
                    </v-col>
                  </v-row>
                  <v-text-field v-model="associatedTable['evidence'].search" clearable prepend-icon="fa-filter" :label="i18n.filterResults" single-line hide-details></v-text-field>
                  <v-data-table ref="evidenceTable" :sort-by.sync="associatedTable['evidence'].sortBy" :sort-desc.sync="associatedTable['evidence'].sortDesc" :items-per-page.sync="associatedTable['evidence'].itemsPerPage"
                    :search="associatedTable['evidence'].search" :footer-props="associatedTable['evidence'].footerProps" must-sort :headers="associatedTable['evidence'].headers"
                    :items="associations['evidence']" item-key="id" :loading="associatedTable['evidence'].loading" :expanded="associatedTable['evidence'].expanded" class="case-table">
                    <template v-slot:item="props">
                      <tr>
                        <td class="association actions">
                          <v-btn :id="`evidence-${props.index}-expand`" icon small @click="expandRow('evidence', props.item)">
                            <v-icon v-if="isExpanded('evidence', props.item)" :alt="i18n.expand" :title="i18n.expandHelp">fa-angle-down</v-icon>
                            <v-icon v-if="!isExpanded('evidence', props.item)" :alt="i18n.expand" :title="i18n.expandHelp">fa-angle-right</v-icon>
                          </v-btn>
                          <router-link class="no-underline" :to="{ name: 'hunt', query: {q: buildHuntQueryForValue(props.item.value)}}" :title="i18n.huntForEvidence">
                            <v-icon :title="i18n.huntForEvidence">fa-crosshairs</v-icon>
                          </router-link>
                          <v-btn :id="`evidence-${props.index}-analyze`" icon small @click="analyze(props.item)" :disabled="analyzeInProgress(props.item)">
                            <v-icon v-if="analyzeInProgress(props.item)" :alt="i18n.analyzeInProgress" :title="i18n.analyzeHelp">fa-clock</v-icon>
                            <v-icon v-if="!analyzeInProgress(props.item)" :alt="i18n.analyze" :title="i18n.analyzeHelp">fa-bolt</v-icon>
                          </v-btn>
                        </td>
                        <td class="associated">{{ props.item.createTime | formatDateTime }}</td>
                        <td class="associated">{{ props.item.updateTime | formatDateTime }}</td>
                        <td class="associated">{{ props.item.artifactType }}</td>
                        <td class="associated">{{ props.item.value }}<span class="resolved-host" v-if="props.item.artifactType === 'ip' && $root.pickHostname(props.item.value)"><br/>- {{ $root.pickHostname(props.item.value) }}</span></td>
                      </tr>
                    </template>
                    <template v-slot:expanded-item="props">
                      <tr>
                        <td :colspan="5" class="case">
                          <v-container fluid class="my-2" v-if="props.item.artifactType == 'file'">
                            <a :target="$root.target('soc-download')" :href="`/api/case/artifactstream?id=${props.item.id}`" class="no-underline">
                              <v-icon>fa-download</v-icon>
                              {{ props.item.value }}
                              ({{ props.item.streamLength | formatCount }}
                              {{ i18n.bytes }})
                            </a>
                            <div class="mt-4">
                              <div class="font-weight-bold">{{i18n.sha256}}: </div>
                              <div :id="`evidence-${props.index}-sha256`" class="case">
                                {{ withDefault(props.item.sha256, i18n.unknown) }}
                                <v-icon class="ml-1" @click="$root.copyToClipboard(props.item.sha256)" :title="i18n.copyToClipboard">fa-copy</v-icon>
                              </div>
                            </div>
                            <div class="mt-2">
                              <div class="font-weight-bold">{{i18n.sha1}}: </div>
                              <div :id="`evidence-${props.index}-sha1`" class="case">
                                {{ withDefault(props.item.sha1, i18n.unknown) }}
                                <v-icon class="ml-1" @click="$root.copyToClipboard(props.item.sha1)" :title="i18n.copyToClipboard">fa-copy</v-icon>
                              </div>
                            </div>
                            <div class="mt-2">
                              <div class="font-weight-bold">{{i18n.md5}}: </div>
                              <div :id="`evidence-${props.index}-md5`" class="case">
                                {{ withDefault(props.item.md5, i18n.unknown) }}
                                <v-icon class="ml-1" @click="$root.copyToClipboard(props.item.md5)" :title="i18n.copyToClipboard">fa-copy</v-icon>
                              </div>
                            </div>
                          </v-container>
                          <v-container fluid class="pt-2 pb-0" v-if="props.item.artifactType != 'file'">
                            <div>
                              <div class="font-weight-bold">{{i18n.artifactValue}}: </div>
                              <div :id="`evidence-${props.index}-value`" class="case detail-field">{{ props.item.value }}</div>
                            </div>
                          </v-container>
                          <v-container fluid class="pt-2 pb-0">
                            <div tabindex="0" class="clicktoedit" @click="startEdit(`evidence-${props.index}-description-input`, props.item.description, `evidence-${props.index}-description`, 'description', modifyAssociation, ['evidence', props.item], true)"
                              @keypress.space.prevent="startEdit(`evidence-${props.index}-description-input`, props.item.description, `evidence-${props.index}-description`, 'description', modifyAssociation, ['evidence', props.item], true)">
                              <div class="font-weight-bold">{{i18n.artifactDescription}}: </div>
                              <div :id="`evidence-${props.index}-description`" class="case detail-field markdown-body" v-if="!isEdit(`evidence-${props.index}-description`)" :inner-html.prop="props.item.description | formatMarkdown"></div>
                            </div>
                            <div class="d-flex flex-column" v-if="isEdit(`evidence-${props.index}-description`)">
                              <v-form v-model="editForm.valid" @submit.prevent>
                                <div class="mb-2">
                                  <v-textarea full-width rows="3" multiline :id="`evidence-${props.index}-description-input`" hide-details="auto" outlined v-model="editForm.val" persistent-hint :hint="i18n.artifactDescriptionHelp"/>
                                </div>
                              </v-form>
                              <div class="d-inline-flex justify-end">
                                <v-btn text small color="primary" class="align-self-end" @click="stopEdit()">
                                  {{ i18n.cancel }}
                                </v-btn>
                                <v-btn :disabled="!editForm.valid" text small color="primary" class="align-self-end" @click="stopEdit(true)">
                                  {{ i18n.save }}
                                </v-btn>
                              </div>
                            </div>
                          </v-container>
                          <v-container fluid class="py-2">
                            <div tabindex="0" class="clicktoedit" @click="startEdit(`evidence-${props.index}-ioc-input`, props.item.ioc, `evidence-${props.index}-ioc`, 'ioc', modifyAssociation, ['evidence', props.item])"
                              @keypress.space.prevent="startEdit(`evidence-${props.index}-ioc-input`, props.item.ioc, `evidence-${props.index}-ioc`, 'ioc', modifyAssociation, ['evidence', props.item])">
                              <div class="font-weight-bold">{{i18n.artifactIoc}}: </div>
                              <div :id="`evidence-${props.index}-ioc`" class="case detail-field" v-if="!isEdit(`evidence-${props.index}-ioc`)">{{ props.item.ioc ? i18n.yes : i18n.no }}</div>
                            </div>
                            <v-checkbox :id="`evidence-${props.index}-ioc-input`" v-if="isEdit(`evidence-${props.index}-ioc`)" v-model="editForm.val" v-on:change="stopEdit(true)" persistent-hint :hint="i18n.artifactIocHelp"/>
                          </v-container>
                          <v-container fluid class="py-2">
                            <div tabindex="0" class="clicktoedit" @click="startEdit(`evidence-${props.index}-tlp-input`, props.item.tlp, `evidence-${props.index}-tlp`, 'tlp', modifyAssociation, ['evidence', props.item])"
                              @keypress.space.prevent="startEdit(`evidence-${props.index}-tlp-input`, props.item.tlp, `evidence-${props.index}-tlp`, 'tlp', modifyAssociation, ['evidence', props.item])">
                              <div class="font-weight-bold">{{i18n.caseTlp}}: </div>
                              <v-chip :id="`evidence-${props.index}-tlp`" :color="colorizeChip(props.item.tlp)" outlined v-if="!isEdit(`evidence-${props.index}-tlp`)">{{ withDefault(props.item.tlp, i18n.unknown) }}</v-chip>
                            </div>
                            <v-select :id="`evidence-${props.index}-tlp-input`" v-if="isEdit(`evidence-${props.index}-tlp`) && !isPresetCustomEnabled('tlp')"
                              dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.caseTlpHelp"
                              v-model="editForm.val"
                              :items="selectList('tlp', props.item.tlp)"
                              v-on:change="stopEdit(true)"
                              />
                              <v-combobox :id="`evidence-${props.index}-tlp-input`" v-if="isEdit(`evidence-${props.index}-tlp`) && isPresetCustomEnabled('tlp')"
                                dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.caseTlpHelp"
                                v-model="editForm.val"
                                :items="selectList('tlp', props.item.tlp)"
                                v-on:change="stopEdit(true)"
                              />
                            </v-select>
                          </v-container>
                          <v-container fluid class="py-2">
                            <div tabindex="0" class="clicktoedit" @click="startEdit(`evidence-${props.index}-tags-input`, props.item.tags, `evidence-${props.index}-tags`, 'tags', modifyAssociation, ['evidence', props.item])"
                              @keypress.space.prevent="startEdit(`evidence-${props.index}-tags-input`, props.item.tags, `evidence-${props.index}-tags`, 'tags', modifyAssociation, ['evidence', props.item])">
                              <div class="font-weight-bold">{{i18n.caseTags}}: </div>
                              <div :id="`evidence-${props.index}-tags`" class="case detail-field mt-1" v-if="!isEdit(`evidence-${props.index}-tags`)">
                                <v-chip class="mx-1" v-for="tag in props.item.tags" color="primary">{{ tag }}</v-chip>
                              </div>
                            </div>
                            <v-select :id="`evidence-${props.index}-tags-input`" v-if="isEdit(`evidence-${props.index}-tags`) && !isPresetCustomEnabled('tags')"
                              dense eager outlined hide-details="auto" class="case-select" multiple persistent-hint :hint="i18n.caseTagsHelp"
                              v-model="editForm.val"
                              :items="selectList('tags', props.item.tags)"
                              v-on:change="stopEdit(true)">
                              <template #selection="{ item }">
                                <v-chip color="primary">{{item}}</v-chip>
                              </template>
                            </v-select>
                            <v-combobox :id="`evidence-${props.index}-tags-input`" v-if="isEdit(`evidence-${props.index}-tags`) && isPresetCustomEnabled('tags')"
                              dense eager outlined hide-details="auto" class="case-select" multiple persistent-hint :hint="i18n.caseTagsHelp"
                              v-model="editForm.val"
                              :items="selectList('tags', props.item.tags)"
                              v-on:change="stopEdit(true)">
                              <template #selection="{ item }">
                                <v-chip color="primary">{{item}}</v-chip>
                              </template>
                            </v-combobox>
                          </v-container>

                          <v-container :id="`evidence-${props.index}-analyze-container`" fluid class="py-2" v-if="getAnalyzeJobs(props.item)">
                            <div>
                              <div class="font-weight-bold">{{i18n.analyzeJobs}}: </div>
                              <v-expansion-panels class="mb-6" hover="true" multiple="true">
                                <v-expansion-panel v-for="job in getAnalyzeJobs(props.item)" :id="`evidence-${props.index}-analyze-job-${job.id}`" >
                                  <v-expansion-panel-header disable-icon-rotate>
                                    <v-row>
                                      <v-col cols="12" md="4">
                                        {{ i18n.job }}: {{ job.id }}
                                      </v-col>
                                      <v-col cols="12" md="4">
                                        {{ job.createTime | formatDateTime }}
                                      </v-col>
                                      <v-col cols="12" md="4">
                                        {{ i18n.analyzers }}: {{ getAnalyzersInJob(job) }}
                                      </v-col>
                                    </v-row>
                                    <template v-slot:actions>
                                      <v-icon v-if="job.status == JobStatusPending" color="info">fa-clock</v-icon>
                                      <v-icon v-if="job.status == JobStatusCompleted" :title="$root.localizeMessage(getAnalyzeJobDecoration(job).help)" :color="getAnalyzeJobDecoration(job).color">{{ getAnalyzeJobDecoration(job).icon }}</v-icon>
                                      <v-icon v-if="job.status == JobStatusIncomplete" color="error">fa-exclamation</v-icon>
                                    </template>
                                  </v-expansion-panel-header>
                                  <v-expansion-panel-content>

                                    <v-expansion-panels class="mb-1" flat>
                                      <div class="my-4" v-if="job.status == JobStatusCompleted && !job.results">
                                        {{ i18n.analyzersUnavailable }}
                                      </div>
                                      <v-expansion-panel v-for="analyzer in job.results" :id="`evidence-${props.index}-analyze-job-${job.id}`" >
                                        <v-expansion-panel-header>
                                          <v-row>
                                            <v-col cols="12" md="3" class="font-weight-bold">
                                              {{ analyzer.id }}
                                            </v-col>
                                            <v-col cols="12" md="6">
                                              <v-icon class="mr-2" :title="$root.localizeMessage(getAnalyzerDecoration(analyzer).help)" :color="getAnalyzerDecoration(analyzer).color">{{ getAnalyzerDecoration(analyzer).icon }}</v-icon>
                                              {{ getAnalyzerSummary(analyzer) }}
                                            </v-col>
                                            <v-col cols="12" md="3">
                                              {{ i18n.bytes }}: {{ JSON.stringify(analyzer.data).length | formatCount }}
                                            </v-col>
                                          </v-row>
                                        </v-expansion-panel-header>
                                        <v-expansion-panel-content>
                                          <pre class="hardwrap">{{ analyzer.data }}</pre>
                                        </v-expansion-panel-content>
                                      </v-expansion-panel>
                                    </v-expansion-panels>

                                    <div class="d-flex flex-column flex-sm-row align-end align-sm-center align-self-end text-body-2">
                                      <v-avatar color="primary" size="24" class="mr-2 d-none d-sm-inline-flex white--text">
                                        <div class="case avatar-font" :title="job.owner">
                                          {{ $root.getAvatar(job.owner) }}
                                        </div>
                                      </v-avatar>
                                      <div class="mr-1">
                                        {{ job.owner }}
                                      </div>
                                      <div class="mr-1 d-none d-sm-block">
                                        &bull;
                                      </div>
                                      <div>
                                        {{ job.completeTime | formatDateTime }}
                                      </div>
                                      <div class="ml-1 d-flex">
                                        <v-btn text small color="red" @click="deleteAnalyzeJob(job)" icon><v-icon class="tiny-icon">fa-circle-xmark</v-icon></v-btn>
                                      </div>
                                      <v-spacer/>
                                    </div>

                                  </v-expansion-panel-content>
                                </v-expansion-panel>
                              </v-expansion-panels>
                            </div>
                          </v-container>

                          <div class="d-flex flex-column flex-sm-row align-end align-sm-center align-self-end text-body-2">
                            <v-spacer/>
                            <v-avatar color="primary" size="24" class="mr-2 d-none d-sm-inline-flex white--text">
                              <div class="case avatar-font" :title="props.item.owner">
                                {{ $root.getAvatar(props.item.owner) }}
                              </div>
                            </v-avatar>
                            <div class="mr-1">
                              {{ props.item.owner }}
                            </div>
                            <div class="mr-1 d-none d-sm-block">
                              &bull;
                            </div>
                            <div>
                              {{ props.item.createTime | formatDateTime }}
                            </div>
                            <div v-if="isEdited(props.item)" :title="$root.formatDateTime(props.item.updateTime)" class="mx-2">
                              {{ i18n.edited }}
                            </div>
                            <div class="ml-1 d-flex">
                              <v-btn text small color="red" @click="deleteAssociation('evidence', props.item)" icon><v-icon class="tiny-icon">fa-circle-xmark</v-icon></v-btn>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </template>
                    <template v-slot:no-results>
                      <v-alert :value="true" color="info" icon="fa-info">
                        {{ i18n.noSearchResults }}
                      </v-alert>
                    </template>
                  </v-data-table>
                  <div class="text-xs-center pt-2 d-none">
                      <v-btn v-text="i18n.loadMore" @click="loadAssociation('evidence')"></v-btn>
                  </div>
                </v-tab-item>

                <v-tab-item value="events">
                  <v-row>
                    <v-col>
                      <v-toolbar class="elevation-0" fixed>
                        <v-btn :title="i18n.refreshEventsHelp" color="secondary" @click.stop="reloadAssociation('events', true)" id="refresh-events-button">
                          <v-icon>fa-sync</v-icon>
                        </v-btn>
                      </v-toolbar>
                    </v-col>
                  </v-row>
                  <v-text-field v-model="associatedTable['events'].search" clearable prepend-icon="fa-filter" :label="i18n.filterResults" single-line hide-details></v-text-field>
                  <v-data-table ref="eventsTable" :sort-by.sync="associatedTable['events'].sortBy" :sort-desc.sync="associatedTable['events'].sortDesc" :items-per-page.sync="associatedTable['events'].itemsPerPage"
                    :search="associatedTable['events'].search" :footer-props="associatedTable['events'].footerProps" must-sort :headers="associatedTable['events'].headers"
                    :items="associations['events']" item-key="id" :loading="associatedTable['events'].loading" :expanded="associatedTable['events'].expanded" class="case-table">
                    <template v-slot:item="props">
                      <tr>
                        <td class="associated actions">
                          <v-btn :id="`events-${props.index}-expand`" icon small @click="expandRow('events', props.item)">
                            <v-icon v-if="isExpanded('events', props.item)" :alt="i18n.expand" :title="i18n.expandHelp">fa-angle-down</v-icon>
                            <v-icon v-if="!isExpanded('events', props.item)" :alt="i18n.expand" :title="i18n.expandHelp">fa-angle-right</v-icon>
                          </v-btn>
                          <router-link class="no-underline" :to="{ name: 'hunt', query: {q: buildHuntQuery(props.item)}}" :title="i18n.huntForEvent" v-if="props.item.fields['soc_id']">
                            <v-icon :title="i18n.huntForEvent">fa-crosshairs</v-icon>
                          </router-link>
                        </td>
                        <td class="associated">{{ props.item.fields["soc_timestamp"] | formatTimestamp }}</td>
                        <td class="associated">{{ getEventId(props.item) }}</td>
                        <td class="associated">{{ props.item.fields['event.category'] }}</td>
                        <td class="associated">{{ props.item.fields['event.module'] }}</td>
                        <td class="associated">{{ props.item.fields['event.dataset'] }}</td>
                      </tr>
                    </template>
                    <template v-slot:expanded-item="props">
                      <tr>
                        <td :colspan="6" class="case">
                          <div class="mt-2">
                            <v-row no-gutters class="py-1 case tabular-row" v-for="value, key in props.item.fields" v-if="!key.startsWith(internalPrefix)">
                              <v-col cols="1">
                                <v-btn :id="`events-${props.index}-addobservable`" icon small @click="populateAddObservableForm(key, value)">
                                  <v-icon :title="i18n.addObservable">fa-eye</v-icon>
                                </v-btn>
                                <router-link class="no-underline" :to="{ name: 'hunt', query: {q: buildHuntQueryForValue(value) }}">
                                  <v-icon :title="i18n.huntForFieldValue">fa-crosshairs</v-icon>
                                </router-link>
                              </v-col>
                              <v-col cols="4"><span class="case tabular-label">{{ key }}:</span></v-col>
                              <v-col cols="7"><span class="case">{{ value }}</span></v-col>
                            </v-row>
                          </div>

                          <div class="d-flex flex-column flex-sm-row align-end align-sm-center align-self-end text-body-2">
                            <v-spacer/>
                            <v-avatar color="primary" size="24" class="mr-2 d-none d-sm-inline-flex white--text">
                              <div class="case avatar-font" :title="props.item.owner">
                                {{ $root.getAvatar(props.item.owner) }}
                              </div>
                            </v-avatar>
                            <div class="mr-1">
                              {{ props.item.owner }}
                            </div>
                            <div class="mr-1 d-none d-sm-block">
                              &bull;
                            </div>
                            <div>
                              {{ props.item.createTime | formatDateTime }}
                            </div>
                            <div class="ml-1 d-flex">
                              <v-btn text small color="red" @click="deleteAssociation('events', props.item)" icon><v-icon class="tiny-icon">fa-circle-xmark</v-icon></v-btn>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </template>
                    <template v-slot:no-results>
                      <v-alert :value="true" color="info" icon="fa-info">
                        {{ i18n.noSearchResults }}
                      </v-alert>
                    </template>
                  </v-data-table>
                  <div class="text-xs-center pt-2 d-none">
                      <v-btn v-text="i18n.loadMore" @click="loadAssociation('events')"></v-btn>
                  </div>
                </v-tab-item>

                <v-tab-item value="history">
                  <v-row>
                    <v-col>
                      <v-toolbar class="elevation-0" fixed>
                        <v-btn :title="i18n.refreshHistoryHelp" color="secondary" @click.stop="reloadAssociation('history', true)" id="refresh-history-button">
                          <v-icon>fa-sync</v-icon>
                        </v-btn>
                      </v-toolbar>
                    </v-col>
                  </v-row>
                  <v-text-field v-model="associatedTable['history'].search" clearable prepend-icon="fa-filter" :label="i18n.filterResults" single-line hide-details></v-text-field>
                  <v-data-table ref="historyTable" :sort-by.sync="associatedTable['history'].sortBy" :sort-desc.sync="associatedTable['history'].sortDesc" :items-per-page.sync="associatedTable['history'].itemsPerPage"
                    :search="associatedTable['history'].search" :footer-props="associatedTable['history'].footerProps" must-sort :headers="associatedTable['history'].headers"
                    :items="associations['history']" item-key="id" :loading="associatedTable['history'].loading" :expanded="associatedTable['history'].expanded" class="case-table">
                    <template v-slot:item="props">
                      <tr>
                        <td class="associated actions">
                          <v-btn :id="`history-${props.index}-expand`" icon small @click="expandRow('history', props.item)">
                            <v-icon v-if="isExpanded('history', props.item)" :alt="i18n.expand" :title="i18n.expandHelp">fa-angle-down</v-icon>
                            <v-icon v-if="!isExpanded('history', props.item)" :alt="i18n.expand" :title="i18n.expandHelp">fa-angle-right</v-icon>
                          </v-btn>
                        </td>
                        <td class="associated">
                          <v-avatar color="primary" class="mr-2 white--text" size="28">
                            <div class="font-weight-bold" :title="props.item.owner">
                              {{ $root.getAvatar(props.item.owner) }}
                            </div>
                          </v-avatar>
                          {{ props.item.owner }}
                        </td>
                        <td class="associated">{{ props.item.updateTime | formatDateTime }}</td>
                        <td class="associated">
                          <v-icon v-if="props.item.kind == i18n.case">fa-briefcase</v-icon>
                          <v-icon v-if="props.item.kind == i18n.comments">fa-comments</v-icon>
                          <v-icon v-if="props.item.kind == i18n.attachments">fa-paperclip</v-icon>
                          <v-icon v-if="props.item.kind == i18n.evidence">fa-eye</v-icon>
                          <v-icon v-if="props.item.kind == i18n.events">fa-link</v-icon>
                          <span class="rounded ml-2">{{ props.item.kind }}</span>
                        </td>
                        <td class="associated">
                          <v-icon v-if="props.item.operation == i18n.create">fa-plus</v-icon>
                          <v-icon v-if="props.item.operation == i18n.delete">fa-circle-xmark</v-icon>
                          <v-icon v-if="props.item.operation == i18n.update">fa-pencil-alt</v-icon>
                          <span class="rounded ml-2">{{ props.item.operation }}</span>
                        </td>
                      </tr>
                    </template>
                    <template v-slot:expanded-item="props">
                      <tr>
                        <td colspan="5" class="case">
                          <div class="mt-2">
                            <v-row no-gutters class="py-1 case tabular-row">
                              <v-col cols="4"><span class="case tabular-label">{{ i18n.id }}:</span></v-col>
                              <v-col cols="8"><span class="case">{{ props.item.id }}</span></v-col>
                            </v-row>
                          </div>
                          <div>
                            <v-row no-gutters class="py-1 case tabular-row">
                              <v-col cols="4"><span class="case tabular-label">{{ i18n.kind }}:</span></v-col>
                              <v-col cols="8"><span class="case">{{ props.item.kind }}</span></v-col>
                            </v-row>
                          </div>
                          <div>
                            <v-row no-gutters class="py-1 case tabular-row">
                              <v-col cols="4"><span class="case tabular-label">{{ i18n.operation }}:</span></v-col>
                              <v-col cols="8"><span class="case">{{ props.item.operation }}</span></v-col>
                            </v-row>
                          </div>
                          <div>
                            <v-row no-gutters class="py-1 case tabular-row">
                              <v-col cols="4"><span class="case tabular-label">{{ i18n.dateCreated }}:</span></v-col>
                              <v-col cols="8"><span class="case">{{ props.item.createTime | formatDateTime }}</span></v-col>
                            </v-row>
                          </div>
                          <div>
                            <v-row no-gutters class="py-1 case tabular-row">
                              <v-col cols="4"><span class="case tabular-label">{{ i18n.dateModified }}:</span></v-col>
                              <v-col cols="8"><span class="case">{{ props.item.updateTime | formatDateTime }}</span></v-col>
                            </v-row>
                          </div>
                          <div v-if="props.item.kind == i18n.case">
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.caseTitle }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.title }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.caseDescription }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.description }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.caseAssignee }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.assignee }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.caseStatus }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.status }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.caseSeverity }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.severity }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.casePriority }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.priority }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.caseTlp }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.tlp }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.caseCategory }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.category }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.caseTags }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.tags }}</span></v-col>
                              </v-row>
                            </div>
                          </div>
                          <div v-if="props.item.kind == i18n.comments">
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.commentDescription }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.description }}</span></v-col>
                              </v-row>
                            </div>
                            <div v-if="$root.isLicensed(FEAT_TTR)">
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.commentHours }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.hours }}</span></v-col>
                              </v-row>
                            </div>
                          </div>
                          <div v-if="props.item.kind == i18n.events">
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.relatedEventId }}:</span></v-col>
                                <v-col cols="8"><span class="case value">
                                  <router-link v-if="props.item.fields.soc_id" class="no-underline" :to="{ name: 'hunt', query: {q: buildHuntQuery(props.item) }}">
                                    {{ props.item.fields.soc_id }}
                                  </router-link>
                                  <span v-if="!props.item.fields.soc_id">
                                    {{ i18n.caseEventIdAggregation }}
                                  </span>
                                </span></v-col>
                              </v-row>
                            </div>
                          </div>
                          <div v-if="props.item.kind == i18n.attachments">
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.artifactGroupType }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.groupType }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.artifactGroupId }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.groupId }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.filename }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.value }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.description }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.description }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.caseTlp }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.tlp }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.caseTags }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.tags }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.artifactProtected }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.protected }}</span></v-col>
                              </v-row>
                            </div>
                          </div>
                          <div v-if="props.item.kind == i18n.evidence">
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.artifactGroupType }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.groupType }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.artifactGroupId }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.groupId }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.artifactType }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.artifactType }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.value }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.value }}<span class="resolved-host" v-if="props.item.artifactType === 'ip' && $root.pickHostname(props.item.value)"> - {{ $root.pickHostname(props.item.value) }}</span></span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.description }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.description }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.caseTlp }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.tlp }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.artifactIoc }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.ioc }}</span></v-col>
                              </v-row>
                            </div>
                            <div>
                              <v-row no-gutters class="py-1 case tabular-row">
                                <v-col cols="4"><span class="case tabular-label">{{ i18n.caseTags }}:</span></v-col>
                                <v-col cols="8"><span class="case">{{ props.item.tags }}</span></v-col>
                              </v-row>
                            </div>
                          </div>

                          <div class="d-flex flex-column flex-sm-row align-end align-sm-center align-self-end text-body-2">
                            <v-spacer/>
                            <v-avatar color="primary" size="24" class="mr-2 d-none d-sm-inline-flex white--text">
                              <div class="case avatar-font" :title="props.item.owner">
                                {{ $root.getAvatar(props.item.owner) }}
                              </div>
                            </v-avatar>
                            <div class="mr-1">
                              {{ props.item.owner }}
                            </div>
                            <div class="mr-1 d-none d-sm-block">
                              &bull;
                            </div>
                            <div>
                              {{ props.item.updateTime | formatDateTime }}
                            </div>
                          </div>
                        </td>
                      </tr>
                    </template>
                    <template v-slot:no-results>
                      <v-alert :value="true" color="info" icon="fa-info">
                        {{ i18n.noSearchResults }}
                      </v-alert>
                    </template>
                  </v-data-table>
                  <div class="text-xs-center pt-2 d-none">
                      <v-btn v-text="i18n.loadMore" @click="loadAssociation('history')"></v-btn>
                  </div>
                </v-tab-item>

              <v-tabs>
            </v-row>
          </v-col>
          <v-col cols="12" md="3" order="1" order-md="2">
              <v-row no-gutters>
                <v-col class="d-flex flex-column justify-center text-truncate">

                    <v-expansion-panels multiple focusable v-model="expanded">
                      <v-expansion-panel>
                        <v-expansion-panel-header>
                          <h3>{{ i18n.summary }}</h3>
                        </v-expansion-panel-header>
                        <v-expansion-panel-content class="my-2">
                            <v-row>
                              <v-col cols="12">
                                <div tabindex="0" class="clicktoedit" @click="startEdit('case-assignee-input', caseObj.assigneeId, 'case-assignee', 'assigneeId', modifyCase)"
                                  @keypress.space.prevent="startEdit('case-assignee-input', caseObj.assigneeId, 'case-assignee', 'assigneeId', modifyCase)">
                                  <div class="font-weight-bold">{{i18n.caseAssignee}}: </div>
                                  <div id='case-assignee' class="case detail-field" v-if="!isEdit('case-assignee')">{{ withDefault(caseObj.assignee, i18n.unassigned) }}</div>
                                  <v-select id='case-assignee-input' v-if="isEdit('case-assignee')"
                                    dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.caseAssigneeHelp"
                                    v-model="editForm.val"
                                    :items="userList"
                                    item-text="email"
                                    item-value="id"
                                    v-on:change="stopEdit(true)"
                                  />
                                </div>
                              </v-col>
                            </v-row>
                            <v-row>
                              <v-col cols="12">
                                <div tabindex="0" class="clicktoedit" @click="startEdit('case-status-input', caseObj.status, 'case-status', 'status', modifyCase)"
                                  @keypress.space.prevent="startEdit('case-status-input', caseObj.status, 'case-status', 'status', modifyCase)">
                                  <div class="font-weight-bold">{{i18n.status}}: </div>
                                  <div id="case-status" class="case detail-field" v-if="!isEdit('case-status')">{{ withDefault(caseObj.status, i18n.unknown) }}</div>
                                  <v-select id="case-status-input" v-if="isEdit('case-status') && !isPresetCustomEnabled('status')"
                                    dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.caseStatusHelp"
                                    v-model="editForm.val"
                                    :items="selectList('status', caseObj.status)"
                                    v-on:change="stopEdit(true)"
                                  />
                                  <v-combobox id="case-status-input" v-if="isEdit('case-status') && isPresetCustomEnabled('status')"
                                    dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.caseStatusHelp"
                                    v-model="editForm.val"
                                    :items="selectList('status', caseObj.status)"
                                    v-on:change="stopEdit(true)"
                                  />
                                </div>
                              </v-col>
                            </v-row>
                            <v-row v-if="$root.isLicensed(FEAT_TTR)">
                              <v-col cols="12">
                                <div>
                                  <div class="font-weight-bold">{{ i18n.caseHours }}: </div>
                                  <div id="total-hours" class="case detail-field">{{ sumHours() | formatHours }} {{ i18n.hours }}</div>
                                </div>
                              </v-col>
                            </v-row>
                        </v-expansion-panel-content>
                      </v-expansion-panel>

                      <v-expansion-panel>
                        <v-expansion-panel-header>
                          <h3>{{ i18n.details }}</h3>
                        </v-expansion-panel-header>
                        <v-expansion-panel-content class="my-2">

                            <v-row>
                              <v-col cols="12">
                                <div tabindex="0" class="clicktoedit" @click="startEdit('case-severity-input', caseObj.severity, 'case-severity', 'severity', modifyCase)"
                                  @keypress.space.prevent="startEdit('case-severity-input', caseObj.severity, 'case-severity', 'severity', modifyCase)">
                                  <div class="font-weight-bold">{{i18n.caseSeverity}}: </div>
                                  <div id="case-severity" class="case detail-field" v-if="!isEdit('case-severity')">{{ withDefault(caseObj.severity, i18n.unknown) }}</div>
                                </div>
                                <v-select id="case-severity-input" v-if="isEdit('case-severity') && !isPresetCustomEnabled('severity')"
                                  dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.caseSeverityHelp"
                                  v-model="editForm.val"
                                  :items="selectList('severity', caseObj.severity)"
                                  v-on:change="stopEdit(true)"
                                />
                                <v-combobox id="case-severity-input" v-if="isEdit('case-severity') && isPresetCustomEnabled('severity')"
                                  dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.caseSeverityHelp"
                                  v-model="editForm.val"
                                  :items="selectList('severity', caseObj.severity)"
                                  v-on:change="stopEdit(true)"
                                />
                              </v-col>
                            </v-row>
                            <v-row>
                              <v-col cols="12">
                                <div tabindex="0" class="clicktoedit" @click="startEdit('case-priority-input', caseObj.priority, 'case-priority', 'priority', modifyCase)"
                                  @keypress.space.prevent="startEdit('case-priority-input', caseObj.priority, 'case-priority', 'priority', modifyCase)">
                                  <div class="font-weight-bold">{{i18n.casePriority}}: </div>
                                  <div id="case-priority" class="case detail-field" v-if="!isEdit('case-priority')">{{ caseObj.priority }}</div>
                                </div>
                                <div v-if="isEdit('case-priority')">
                                  <v-form v-model="editForm.valid" @submit.prevent>
                                    <div class="mb-2">
                                      <v-text-field id="case-priority-input" outlined hide-details="auto" rows="3" dense no-resize v-model="editForm.val" :rules="[rules.number]" persistent-hint :hint="i18n.casePriorityHelp"/>
                                    </div>
                                  </v-form>
                                  <div class="d-inline-flex justify-end">
                                    <v-btn text small color="primary" class="align-self-end" @click="stopEdit()">
                                      {{ i18n.cancel }}
                                    </v-btn>
                                    <v-btn :disabled="!editForm.valid" text small color="primary" class="align-self-end" @click="stopEdit(true)">
                                      {{ i18n.save }}
                                    </v-btn>
                                  </div>
                                </div>
                              </v-col>
                            </v-row>
                            <v-row>
                              <v-col cols="12">
                                <div tabindex="0" class="clicktoedit" @click="startEdit('case-tlp-input', caseObj.tlp, 'case-tlp', 'tlp', modifyCase)"
                                  @keypress.space.prevent="startEdit('case-tlp-input', caseObj.tlp, 'case-tlp', 'tlp', modifyCase)">
                                  <div class="font-weight-bold">{{i18n.caseTlp}}: </div>
                                  <v-chip :color="colorizeChip(caseObj.tlp)" outlined id="case-tlp" v-if="!isEdit('case-tlp')">{{ withDefault(caseObj.tlp, i18n.unknown) }}</v-chip>
                                </div>
                                <v-select id="case-tlp-input" v-if="isEdit('case-tlp') && !isPresetCustomEnabled('tlp')"
                                  dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.caseTlpHelp"
                                  v-model="editForm.val"
                                  :items="selectList('tlp', caseObj.tlp)"
                                  v-on:change="stopEdit(true)"
                                  />
                                  <v-combobox id="case-tlp-input" v-if="isEdit('case-tlp') && isPresetCustomEnabled('tlp')"
                                    dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.caseTlpHelp"
                                    v-model="editForm.val"
                                    :items="selectList('tlp', caseObj.tlp)"
                                    v-on:change="stopEdit(true)"
                                  />
                                </v-select>
                              </v-col>
                            </v-row>
                            <v-row>
                              <v-col cols="12">
                                <div tabindex="0" class="clicktoedit" @click="startEdit('case-pap-input', caseObj.pap, 'case-pap', 'pap', modifyCase)"
                                  @keypress.space.prevent="startEdit('case-pap-input', caseObj.pap, 'case-pap', 'pap', modifyCase)">
                                  <div class="font-weight-bold">{{i18n.casePap}}: </div>
                                  <v-chip :color="colorizeChip(caseObj.pap)" outlined id="case-pap" v-if="!isEdit('case-pap')">{{ withDefault(caseObj.pap, i18n.unknown) }}</v-chip>
                                </div>
                                <v-select id="case-pap-input" v-if="isEdit('case-pap') && !isPresetCustomEnabled('pap')"
                                  dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.casePapHelp"
                                  v-model="editForm.val"
                                  :items="selectList('pap', caseObj.pap)"
                                  v-on:change="stopEdit(true)"
                                />
                                <v-combobox id="case-pap-input" v-if="isEdit('case-pap') && isPresetCustomEnabled('pap')"
                                  dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.casePapHelp"
                                  v-model="editForm.val"
                                  :items="selectList('pap', caseObj.pap)"
                                  v-on:change="stopEdit(true)"
                                />
                              </v-col>
                            </v-row>
                            <v-row>
                              <v-col cols="12">
                                <div tabindex="0" class="clicktoedit" @click="startEdit('case-category-input', caseObj.category, 'case-category', 'category', modifyCase)"
                                  @keypress.space.prevent="startEdit('case-category-input', caseObj.category, 'case-category', 'category', modifyCase)">
                                  <div class="font-weight-bold">{{i18n.caseCategory}}: </div>
                                  <div id="case-category" class="case detail-field" v-if="!isEdit('case-category')">{{ withDefault(caseObj.category, i18n.unknown) }}</div>
                                </div>
                                <v-select id="case-category-input" v-if="isEdit('case-category') && !isPresetCustomEnabled('category')"
                                  dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.caseCategoryHelp"
                                  v-model="editForm.val"
                                  :items="selectList('category', caseObj.category)"
                                  v-on:change="stopEdit(true)"
                                />
                                <v-combobox id="case-category-input" v-if="isEdit('case-category') && isPresetCustomEnabled('category')"
                                  dense eager outlined hide-details="auto" class="case-select" persistent-hint :hint="i18n.caseCategoryHelp"
                                  v-model="editForm.val"
                                  :items="selectList('category', caseObj.category)"
                                  v-on:change="stopEdit(true)"
                                />
                              </v-col>
                            </v-row>
                            <v-row>
                              <v-col cols="12">
                                <div tabindex="0" class="clicktoedit" @click="startEdit('case-tags-input', caseObj.tags, 'case-tags', 'tags', modifyCase)"
                                  @keypress.space.prevent="startEdit('case-tags-input', caseObj.tags, 'case-tags', 'tags', modifyCase)">
                                  <div class="font-weight-bold">{{i18n.caseTags}}: </div>
                                  <div id="case-tags" class="case detail-field mt-1" v-if="!isEdit('case-tags')">
                                    <v-chip class="mx-1" v-for="tag in caseObj.tags" color="primary">{{ tag }}</v-chip>
                                  </div>
                                </div>
                                <v-select id="case-tags-input" v-if="isEdit('case-tags') && !isPresetCustomEnabled('tags')"
                                  dense eager outlined hide-details="auto" class="case-select" multiple persistent-hint :hint="i18n.caseTagsHelp"
                                  v-model="editForm.val"
                                  :items="selectList('tags', caseObj.tags)"
                                  v-on:change="stopEdit(true)"
                                >
                                  <template #selection="{ item }">
                                    <v-chip color="primary">{{item}}</v-chip>
                                  </template>
                                </v-select>
                                <v-combobox id="case-tags-input" v-if="isEdit('case-tags') && isPresetCustomEnabled('tags')"
                                  dense eager outlined hide-details="auto" class="case-select" multiple persistent-hint :hint="i18n.caseTagsHelp"
                                  v-model="editForm.val"
                                  :items="selectList('tags', caseObj.tags)"
                                  v-on:change="stopEdit(true)"
                                >
                                  <template #selection="{ item }">
                                    <v-chip color="primary">{{item}}</v-chip>
                                  </template>
                                </v-combobox>
                              </v-col>
                            </v-row>
                        </v-expansion-panel-content>
                      </v-expansion-panel>
                    </v-expansion-panels>

                  <div class="ml-2 mt-2">
                    <div class="case summary">
                      <span class="case label">{{ i18n.caseId }}:</span>
                      <span class="case value">{{ caseObj.id }}</span>
                    </div>
                    <div class="case summary">
                      <span class="case label">{{ i18n.author }}:</span>
                      <span class="case value">{{ caseObj.owner }}</span>
                    </div>
                    <div class="case summary">
                      <span class="case label">{{ i18n.dateCreated }}:</span>
                      <span class="case value">{{ caseObj.createTime | formatDateTime}}</span>
                    </div>
                    <div class="case summary">
                      <span class="case label">{{ i18n.dateModified }}:</span>
                      <span class="case value">{{ caseObj.updateTime | formatDateTime}}</span>
                    </div>
                    <div class="case summary" v-if="$root.formatDateTime(caseObj.completeTime) !== ''">
                      <span class="case label">{{ i18n.dateClosed }}:</span>
                      <span class="case value">{{ caseObj.completeTime | formatDateTime}}</span>
                    </div>
                  </div>
                </v-col>
              </v-row>
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-grid">
      <v-container fluid>
        <v-row>
          <v-col cols="4">
            <h2 v-text="i18n.grid"></h2>
          </v-col>
          <v-col cols="5">
            <v-expansion-panels>
              <v-expansion-panel>
                <v-expansion-panel-header id="gridOptionsHeader">{{i18n.options}}</v-expansion-panel-header>
                <v-expansion-panel-content>
                  <v-select id="gridTimezone" @change="saveTimezone" v-model="zone" :items="$root.timezones" :hint="i18n.timezoneHelp" persistent-hint prepend-icon="fa-user-clock"></v-select>
                  <v-checkbox id="moreColumns" v-model="moreColumns" :hint="i18n.moreColumnsHelp" persistent-hint :label="i18n.moreColumns"></v-checkbox>
                </v-expansion-panel-content>
              </v-expansion-panel>
            </v-expansion-panels>
          </v-col>
          <v-col cols="3" align="end">
            <h4 v-if="metricsEnabled">{{ i18n.gridEps }} {{ gridEps | formatCount }}</h4>
          </v-col>
        </v-row>
        <v-row>
          <v-col>
            <v-data-table :search="gridFilter" :sort-by.sync="sortBy" :sort-desc.sync="sortDesc"
              :expanded.sync="expanded" :footer-props="footerProps" show-expand
              :items-per-page.sync="itemsPerPage" must-sort :headers="headers" :items="nodes">
              <template v-slot:top>
                <v-container fluid>
                  <v-row>
                    <v-col lg="6" class="d-none d-lg-block">
                    </v-col>
                    <v-col cols="12" lg="6">
                      <v-text-field v-model="gridFilter" clearable prepend-icon="fa-filter" :label="i18n.filterResults" single-line hide-details></v-text-field>
                    </v-col>
                  </v-row>
                </v-container>
              </template>
              <template v-slot:item="props">
                <tr color="error">
                  <td>
                    <v-btn :id="'expandNode_' + props.item.id" icon small @click="expand(props.item)">
                      <v-icon v-if="isExpanded(props.item)" :alt="i18n.expand" :title="i18n.nodeExpandHelp">fa-angle-down</v-icon>
                      <v-icon v-if="!isExpanded(props.item)" :alt="i18n.expand" :title="i18n.nodeExpandHelp">fa-angle-right</v-icon>
                    </v-btn>
                  </td>
                  <td>
                    <v-icon v-if="props.item.status != NodeStatusOk" :id="'nodeFaultIcon_' + props.item.id" :color="colorNodeStatus(props.item.status, props.item.nonCriticalNode)">{{ props.item.status | iconNodeStatus }}</v-icon>
                  </td>
                  <td :id="'nodeId_' + props.item.id" v-text="props.item.id"></td>
                  <td :id="'nodeRole_' + props.item.id" v-text="$root.localizeMessage(props.item.role)" class="d-none d-md-table-cell"></td>
                  <td :id="'nodeAddress_' + props.item.id" v-text="props.item.address" class="d-none d-lg-table-cell"></td>
                  <td :id="'nodeVersion_' + props.item.id" v-text="props.item.version" class="d-none d-lg-table-cell"></td>
                  <td :id="'nodeModel_' + props.item.id" v-text="props.item.model" class="d-none d-lg-table-cell"></td>
                  <td v-if="metricsEnabled" class="d-none d-lg-table-cell">
                    <span :id="'nodeEps_' + props.item.id">{{ props.item.consumptionEps | formatCount }}</span>
                  </td>
                  <td v-if="metricsEnabled" class="d-none d-xl-table-cell">
                    <span :id="'nodeMemUsed_' + props.item.id">{{ props.item.memoryUsedPct | formatDecimal1 }}%</span>
                  </td>
                  <td v-if="metricsEnabled" class="d-none d-xl-table-cell">
                    <span :id="'nodeDiskUsedRoot_' + props.item.id">{{ props.item.diskUsedRootPct | formatDecimal1 }}%</span>
                  </td>
                  <td v-if="metricsEnabled" class="d-none d-xl-table-cell">
                    <span :id="'nodeDiskUsedNsm_' + props.item.id">{{ props.item.diskUsedNsmPct | formatDecimal1 }}%</span>
                  </td>
                  <td v-if="metricsEnabled" class="d-none d-xl-table-cell">
                    <span :id="'nodeCpuUsed_' + props.item.id">{{ props.item.cpuUsedPct | formatDecimal1 }}%</span>
                  </td>
                  <td v-if="metricsEnabled" class="d-none d-xl-table-cell">
                    <span :id="'nodeTrafficManIn_' + props.item.id">{{ props.item.trafficManInMbs | formatDecimal1 }} {{ i18n.mbps }}</span>
                  </td>
                  <td v-if="metricsEnabled" class="d-none d-xl-table-cell">
                    <span :id="'nodeTrafficManOut_' + props.item.id">{{ props.item.trafficManOutMbs | formatDecimal1 }} {{ i18n.mbps }}</span>
                  </td>
                  <td v-if="metricsEnabled && moreColumns" class="d-none d-xl-table-cell">
                    <span :id="'nodeTrafficMonIn_' + props.item.id">{{ props.item.trafficMonInMbs | formatDecimal1 }} {{ i18n.mbps }}</span>
                  </td>
                  <td v-if="metricsEnabled && moreColumns" class="d-none d-xl-table-cell">
                    <span :id="'nodeTrafficMonInDrops_' + props.item.id">{{ props.item.trafficMonDropsMbs | formatDecimal1 }} {{ i18n.mbps }}</span>
                  </td>
                  <td v-if="metricsEnabled && moreColumns" class="d-none d-xl-table-cell">
                    <span :id="'nodeCaptureLoss_' + props.item.id">{{ props.item.captureLossPct | formatDecimal1 }}%</span>
                  </td>
                  <td v-if="metricsEnabled && moreColumns" class="d-none d-xl-table-cell">
                    <span :id="'nodeZeekLoss_' + props.item.id">{{ props.item.zeekLossPct | formatDecimal1 }}%</span>
                  </td>
                  <td v-if="metricsEnabled && moreColumns" class="d-none d-xl-table-cell">
                    <span :id="'nodeSuriLoss_' + props.item.id">{{ props.item.suriLossPct | formatDecimal1 }}%</span>
                  </td>
                  <td v-if="metricsEnabled && moreColumns" class="d-none d-xl-table-cell">
                    <span :id="'nodeStenoLoss_' + props.item.id">{{ props.item.stenoLossPct | formatDecimal1 }}%</span>
                  </td>
                  <td v-if="metricsEnabled && moreColumns" class="d-none d-xl-table-cell">
                    <span :id="'nodePcapDays_' + props.item.id">{{ props.item.pcapDays | formatDecimal1 }} {{ i18n.days }}</span>
                  </td>
                  <td :id="'nodeUpdateTimeAgo_' + props.item.id" class="d-none d-lg-table-cell">{{ props.item.updateTime | formatDuration }} {{i18n.ago}}</td>
                  <td :id="'nodeUptimeSeconds_' + props.item.id" class="d-none d-lg-table-cell">{{ props.item.uptimeSeconds | formatDuration }}</td>
                  <td><v-chip :id="'nodeStatus_' + props.item.id" class="nodeStatus" @click="expand(props.item)" :color="colorNodeStatus(props.item.status, props.item.nonCriticalNode)">{{ $root.localizeMessage(props.item.status) }}</v-chip></td>
                </tr>
              </template>
              <template v-slot:expanded-item="{ item }">
                <tr>
                  <td :colspan="headers.length" class="px-0">
                    <v-container fluid grid-list-sm class="pa-4">
                      <v-row>
                        <v-col cols="12" lg="4">
                          <v-card>
                            <v-card-title v-text="i18n.nodeStatus"/>
                            <v-card-text>
                              <div class="text-no-wrap">
                                <span class="filter label">{{ i18n.id }}:</span>
                                <span id="node_id" class="filter value">{{ item.id }}</span>
                              </div>
                              <div class="text-no-wrap">
                                <span class="filter label">{{ i18n.role }}:</span>
                                <span id="node_role" class="filter value">{{ $root.localizeMessage(item.role) }}</span>
                              </div>
                              <div class="text-no-wrap">
                                <span class="filter label">{{ i18n.address }}:</span>
                                <span id="node_address" class="filter value">{{ item.address }}</span>
                              </div>
                              <div class="text-no-wrap">
                                <span class="filter label">{{ i18n.version }}:</span>
                                <span id="node_version" class="filter value">{{ item.version }}</span>
                              </div>
                              <div class="text-no-wrap">
                                <span class="filter label">{{ i18n.model }}:</span>
                                <span id="node_model" class="filter value">{{ item.model }}</span>
                              </div>
                              <div class="text-no-wrap">
                                <span class="filter label">{{ i18n.dateOnline }}:</span>
                                <span id="node_createTime" class="filter value">{{ item.onlineTime | toTZ }}</span>
                              </div>
                              <div v-if="canTest(item)" class="text-no-wrap">
                                <span class="filter label">{{ i18n.dateDataEpoch }}:</span>
                                <span id="node_dataEpoch" class="filter value">{{ item.epochTime | toTZ }}</span>
                              </div>
                              <div class="text-no-wrap">
                                <span class="filter label">{{ i18n.dateUpdated }}:</span>
                                <span id="node_updateTime" class="filter value">{{ item.updateTime | toTZ }}</span>
                              </div>
                              <div class="text-no-wrap">
                                <span class="filter label">{{ i18n.uptime }}:</span>
                                <span id="node_age" :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'">{{ item.uptimeSeconds | formatDuration }}</span>
                              </div>
                              <div class="text-no-wrap">
                                <span class="filter label">{{ i18n.osUptime }}:</span>
                                <span id="node_uptime" :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'">
                                  {{ item.osUptimeSeconds | formatDuration }}
                                  <span v-if="item.osNeedsRestart" id="node_restart-required-note" :class="areMetricsCurrent(item) ? 'warning--text' : 'warning--text stale'">
                                    {{ i18n.restartRequired }}
                                  </span>
                                </span>
                              </div>
                              <div v-if="item.metricsEnabled" class="text-no-wrap">
                                <span class="filter label">{{ i18n.lastHighstate }}:</span>
                                <span id="node_last_highstate" :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'">
                                  <span v-if="item.highstateAgeSeconds > UNREALISTIC_AGE">
                                    {{ i18n.never }}
                                  </span>
                                  <span v-else>
                                    {{ item.highstateAgeSeconds | formatDuration }} {{i18n.ago}}
                                  </span>
                                </span>
                              </div>
                              <div v-if="item.metricsEnabled" class="text-no-wrap">
                                <span class="filter label">{{ i18n.nodeStatusProcess }}</span>
                                <span id="node_processStatus" :class="areMetricsCurrent(item) ? colorNodeStatus(item.processStatus) + '--text filter value' : 'filter value stale'">
                                  {{ $root.localizeMessage(item.processStatus) }}
                                  <span v-if="item.nonCriticalNode" id="node_processStatusNonCritical">({{i18n.nonCriticalNode}})</span>
                                </span>
                              </div>
                              <div class="text-no-wrap">
                                <span class="filter label">{{ i18n.nodeStatusConnection }}</span>
                                <span id="node_connectionStatus" :class="areMetricsCurrent(item) ? colorNodeStatus(item.connectionStatus, item.nonCriticalNode) + '--text filter value' : 'filter value stale'">
                                  {{ $root.localizeMessage(item.connectionStatus) }}
                                  <span v-if="item.nonCriticalNode" id="node_connectionStatusNonCritical">({{i18n.nonCriticalNode}})</span>
                                </span>
                              </div>
                              <div v-if="item.metricsEnabled && hasEventstoreHealth(item)"  class="text-no-wrap">
                                <span class="filter label">{{ i18n.eventstoreStatus }}:</span>
                                <span id="node_eventstoreStatus" :class="areMetricsCurrent(item) ? colorNodeStatus(item.eventstoreStatus) + '--text filter value' : 'filter value stale'">
                                  {{ $root.localizeMessage(item.eventstoreStatus) }}
                                </span>
                              </div>
                              <div v-if="item.metricsEnabled" class="text-no-wrap">
                                <span class="filter label">{{ i18n.nodeStatusRaid }}</span>
                                <span>
                                  <span v-if="!item.raidStatus || item.raidStatus == NodeStatusUnknown" id="node_raidStatus" class="info--text filter value">
                                    {{ i18n.featureRequiresAppliance }}
                                  </span>
                                  <span v-else id="node_raidStatus" v-text="$root.localizeMessage(item.raidStatus)" :class="areMetricsCurrent(item) ? colorNodeStatus(item.raidStatus) + '--text filter value' : 'filter value stale'"/>
                                </span>
                              </div>

                              <div v-if="item.metricsEnabled && hasEventstore(item)" class="text-no-wrap">
                                <span class="filter label">{{ i18n.epsConsumption }}</span>
                                <span id="node_consumptionEps" :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'">{{ item.consumptionEps | formatCount }}</span>
                              </div>
                              <div v-if="item.metricsEnabled" class="text-no-wrap">
                                <span class="filter label">{{ i18n.memUsage }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'">
                                  <v-progress-linear id="node_memory" :value="item.memoryUsedPct" height="15" :color="formatLinearColor(item.memoryUsedPct, 70, 80, 90)">
                                    <template v-slot:default="{ value }">
                                      <strong>{{ item.memoryUsedPct | formatDecimal1 }}% {{ i18n.of }} {{ item.memoryTotalGB | formatDecimal1 }} {{ i18n.gigabytes }}</strong>
                                    </template>
                                  </v-progress-linear>
                                </span>
                              </div>
                              <div v-if="item.metricsEnabled" class="text-no-wrap">
                                <span class="filter label">{{ i18n.swapUsage }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'">
                                  <v-progress-linear id="node_swap" :value="item.swapUsedPct" height="15" :color="formatLinearColor(item.swapUsedPct, 70, 80, 90)">
                                    <template v-slot:default="{ value }">
                                      {{ item.swapUsedPct | formatDecimal1 }}% {{ i18n.of }} {{ item.swapTotalGB | formatDecimal1 }} {{ i18n.gigabytes }}
                                    </template>
                                  </v-progress-linear>
                                </span>
                              </div>
                              <div v-if="item.metricsEnabled" class="text-no-wrap">
                                <span class="filter label">{{ i18n.cpuUsage }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'">
                                  <v-progress-linear id="node_cpu" :value="item.cpuUsedPct" height="15" :color="formatLinearColor(item.cpuUsedPct, 85, 90, 95)">
                                    <template v-slot:default="{ value }">
                                      {{ item.cpuUsedPct | formatDecimal1 }}%
                                    </template>
                                  </v-progress-linear>
                                </span>
                              </div>
                              <div v-if="item.metricsEnabled" class="text-no-wrap">
                                <span class="filter label">{{ i18n.ioWait }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'">
                                  <v-progress-linear id="node_ioWait" :value="item.ioWaitPct" height="15" :color="formatLinearColor(item.ioWaitPct, 2.5, 5, 10)">
                                    <template v-slot:default="{ value }">
                                      {{ item.ioWaitPct | formatDecimal1 }}%
                                    </template>
                                  </v-progress-linear>
                                </span>
                              </div>
                              <div v-if="item.metricsEnabled && canTest(item)" class="text-no-wrap">
                                <span class="filter label">{{ i18n.captureLoss }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'">
                                  <v-progress-linear id="node_captureLoss" :value="item.captureLossPct" height="15" :color="formatLinearColor(item.captureLossPct, 0.01, 0.5, 1.5)">
                                    <template v-slot:default="{ value }">
                                      {{ item.captureLossPct | formatDecimal1 }}%
                                    </template>
                                  </v-progress-linear>
                                </span>
                              </div>
                              <div v-if="item.metricsEnabled && hasZeek(item)" class="text-no-wrap">
                                <span class="filter label">{{ i18n.zeekLoss }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'">
                                  <v-progress-linear id="node_zeekLoss" :value="item.zeekLossPct" height="15" :color="formatLinearColor(item.zeekLossPct, 0.01, 0.5, 1.5)">
                                    <template v-slot:default="{ value }">
                                      {{ item.zeekLossPct | formatDecimal1 }}%
                                    </template>
                                  </v-progress-linear>
                                </span>
                              </div>
                              <div v-if="item.metricsEnabled && hasSuri(item)" class="text-no-wrap">
                                <span class="filter label">{{ i18n.suricataLoss }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'">
                                  <v-progress-linear id="node_suricataLoss" :value="item.suriLossPct" height="15" :color="formatLinearColor(item.suriLossPct, 0.01, 0.5, 1.5)">
                                    <template v-slot:default="{ value }">
                                      {{ item.suriLossPct | formatDecimal1 }}%
                                    </template>
                                  </v-progress-linear>
                                </span>
                              </div>
                              <div v-if="item.metricsEnabled && hasSteno(item)" class="text-no-wrap">
                                <span class="filter label">{{ i18n.stenoLoss }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'">
                                  <v-progress-linear id="node_stenoLoss" :value="item.stenoLossPct" height="15" :color="formatLinearColor(item.stenoLossPct, 0.01, 0.5, 1.5)">
                                    <template v-slot:default="{ value }">
                                      {{ item.stenoLossPct | formatDecimal1 }}%
                                    </template>
                                  </v-progress-linear>
                                </span>
                              </div>
                              <div v-if="item.metricsEnabled" class="text-no-wrap">
                                <span class="filter label">{{ i18n.diskUsageRoot }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'">
                                  <v-progress-linear id="node_diskRoot" :value="item.diskUsedRootPct" height="15" :color="formatLinearColor(item.diskUsedRootPct, 85, 90, 95)">
                                    <template v-slot:default="{ value }">
                                      {{ item.diskUsedRootPct | formatDecimal1 }}% {{ i18n.of }} {{ item.diskTotalRootGB | formatDecimal1 }} {{ i18n.gigabytes }}
                                    </template>
                                  </v-progress-linear>
                                </span>
                              </div>
                              <div v-if="item.metricsEnabled" class="text-no-wrap">
                                <span class="filter label">{{ i18n.diskUsageNsm }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'">
                                  <v-progress-linear id="node_diskNsm" :value="item.diskUsedNsmPct" height="15" :color="formatLinearColor(item.diskUsedNsmPct, 85, 90, 95)">
                                    <template v-slot:default="{ value }">
                                      {{ item.diskUsedNsmPct | formatDecimal1 }}% {{ i18n.of }} {{ item.diskTotalNsmGB | formatDecimal1 }} {{ i18n.gigabytes }}
                                    </template>
                                  </v-progress-linear>
                                </span>
                              </div>
                              <div v-if="item.metricsEnabled && hasEventstore(item)" class="text-no-wrap">
                                <span class="filter label">{{ i18n.diskUsageElastic }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'" id="node_diskElastic">{{ item.diskUsedElasticGB | formatDecimal1 }} {{ i18n.gigabytes }}</span>
                              </div>
                              <div v-if="item.metricsEnabled && hasMetricstore(item)" class="text-no-wrap">
                                <span class="filter label">{{ i18n.diskUsageInfluxDb }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'" id="node_diskInflux">{{ item.diskUsedInfluxDbGB | formatDecimal1 }} {{ i18n.gigabytes }}</span>
                              </div>
                              <div v-if="item.metricsEnabled && canTest(item)" class="text-no-wrap">
                                <span class="filter label">{{ i18n.pcapRetention }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'" id="node_pcapRetention">{{ item.pcapDays | formatDecimal1 }} {{ i18n.days }}</span>
                              </div>
                              <div v-if="item.metricsEnabled" class="text-no-wrap">
                                <span class="filter label">{{ i18n.loadAverage }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'" id="node_load">{{ item.load1m | formatDecimal1 }}, {{ item.load5m | formatDecimal1 }}, {{ item.load15m | formatDecimal1 }}</span>
                              </div>
                              <div v-if="item.metricsEnabled && hasQueuestore(item)" class="text-no-wrap">
                                <span class="filter label">{{ i18n.redisQueueSize }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'" id="node_redisQueue">{{ item.redisQueueSize | formatCount }}</span>
                              </div>
                              <div v-if="item.metricsEnabled && canTest(item)" class="text-no-wrap">
                                <span class="filter label">{{ i18n.trafficMonIn }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'" id="node_trafficMonIn">{{ item.trafficMonInMbs | formatDecimal1 }} {{ i18n.mbps }}</span>
                              </div>
                              <div v-if="item.metricsEnabled && canTest(item)" class="text-no-wrap">
                                <span class="filter label">{{ i18n.trafficMonInDrops }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'" id="node_trafficMonInDrops">{{ item.trafficMonInDropsMbs | formatDecimal1 }} {{ i18n.mbps }}</span>
                              </div>
                              <div v-if="item.metricsEnabled" class="text-no-wrap">
                                <span class="filter label">{{ i18n.trafficManIn }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'" id="node_trafficManIn">{{ item.trafficManInMbs | formatDecimal1 }} {{ i18n.mbps }}</span>
                              </div>
                              <div v-if="item.metricsEnabled" class="text-no-wrap">
                                <span class="filter label">{{ i18n.trafficManOut }}:</span>
                                <span :class="areMetricsCurrent(item) ? 'filter value' : 'filter value stale'" id="node_trafficManOut">{{ item.trafficManOutMbs | formatDecimal1 }} {{ i18n.mbps }}</span>
                              </div>

                              <div class="text-no-wrap">
                                <span class="filter label">{{ i18n.keywords }}:</span>
                                <span class="filter value text-wrap" id="node_keywords">{{ item.keywords }}</span>
                              </div>
                              <div class="text-no-wrap">
                                <span class="filter label">{{ i18n.description }}:</span>
                                <span class="filter value text-wrap" id="node_desc">{{ item.description }}</span>
                              </div>
                              <p/>
                              <div class="text-justify">
                                <v-btn id="dashboard-link" icon :title="i18n.nodeDashboard" :href="item.dashboardLink" :target="$root.target('influxdb')">
                                  <v-icon>fa-chart-line</v-icon>
                                </v-btn>
                                <v-btn v-if="canTest(item)" id="test-minion" icon :title="i18n.nodeTest" @click="showTestConfirm(item.id + '_' + item.role)">
                                  <v-icon>fa-file-import</v-icon>
                                </v-btn>
                                <v-btn v-if="canUpload(item)" id="import-minion" icon :title="i18n.uploadPCAPEVTX" @click="showUploadConfirm(item)">
                                  <v-icon>fa-upload</v-icon>
                                </v-btn>
                                <v-btn id="restart-minion" icon :title="item.osNeedsRestart == 1 ? i18n.restartRequiredHelp : i18n.restartMinionHelp" @click="showRestartConfirm(item.id + '_' + item.role)">
                                  <v-icon :color="item.osNeedsRestart == 1 ? 'warning' : ''">fa-power-off</v-icon>
                                </v-btn>
                                <v-btn icon :title="i18n.clickForMoreInformation" :href="$root.parameters.docsUrl + 'grid.html'" :target="$root.target('so-help')" >
                                  <v-icon color="info">fa-circle-question</v-icon>
                                </v-btn>
                              </div>
                            </v-card-text>
                          </v-card>
                        </v-col>
                        <v-col cols="12" lg="4">
                          <v-card>
                            <v-card-title v-text="i18n.containerStatus"/>
                            <v-card-text>
                              <v-simple-table v-if="item.statusCode <= 1">
                                <template v-slot:default>
                                  <thead>
                                    <tr>
                                      <th class="text-right" v-text="i18n.container"/>
                                      <th class="text-center" v-text="i18n.hunt"/>
                                      <th class="text-left" v-text="i18n.status"/>
                                      <th class="text-left" v-text="i18n.details" class="d-none d-lg-table-cell"/>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr v-for="container in item.containers" :key="container.Name">
                                      <td class="text-right">
                                        {{ container.Name }}
                                      </td>
                                      <td class="text-center">
                                        <router-link :to="{ name: 'hunt', query: {q: `tags:&quot;${container.Name}&quot; | groupby log.level`, t: moment().subtract(1, 'hours').format(i18n.timePickerFormat) + ' - ' + moment().format(i18n.timePickerFormat) }}" :class="'text-decoration-none hunt-logs-' + container.Name">
                                          <v-icon :title="i18n.huntForError">fa-crosshairs</v-icon>
                                        </router-link>
                                      </td>
                                      <td :class="areMetricsCurrent(item) ? colorContainerStatus(container.Status) + '--text text-left' : 'stale text-left'">
                                        {{ $root.localizeMessage(container.Status) }}
                                      </td>
                                      <td :class="areMetricsCurrent(item) ? 'info--text text-left d-none d-lg-table-cell' : 'stale info-text-left text-left d-none d-lg-table-cell'">
                                        {{ container.Details }}
                                      </td>
                                    </tr>
                                  </tbody>
                                </template>
                              </v-simple-table>
                              <div v-else>
                                {{ i18n["nodeStatusCode_" + item.statusCode] }}
                              </div>
                            </v-card-text>
                          </v-card>
                        </v-col>
                        <v-col cols="12" lg="4">
                          <v-card>
                            <v-card-title v-text="i18n.nodeImages"/>
                            <v-card-text>
                              <span v-if="!item.imageFront">
                                {{ i18n.nodeImageUnavailable }}
                                <a :target="$root.target('so-help')" :href="$root.parameters.docsUrl + 'grid.html'" style="text-decoration: none; cursor: 'pointer'"  :title="i18n.clickForMoreInformation">
                                  <v-icon color="info" class="mb-2">fa-circle-question</v-icon>
                                </a>
                              </span>
                              <img class="rounded-lg elevation-5" v-if="item.imageFront" :src="'images/appliances/' + item.imageFront">
                              <img class="rounded-lg elevation-5" v-if="item.imageBack" :src="'images/appliances/' + item.imageBack">
                            </v-card-text>
                          </v-card>
                        </v-col>
                      </v-row>
                    </v-container>
                  </td>
                </tr>
              </template>
            </v-data-table>
          </v-col>
        </v-row>
        <v-dialog v-model="gridMemberTestConfirmDialog" persistent max-width="480">
          <v-card>
            <v-card-title class="text-h5" v-text="i18n.gridMemberTestConfirmTitle" />
            <v-card-text v-text="i18n.gridMemberTestConfirmHelp" />
            <v-card-actions>
              <v-spacer></v-spacer>
              <v-btn text id="grid-test-proceed-button" @click="gridMemberTest" v-text="i18n.yes" />
              <v-btn text id="grid-test-cancel-button" @click="hideTestConfirm" v-text="i18n.no" />
            </v-card-actions>
          </v-card>
        </v-dialog>
        <v-dialog v-model="gridMemberRestartConfirmDialog" persistent max-width="480">
          <v-card>
            <v-card-title class="text-h5" v-text="i18n.gridMemberRestartConfirmTitle" />
            <v-card-text v-html="i18n.gridMemberRestartConfirmHelp" />
            <v-card-actions>
              <v-spacer></v-spacer>
              <v-btn text id="grid-restart-proceed-button" @click="gridMemberRestart" v-text="i18n.yes" />
              <v-btn text id="grid-restart-cancel-button" @click="hideRestartConfirm" v-text="i18n.no" />
            </v-card-actions>
          </v-card>
        </v-dialog>
        <v-dialog v-model="gridMemberUploadConfirmDialog" persistent max-width="480">
          <v-card>
            <v-card-title class="text-h5" v-text="pickUploadDialogTitle()" />
            <v-card-text>
              <v-alert class="mt-2" type="info" icon="fa-upload" text dense>
                {{ i18n.maxUploadSize }}: {{ maxUploadSizeBytes | formatCount }} {{ i18n.bytes }}
              </v-alert>
              <v-form ref="gridUpload" v-model="uploadForm.valid" @submit.prevent>
                <v-file-input id="import-value" v-model="uploadForm.attachment" show-size :accept="pickUploadDialogAccept()" :rules="[rules.fileSizeLimit, rules.fileNotEmpty, rules.fileRequired]"/>
              </v-form>
            </v-card-text>
            <v-card-actions>
              <v-spacer></v-spacer>
              <v-btn text id="grid-upload-proceed-button" @click="gridMemberUpload" v-text="i18n.upload" />
              <v-btn text id="grid-upload-cancel-button" @click="hideUploadConfirm" v-text="i18n.cancel" />
            </v-card-actions>
          </v-card>
        </v-dialog>
      </v-container>
    </script>

    <script type="text/x-template" id="page-settings">
      <v-container v-if="showSettingsForm" fluid>
        <v-row>
          <v-col>
            <h2 v-text="i18n.settingsTitle"></h2>
          </v-col>
        </v-row>
        <v-row>
          <v-col>
            <v-tabs grow>

              <v-tab id="userSettings_generalTab">
                <v-icon left>fa-cogs</v-icon>
                {{ i18n.settings }}
              </v-tab>
              <v-tab id="userSettings_profileTab">
                <v-icon left>fa-id-card</v-icon>
                {{ i18n.profile }}
              </v-tab>
              <v-tab id="userSettings_securityTab">
                <v-icon left>fa-shield-halved</v-icon>
                {{ i18n.security }}
              </v-tab>

              <v-tab-item>
                <v-card outlined class="my-4">
                  <v-card-title>{{ i18n.defaults }}</v-card-title>
                  <v-card-text>
                    <div v-text="i18n.resetDefaultsHint"></div>
                    <p/>
                    <v-btn id="settingsResetDefaults" color="primary" :disabled="usingDefaults" v-text="i18n.resetDefaults" @click="resetDefaults"></v-btn>
                  </v-card-text>
                </v-card>
              </v-tab-item>

              <v-tab-item>
                <v-alert class="mt-2" type="warning" icon="fa-shield-halved" text dense>
                  {{ i18n.profileInstructions }}
                </v-alert>
                <v-card outlined class="my-4">
                  <v-card-title>{{ i18n.profileDetails }}</v-card-title>
                  <v-card-text>
                    <v-form v-model="profileForm.valid" method="post" :action="authSettingsUrl">
                      <v-text-field name="traits.email" v-model="profileForm.email" :placeholder="i18n.email" :rules="[rules.required, rules.minemaillen]" class="d-none"></v-text-field>
                      <v-text-field name="traits.firstName" v-model="profileForm.firstName" :placeholder="i18n.firstName" type="text":rules="[rules.maxlen]"></v-text-field>
                      <v-text-field name="traits.lastName" v-model="profileForm.lastName" :placeholder="i18n.lastName" type="text" type="text":rules="[rules.maxlen]"></v-text-field>
                      <v-text-field name="traits.note" v-model="profileForm.note" :placeholder="i18n.note" type="text" type="text":rules="[rules.maxlen]"></v-text-field>
                      <v-text-field name="csrf_token" v-model="csrfToken" class="d-none"></v-text-field>
                      <v-text-field name="method" value="profile" class="d-none"></v-text-field>
                      <v-btn id="settingsProfileChangeSubmit" type="submit" color="primary" :disabled="!profileForm.valid" v-text="i18n.save"></v-btn>
                    </v-form>
                  </v-card-text>
                </v-card>
              </v-tab-item>

              <v-tab-item>
                <v-alert class="mt-2" type="warning" icon="fa-shield-halved" text dense>
                  {{ i18n.securityInstructions }}
                </v-alert>
                <v-card v-if="oidcEnabled" outlined class="my-4">
                  <v-card-title>{{ i18n.oidc }}</v-card-title>
                  <v-card-subtitle v-text="i18n.oidcHelp"></v-card-subtitle>
                  <v-card-text v-if="passwordEnabled">
                    <div class="mb-2" v-text="i18n.oidcLinkHelp"></div>
                    <v-form method="post" :action="authSettingsUrl">
                      <v-text-field name="csrf_token" v-model="csrfToken" class="d-none"></v-text-field>
                      <div v-for="oidc in oidcProviders">
                        <v-btn v-if="oidc.op == 'link'" :name="oidc.op" :value="oidc.id" :id="'settingsOidcLink_' + oidc.id" type="submit" color="primary" v-text="i18n.oidcLink + ' ' + oidc.id"/>
                        <v-btn v-if="oidc.op == 'unlink'" :name="oidc.op" :value="oidc.id" :id="'settingsOidcUnlink_' + oidc.id" type="submit" color="primary" v-text="i18n.oidcUnlink + ' ' + oidc.id"/>
                      </div>
                    </v-form>
                  </v-card-text>
                </v-card>

                <v-card v-if="passwordEnabled" outlined class="my-4">
                  <v-card-title>{{ i18n.password }}</v-card-title>
                  <v-card-subtitle v-text="i18n.passwordInstructions"></v-card-subtitle>
                  <v-card-text>
                    <v-form v-model="passwordForm.valid" method="post" :action="authSettingsUrl">
                      <v-text-field name="password" v-model="passwordForm.password" :placeholder="i18n.passwordChange" :type="showPassword ? 'text' : 'password'" @click:append="showPassword = !showPassword" :append-icon="showPassword ? 'fa-eye-slash' : 'fa-eye'" :rules="[rules.required, rules.minpasslen, rules.maxpasslen, rules.badpasschs]"></v-text-field>
                      <v-text-field :placeholder="i18n.passwordConfirm" :type="showPassword ? 'text' : 'password'" @click:append="showPassword = !showPassword" :append-icon="showPassword ? 'fa-eye-slash' : 'fa-eye'" :rules="[rules.required, rules.maxpasslen, rules.matches, rules.badpasschs]"></v-text-field>
                      <v-text-field name="csrf_token" v-model="csrfToken" class="d-none"></v-text-field>
                      <v-text-field name="method" value="password" class="d-none"></v-text-field>
                      <v-btn id="settingsPasswordChangeSubmit" type="submit" color="primary" :disabled="!passwordForm.valid" v-text="i18n.save"></v-btn>
                    </v-form>
                  </v-card-text>
                </v-card>

                <v-card v-if="passwordEnabled && passwordSet" outlined class="my-4" v-if="totpForm.qr && totpForm.secret">
                  <v-alert type="error" border="bottom" colored-border text dense>
                    {{ i18n.securityInstructionsTotp }}
                  </v-alert>
                  <v-card-title>{{ i18n.totp }}</v-card-title>
                  <v-card-subtitle v-text="i18n.totpQrInstructions"></v-card-subtitle>
                  <v-card-text>
                    <v-form v-model="totpForm.valid" method="post" :action="authSettingsUrl">
                      <v-img id="totp-qr" class="my-4" width="320" :src="totpForm.qr"></v-img>
                      <div id="totp-secret" v-text="i18n.totpSecretInstructions"></div>
                      <div class="my-4 mx-4">
                        {{ totpForm.secret }}
                        <v-icon class="ml-1" @click="$root.copyToClipboard(totpForm.secret)" :title="i18n.copyToClipboard">fa-copy</v-icon>
                      </div>
                      <v-text-field name="totp_code" autocomplete="off" v-model="totpForm.code" :placeholder="i18n.totpCodeHelp" type="text" :rules="[rules.required, rules.mintotplen, rules.maxtotplen]"></v-text-field>
                      <v-text-field name="csrf_token" v-model="csrfToken" class="d-none"></v-text-field>
                      <v-text-field name="method" value="totp" class="d-none"></v-text-field>
                      <v-btn id="settingsTotpActivateSubmit" type="submit" color="primary" :disabled="!totpForm.valid" v-text="i18n.totpActivate"></v-btn>
                    </v-form>
                  </v-card-text>
                </v-card>

                <v-card v-if="unlink_totp_available" outlined class="my-4">
                  <v-card-title>{{ i18n.totp }}</v-card-title>
                  <v-card-text>
                    <v-form method="post" :action="authSettingsUrl">
                      <div class="mb-4" v-text="i18n.totpUnlinkInstructions"></div>
                      <v-text-field name="csrf_token" v-model="csrfToken" class="d-none"></v-text-field>
                      <v-text-field name="totp_unlink" value="true" class="d-none"></v-text-field>
                      <v-btn id="settingsTotpDeactivateSubmit" type="submit" color="primary" v-text="i18n.totpDeactivate"></v-btn>
                    </v-form>
                  </v-card-text>
                </v-card>

                <v-card v-if="webauthnForm.script" outlined class="my-4">
                  <v-card-title>{{ i18n.webauthn }}</v-card-title>
                  <v-card-subtitle v-text="i18n.webauthnInstructions"></v-card-subtitle>
                  <v-card-text>
                    <v-form v-model="webauthnForm.valid" method="post" :action="authSettingsUrl">
                      <v-text-field name="webauthn_register_displayname" autocomplete="off" v-model="webauthnForm.name" :placeholder="i18n.webauthnNameHelp" type="text" :rules="[rules.required]"></v-text-field>
                      <v-text-field name="webauthn_register" v-model="webauthnForm.key" class="d-none"></v-text-field>
                      <v-text-field name="csrf_token" v-model="csrfToken" class="d-none"></v-text-field>
                      <v-btn class="mb-4" name="webauthn_register_trigger" id="settingsWebauthnActivate" type="button" color="primary" v-text="i18n.webauthnAddKey" :disabled="!webauthnForm.valid" @click="runWebauthn()"></v-btn>
                    </v-form>
                  </v-card-text>

                  <div v-if="webauthnForm.existingKeys.length">
                    <v-card-subtitle v-text="i18n.webauthnExistingKeys"></v-card-subtitle>
                    <v-card-text>
                      <v-form v-for="key in webauthnForm.existingKeys" method="post" :action="authSettingsUrl">
                        <v-text-field name="csrf_token" v-model="csrfToken" class="d-none"></v-text-field>
                        <div :id="'settingsWebauthnExistingKey_' + key.id" class="ml-2">
                          {{ key.name }}
                          <v-btn name="webauthn_remove" icon :value="key.value" :id="'settingsWebauthnDelete_' + key.id" type="submit" color="primary" >
                            <v-icon>fa-circle-xmark</v-icon>
                          </v-btn>
                        </div>
                      </v-form>
                    </v-card-text>
                  </div>
                </v-card>

              </v-tab-item>

            <v-tabs>
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-config">
      <v-container fluid>
        <v-row>
          <v-col cols="12" lg="3">
            <h2 v-text="i18n.configTitle"></h2>
          </v-col>
          <v-col cols="12" lg="5">
            <v-expansion-panels>
              <v-expansion-panel>
                <v-expansion-panel-header id="configOptionsHeader">{{i18n.options}}</v-expansion-panel-header>
                <v-expansion-panel-content>
                  <v-switch id="option-advanced" :disabled="$root.loading" v-model="advanced" dense class="my-0" :label="i18n.settingsAdvanced" :hint="i18n.settingsAdvancedHelp" persistent-hint></v-switch>
                  <v-btn id="option-synchronize" @click.stop="sync()" class="mt-6 mb-1">
                    {{ i18n.settingsSynchronize }}
                  </v-btn>
                  <div class="text-caption" v-text="i18n.settingsSynchronizeHelp"/>
                </v-expansion-panel-content>
              </v-expansion-panel>
            </v-expansion-panels>
          </v-col>
          <v-spacer></v-spacer>
          <v-col cols="12" lg="2" align="end">
            <h4 v-if="!$root.loading">{{ i18n.settingsCustomized }} {{ settingsCustomized }} / {{ settingsAvailable }} </h4>
          </v-col>
        </v-row>
        <v-row>
        </v-row>
        <v-row>
          <v-col cols="12" lg="4">
            <v-container fluid>
              <v-row>
                <v-col>
                  <v-text-field id="filter-input" :label="i18n.filter" v-model="search" clearable :hint="i18n.filterHelp" persistent-hint @click:clear="clearFilter()" class="mb-3" />
                </v-col>
                <v-col>
                  <span class="mt-3 text-no-wrap overflow-x-hidden">
                    <v-btn id="expand-all-button" icon @click="expand()" :title="i18n.expandAll">
                      <v-icon>fa-angles-down</v-icon>
                    </v-btn>
                    <v-btn id="collapse-all-button" icon @click="collapse()" :title="i18n.collapseAll">
                      <v-icon>fa-angles-up</v-icon>
                    </v-btn>
                    <v-btn id="show-modified-button" icon @click="expand(null, isSettingModified)" :title="i18n.settingIsModifiedHelp">
                      <v-icon color="primary">fa-pencil</v-icon>
                    </v-btn>
                    <v-btn id="show-node-modified-button" icon @click="expand(null, isSettingModifiedPerNode)" :title="i18n.settingHasNodeValuesHelp">
                      <v-icon color="warning">fa-circle-nodes</v-icon>
                    </v-btn>
                  </span>
                </v-col>
              </v-row>
            </v-container>
            <v-treeview
              id="config-tree"
              :active.sync="active"
              :items="hierarchy"
              :open.sync="open"
              :search="search"
              :filter="filter"
              activatable
              color="primary"
              open-on-click
              transition
            >
              <template v-slot:label="{item}">
                <span :id="'config-item-' + item.id">{{ getSettingName(item) }}</span>
                <v-icon v-if="isSettingModified(item)" class="ml-1" color="primary" :title="i18n.settingIsModified">fa-pencil</v-icon>
                <v-icon v-if="isSettingModifiedPerNode(item)" class="ml-1" color="warning" :title="i18n.settingHasNodeValues">fa-circle-nodes</v-icon>
              </template>
            </v-treeview>
          </v-col>
          <v-divider vertical />
          <v-col cols="12" lg="8">
            <v-fade-transition mode="out-in" duration="100">
              <div v-if="!selected" id="config-quick-links">
                <v-alert v-text="i18n.settingSelect" type="info" />
                <div>
                  <p class="font-weight-bold">{{i18n.configQLGridTitle}}</p>
                  <ul>
                    <li>
                      {{i18n.configQLNTPHeader}}
                      <ul>
                        <li>
                          <router-link :to="{ name: 'config', query: {s: 'ntp.config.servers'}}">{{i18n.configQLNTP}}</router-link>
                        </li>
                      </ul>
                    </li>
                    <li>
                      {{i18n.configQLFirewallHeader}}
                      <ul>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'firewall.hostgroups.analyst'}}">{{i18n.configQLFirewallWebInterface}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'firewall.hostgroups.elastic_agent_endpoint'}}">{{i18n.configQLFirewallElastic}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'firewall.hostgroups.fleet'}}">{{i18n.configQLFirewallFleet}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'firewall.hostgroups.idh'}}">{{i18n.configQLFirewallIDH}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'firewall.hostgroups.receiver'}}">{{i18n.configQLFirewallReceiver}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'firewall.hostgroups.searchnode'}}">{{i18n.configQLFirewallSearch}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'firewall.hostgroups.sensor'}}">{{i18n.configQLFirewallSensor}}</router-link>
                        </li>
                      </ul>
                    </li>
                    <li>
                      {{i18n.configQLNIDSHeader}}
                      <ul>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'idstools.config.ruleset'}}">{{i18n.configQLNIDSRuleset}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'idstools.config.oinkcode'}}">{{i18n.configQLNIDSOinkCode}}</router-link>
                        </li>
                      </ul>
                    </li>
                  </ul>
                  <br/>
                  <p class="font-weight-bold">{{i18n.configQLAnalystTitle}}</p>
                  <ul>
                    <li>
                      {{i18n.configQLSuricataHeader}}
                      <ul>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'suricata.config.vars.address-groups.HOME_NET'}}">{{i18n.configQLHomeNet}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'suricata.config.af-packet.threads'}}">{{i18n.configQLSuricataThreads}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'idstools.sids'}}">{{i18n.configQLSIDS}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'suricata.thresholding.sids__yaml'}}">{{i18n.configQLSIDSThresholding}}</router-link>
                      </ul>
                    </li>
                    <li>
                      {{i18n.configQLZeekHeader}}
                      <ul>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'zeek.config.networks.HOME_NET'}}">{{i18n.configQLZeekHomeNet}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'zeek.config.node.lb_procs'}}">{{i18n.configQLZeekThreads}}</router-link>
                        </li>
                      </ul>
                    </li>
                    <li>
                      {{i18n.configQLBPFHeader}}
                      <ul>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'bpf.pcap'}}">{{i18n.configQLPCAP}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'bpf.suricata'}}">{{i18n.configQLSuricata}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'bpf.zeek'}}">{{i18n.configQLZeek}}</router-link>
                        </li>
                      </ul>
                    </li>
                    <li>
                      {{i18n.configQLSOCHeader}}
                      <ul>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'soc.config.actions'}}">{{i18n.configQLSOCActions}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'soc.config.server.client.alerts.queries'}}">{{i18n.configQLSOCAlerts}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'soc.config.server.client.dashboards.queries'}}">{{i18n.configQLSOCDashboards}}</router-link>
                        </li>
                        <li>
                          <router-link :to="{name: 'config', query: {s: 'soc.config.server.client.hunt.queries'}}">{{i18n.configQLSOCHunt}}</router-link>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
              <v-card v-else :key="selected.id" class="pt-6 mx-auto config-setting" flat>
                <v-card-text>
                  <div class="text-subtitle-1 mb-4">
                    {{ getSettingDescription(selected) }}
                    <a v-if="selected.helpLink" :target="$root.target('so-help')" :href="$root.parameters.docsUrl + selected.helpLink" style="text-decoration: none; cursor: 'pointer'" :title="i18n.settingHelp">
                      <v-icon color="info" class="mb-2">fa-circle-question</v-icon>
                    </a>
                  </div>
                  <div v-if="selected.readonly" :title="i18n.settingReadOnlyHelp">
                    <v-icon class="ma-2" color="warning">fa-ban</v-icon>
                    <v-subtitle v-text="i18n.settingReadOnly" />
                  </div>
                  <v-container fluid>
                    <v-row v-if="!selected.readonly && selected.defaultAvailable">
                      <v-col>
                        <v-btn id="config-toggle-default-button" @click="showDefault = !showDefault" v-text="showDefault ? i18n.settingHideDefault : i18n.settingShowDefault"/>
                        <div v-if="showDefault" class="mt-8">
                          <v-textarea v-if="isMultiline(selected)" id="default-output" :label="i18n.settingDefault" :value="selected.default" readonly class="config-editor" />
                          <v-text-field v-if="!isMultiline(selected)" id="default-output" :label="i18n.settingDefault" :value="selected.default" readonly />
                        </div>
                      </v-col>
                    </v-row>
                    <v-row v-if="selected.global || !selected.node">
                      <v-col>
                        <div v-if="!selected.readonly" class="mb-n1 text-right">
                          <v-btn id="setting-global-reset" icon @click="remove(selected)" :title="i18n.settingResetHelp" :disabled="!isSettingModified(selected) || isPendingSave(selected)" >
                            <v-icon color="primary">fa-circle-arrow-left</v-icon>
                          </v-btn>
                          <v-btn id="setting-global-save" icon @click="save(selected)" :disabled="!isPendingSave(selected)" :title="i18n.settingSaveHelp" @>
                            <v-icon color="success">fa-check</v-icon>
                          </v-btn>
                          <v-btn id="setting-global-cancel" icon @click="cancel(true)" :disabled="!isPendingSave(selected)" :title="i18n.settingCancelHelp">
                            <v-icon color="error">fa-xmark</v-icon>
                          </v-btn>
                        </div>
                        <div v-if="isMultiline(selected)">
                          <v-textarea v-if="form.key != selected.id" id="value-output" outlined :label="i18n.settingGlobal" @focus="edit(selected)" :value="selected.value" readonly :disabled="selected.readonly" class="config-editor" />
                          <v-textarea v-else id="value-input" outlined :label="i18n.settingGlobal" v-model="form.value" class="editing config-editor" />
                        </div>
                        <div v-else>
                          <v-text-field v-if="form.key != selected.id" id="value-output" outlined :label="i18n.settingGlobal" @focus="edit(selected)" :value="selected.value" readonly :disabled="selected.readonly" :type="selected.sensitive ? 'password' : 'text'" />
                          <v-text-field v-else id="value-input" outlined :label="i18n.settingGlobal" v-model="form.value" class="editing"  @keydown.enter.prevent="save(selected)" />
                        </div>
                      </v-col>
                    </v-row>
                    <v-row v-for="item in selected.nodeValues" :key="item[0]">
                      <v-col>
                        <div class="mb-n1 text-right">
                          <v-btn :id="'setting-node-reset-' + item[0]" icon @click="remove(selected, item[0])" :title="i18n.settingRemoveHelp" :disabled="isPendingSave(selected, item[0])" >
                            <v-icon color="warning">fa-circle-xmark</v-icon>
                          </v-btn>
                          <v-btn :id="'setting-node-save-' + item[0]" icon @click="save(selected, item[0])" :disabled="!isPendingSave(selected, item[0])" :title="i18n.settingSaveHelp">
                            <v-icon color="success">fa-check</v-icon>
                          </v-btn>
                          <v-btn :id="'setting-node-cancel-' + item[0]" icon @click="cancel(true)" :disabled="!isPendingSave(selected, item[0])" :title="i18n.settingCancelHelp">
                            <v-icon color="error">fa-xmark</v-icon>
                          </v-btn>
                        </div>
                        <div v-if="isMultiline(selected)">
                          <v-textarea v-if="form.key != item[0]" :id="'node-value-output-' + item[0]" outlined :label="item[0]" @focus="edit(selected, item[0])" :value="item[1]"  readonly :disabled="selected.readonly" class="config-editor" />
                          <v-textarea v-else outlined :id="'node-value-input-' + item[0]" :label="item[0]" v-model="form.value" class="editing config-editor" />
                        </div>
                        <div v-else>
                          <v-text-field v-if="form.key != item[0]" :id="'node-value-output-' + item[0]" outlined :label="item[0]" @focus="edit(selected, item[0])" :value="item[1]" readonly :disabled="selected.readonly" :type="selected.sensitive ? 'password' : 'text'" />
                          <v-text-field v-else outlined :label="item[0]" :id="'node-value-input-' + item[0]" v-model="form.value" class="editing"  @keydown.enter.prevent="save(selected, item[0])" />
                        </div>
                      </v-col>
                    </v-row>
                  </v-container>
                  <v-select v-if="(selected.node || !selected.global) && availableNodes.length > 0" outlined id="config-select-node" :label="i18n.settingSelectNode" :items="availableNodes" :title="i18n.settingSelectNodeHelp" @change="addNode(selected, $event)" v-model.sync="selectedNode" />
                </v-card-text>
              </v-card>
            </v-scroll-y-transition>
          </v-col>
        </v-row>
        <v-dialog v-model="cancelDialog" persistent max-width="290">
          <v-card>
            <v-card-title class="text-h5" v-text="i18n.settingConfirmCancel" />
            <v-card-text v-text="i18n.settingConfirmCancelHelp" />
            <v-card-actions>
              <v-spacer></v-spacer>
              <v-btn text id="config-discard-proceed-button" @click="cancel(true)" v-text="i18n.yes" />
              <v-btn text id="config-discard-cancel-button" @click="retainChanges()" v-text="i18n.no" />
            </v-card-actions>
          </v-card>
        </v-dialog>
      </v-container>
    </script>

    <script type="text/x-template" id="page-gridmembers">
      <v-container fluid>
        <v-row>
          <v-col>
            <v-container fluid>
              <v-row>
                <v-col cols="12">
                  <h2 v-text="i18n.gridMembers"></h2>
                  <v-subheader v-text="i18n.gridMembersHelp" class="my-12 my-lg-3" />
                </v-col>
              </v-row>
            </v-container>
          </v-col>
        </v-row>
        <v-row>
          <v-col cols="12" lg="6">
            <v-list flat class="mb-4" outlined>
              <v-header v-text="i18n.gridMembersPending" class="ml-2" />
              <v-list-item-group id="gridmembers-pending">
                <v-subheader v-if="unaccepted.length == 0" v-text="i18n.none" />
                <v-list-item v-for="node in unaccepted" @click="show(node)">
                  <v-list-item-icon>
                    <v-icon class="mt-1" :title="i18n.gridMembersPendingHelp">fa-circle-question</v-icon>
                  </v-list-item-icon>
                  <v-list-item-content>
                    <v-list-item-title :id="'pending-output-' + node.id">
                      {{ node.id }}
                    </v-list-item-title>
                  </v-list-item-content>
                  <v-list-item-action>
                    <v-btn :title="i18n.gridMemberShow" class="review" :id="'review-pending-button-' + node.id">
                      {{ i18n.review }}
                      <v-icon right>fa-binoculars</v-icon>
                    </v-btn>
                  </v-list-item-action>
                </v-list-item>
              </v-list-item-group>
            </v-list>

            <v-list flat class="mb-4" outlined>
              <v-header v-text="i18n.gridMembersDenied" class="ml-2" />
              <v-list-item-group id="gridmembers-denied">
                <v-subheader v-if="denied.length == 0" v-text="i18n.none" />
                <v-list-item v-for="node in denied" @click="show(node)">
                  <v-list-item-icon>
                    <v-icon color="warning" class="mt-1" :title="i18n.gridMembersDeniedHelp">fa-circle-minus</v-icon>
                  </v-list-item-icon>
                  <v-list-item-content>
                    <v-list-item-title :id="'denied-output-' + node.id">
                      {{ node.id }}
                    </v-list-item-title>
                  </v-list-item-content>
                  <v-list-item-action>
                    <v-btn :title="i18n.gridMemberShow" class="review" :id="'review-denied-button-' + node.id">
                      {{ i18n.review }}
                      <v-icon right>fa-binoculars</v-icon>
                    </v-btn>
                  </v-list-item-action>
                </v-list-item>
              </v-list-item-group>
            </v-list>

            <v-list flat class="mb-4" outlined>
              <v-header v-text="i18n.gridMembersRejected" class="ml-2" />
              <v-list-item-group id="gridmembers-rejected">
                <v-subheader v-if="rejected.length == 0" v-text="i18n.none" />
                <v-list-item v-for="node in rejected" @click="show(node)">
                  <v-list-item-icon>
                    <v-icon color="error" class="mt-1" :title="i18n.gridMembersRejectedHelp">fa-circle-xmark</v-icon>
                  </v-list-item-icon>
                  <v-list-item-content>
                    <v-list-item-title :id="'rejected-output-' + node.id">
                      {{ node.id }}
                    </v-list-item-title>
                  </v-list-item-content>
                  <v-list-item-action>
                    <v-btn :title="i18n.gridMemberShow" class="review" :id="'review-rejected-button-' + node.id">
                      {{ i18n.review }}
                      <v-icon right>fa-binoculars</v-icon>
                    </v-btn>
                  </v-list-item-action>
                </v-list-item>
              </v-list-item-group>
            </v-list>

          </v-col>
          <v-col cols="12" lg="6">
            <v-list flat outlined>
              <v-header v-text="i18n.gridMembersAccepted" class="ml-2" />
              <v-list-item-group id="gridmembers-accepted">
                <v-subheader v-if="accepted.length == 0" v-text="i18n.none" />
                <v-list-item v-for="node in accepted" @click="show(node)">
                  <v-list-item-icon>
                    <v-icon color="green" class="mt-1" :title="i18n.gridMembersAcceptedHelp">fa-circle-check</v-icon>
                  </v-list-item-icon>
                  <v-list-item-content>
                    <v-list-item-title :id="'accepted-output-' + node.id">
                      {{ node.id }}
                    </v-list-item-title>
                  </v-list-item-content>
                  <v-list-item-action>
                    <v-btn :title="i18n.gridMemberShow" class="review" :id="'review-accepted-button-' + node.id">
                      {{ i18n.review }}
                      <v-icon right>fa-binoculars</v-icon>
                    </v-btn>
                  </v-list-item-action>
                </v-list-item>
              </v-list-item-group>
            </v-list>
          </v-col>
        </v-row>
        <v-dialog v-model="dialog" max-width="600">
          <v-card v-if="selected">
            <v-card-title class="headline" v-text="i18n.gridMemberReviewTitle"></v-card-title>
            <v-card-subtitle v-text="selected.id" />
            <v-container fluid>
              <v-row class="my-0">
                <v-col cols="4" class="pa-0">
                  <v-card-text class="font-weight-bold">
                    {{ i18n.name }}:
                  </v-card-text>
                </v-col>
                <v-col cols="8" class="pa-0">
                  <v-card-text>
                    {{ selected.name }}
                  </v-card-text>
                </v-col>
              </v-row>
              <v-row class="my-0">
                <v-col cols="4" class="pa-0">
                  <v-card-text class="font-weight-bold">
                    {{ i18n.role }}:
                  </v-card-text>
                </v-col>
                <v-col cols="8" class="pa-0">
                  <v-card-text>
                    {{ selected.role }}
                  </v-card-text>
                </v-col>
              </v-row>
              <v-row class="my-0">
                <v-col cols="4" class="pa-0">
                  <v-card-text class="font-weight-bold">
                    {{ i18n.fingerprint }}:
                  </v-card-text>
                </v-col>
                <v-col cols="8" class="pa-0">
                  <v-card-text>
                    {{ selected.fingerprint }}
                    <v-icon id="fingerprintCopyValue" class="mx-1" color="white" dense @click.stop="$root.copyToClipboard(selected.fingerprint)" :title="i18n.copyToClipboard">
                      fa-copy
                    </v-icon>
                  </v-card-text>
                </v-col>
              </v-row>
              <v-row class="my-0">
                <v-col cols="4" class="pa-0">
                  <v-card-text class="font-weight-bold">
                    {{ i18n.status }}:
                  </v-card-text>
                </v-col>
                <v-col cols="8" class="pa-0">
                  <v-card-text>
                    <v-chip :color="selected.status | colorNodeStatus" v-text="i18n[selected.status]" />
                  </v-card-text>
                </v-col>
              </v-row>
              <v-row v-if="isUnaccepted(selected)">
                <v-col>
                  <v-banner v-text="18n.acceptingMinionsTakesTime"/>
                </v-col>
              </v-row>
            </v-container>
            <v-card-actions>
              <v-spacer></v-spacer>
              <v-btn id="gridmember-cancel"  @click.stop="hide()" v-text="i18n.cancel"></v-btn>
              <v-btn id="gridmember-accept"  @click.stop="accept(selected)" v-if="isUnaccepted(selected)">
                {{ i18n.accept }}
                <v-icon right>fa-check</v-icon>
              </v-btn>
              <v-btn id="gridmember-reject" @click.stop="reject(selected)" v-if="isUnaccepted(selected)">
                {{ i18n.reject }}
                <v-icon right>fa-xmark</v-icon>
              </v-btn>
              <v-btn id="gridmember-remove"  @click.stop="confirmRemove()">
                {{ i18n.delete }}
                <v-icon right>fa-circle-xmark</v-icon>
              </v-btn>
            </v-card-actions>
          </v-card>
        </v-dialog>
        <v-dialog v-model="confirmDeleteDialog" persistent max-width="575">
          <v-card>
            <v-card-title class="text-h5" v-text="i18n.gridMemberConfirmDelete" />
            <v-card-text v-html="i18n.gridMemberConfirmDeleteHelp" />
            <v-card-actions>
              <v-spacer></v-spacer>
              <v-btn text id="gridmember-confirm-delete-button" @click="remove(selected)" v-text="i18n.yes" />
              <v-btn text id="gridmember-confirm-cancel-button" @click="cancelRemove()" v-text="i18n.no" />
            </v-card-actions>
          </v-card>
        </v-dialog>
      </v-container>
    </script>

    <script src="js/external/jquery-3.7.1.min.js"></script>
    <script src="js/external/vue-2.7.15.min.js"></script>
    <script src="js/external/vue-router-3.6.5.min.js"></script>
    <script src="js/external/vuetify-v2.7.1.min.js"></script>
    <script src="js/external/axios-1.6.2.min.js"></script>
    <script src="js/external/moment-2.29.4.min.js"></script>
    <script src="js/external/moment-timezone-with-data-0.5.43.min.js"></script>
    <script src="js/external/chart-3.9.1.min.js"></script>
    <script src="js/external/vue-chartjs-3.5.1.min.js"></script>
    <script src="js/external/daterangepicker-3.14.1.min.js"></script>
    <script src="js/external/marked-11.1.0.min.js"></script>
    <script src="js/external/purify-3.0.6.min.js"></script>
    <script src="js/external/chartjs-chart-sankey-0.12.0.min.js"></script>
    <script src="js/external/chartjs-adapter-moment-1.0.0.min.js"></script>
    <script src="js/external/js-yaml.min.js"></script>

    <script src="js/i18n.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/app.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/case.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/config.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/downloads.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/home.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/hunt.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/jobs.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/job.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/settings.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/grid.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/gridmembers.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/terms.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/users.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/detection.js?v=VERSION_PLACEHOLDER"></script>
    <!-- <script src="js/routes/playbook.js?v=VERSION_PLACEHOLDER"></script> -->
    <script src="js/custom.js?v=VERSION_PLACEHOLDER"></script>
  </body>
</html>
