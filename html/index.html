<!doctype html>
<!--
  Copyright 2019 Jason Ertel (jertel). All rights reserved.

  This program is distributed under the terms of version 2 of the
  GNU General Public License.  See LICENSE for further details.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
-->

<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="mask-icon" href="images/favicon/onion.svg?v=VERSION_PLACEHOLDER">
    <link rel="alternate icon" class="so-favicon" type="image/png" href="images/favicon/onion.png?v=VERSION_PLACEHOLDER">
    <link rel="icon" class="so-favicon" type="image/svg+xml" href="images/favicon/onion.svg?v=VERSION_PLACEHOLDER">
    <link rel="stylesheet" href="css/external/vuetify-v2.3.10.min.css">
    <link rel="stylesheet" href="css/external/all-5.14.0.min.css">
    <link rel="stylesheet" href="css/external/daterangepicker-3.14.1.css">
    <link rel="stylesheet" href="css/app.css?v=VERSION_PLACEHOLDER">
    <title>Security Onion</title>
  </head>
  <body style="background-color: #242424;">
    <v-app id="app" style="display:none" :key="timestamp">
      <v-navigation-drawer v-model="toolbar" width="200" clipped overflow app>
        <v-list dense>
          <v-list-item @click="" to="/">
            <v-list-item-action>
              <v-icon>fa-home</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.home"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item @click="" to="/hunt">
            <v-list-item-action>
              <v-icon>fa-crosshairs</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.hunt"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item @click="" to="/jobs">
            <v-list-item-action>
              <v-icon>fa-stream</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.jobs"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item @click="" to="/sensors">
            <v-list-item-action>
              <v-icon>fa-ethernet</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.sensors"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item @click="" to="/downloads">
            <v-list-item-action>
              <v-icon>fa-download</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.downloads"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-group :value="false" prepend-icon="fa-shield-alt">
            <template v-slot:activator>
              <v-list-item-title v-text="i18n.admin"></v-list-item-title>
            </template>
            <v-list-item @click="" to="/users">
              <v-list-item-icon>
                <v-icon>fa-users</v-icon>
              </v-list-item-icon>
              <v-list-item-title v-text="i18n.users"></v-list-item-title>
            </v-list-item>
          </v-list-item-group>
        </v-list>
        <v-divider></v-divider>
        <v-list subheader dense id="external-tools-list">
          <v-subheader>Tools</v-subheader>
          <v-list-item target="so-kibana" href="/kibana/">
            <v-list-item-action>
              <v-icon>fa-external-link-alt</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.launch_kibana"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item target="so-grafana" href="/grafana/d/so_overview">
            <v-list-item-action>
              <v-icon>fa-external-link-alt</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.launch_grafana"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item target="so-cyberchef" href="/cyberchef/">
            <v-list-item-action>
              <v-icon>fa-external-link-alt</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.launch_cyberchef"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item target="so-playbook" href="/playbook/projects/detection-playbooks/issues/">
            <v-list-item-action>
              <v-icon>fa-external-link-alt</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.launch_playbook"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item target="so-fleet" href="/fleet/">
            <v-list-item-action>
              <v-icon>fa-external-link-alt</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.launch_fleet"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item target="so-thehive" href="/thehive/">
            <v-list-item-action>
              <v-icon>fa-external-link-alt</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.launch_thehive"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
          <v-list-item target="so-navigator" href="/navigator/">
            <v-list-item-action>
              <v-icon>fa-external-link-alt</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title v-text="i18n.launch_navigator"></v-list-item-title>
            </v-list-item-content>
          </v-list-item>
        </v-list>
      </v-navigation-drawer>
      <v-app-bar clipped-left app >
        <v-app-bar-nav-icon @click.stop="toolbar = !toolbar">
          <v-icon>fa-bars</v-icon>
        </v-app-bar-nav-icon>
        <v-toolbar-title>
          <router-link id="title" to="/">
            <img class="pt-1" :title="i18n.product" :alt="i18n.product" height="45" src="images/so-logo.svg"></v-img>
          </router-link>
        </v-toolbar-title>
        <v-spacer></v-spacer>
        <v-menu bottom left offset-y="true">
          <template v-slot:activator="{ on }">
            <v-btn icon v-on="on">
              <v-icon>fa-user</v-icon>
            </v-btn>
          </template>
          <v-list id="top-menu">
            <v-list-item @click.stop="toggleTheme">
              <v-list-item-action>
                <v-icon>fa-adjust</v-icon>
              </v-list-item-action>
              <v-list-item-content>
                <v-list-item-title v-text="i18n.darkMode"></v-list-item-title>
              </v-list-item-content>
            </v-list-item>
            <v-list-item target="so-help" href="https://docs.securityonion.net/en/2.1/">
              <v-list-item-action>
                <v-icon>fa-question</v-icon>
              </v-list-item-action>
              <v-list-item-content>
                <v-list-item-title v-text="i18n.help"></v-list-item-title>
              </v-list-item-content>
            </v-list-item>
            <v-list-item target="so-blog" href="https://blog.securityonion.net/">
              <v-list-item-action>
                <v-icon>fa-info</v-icon>
              </v-list-item-action>
              <v-list-item-content>
                <v-list-item-title v-text="i18n.blog"></v-list-item-title>
              </v-list-item-content>
            </v-list-item>
            <v-divider></v-divider>
            <v-list-item :href="settingsUrl">
              <v-list-item-action>
                <v-icon>fa-user-edit</v-icon>
              </v-list-item-action>
              <v-list-item-content>
                <v-list-item-title v-text="i18n.settings"></v-list-item-title>
              </v-list-item-content>
            </v-list-item>
            <v-list-item :href="authUrl + 'logout'">
              <v-list-item-action>
                <v-icon>fa-sign-out-alt</v-icon>
              </v-list-item-action>
              <v-list-item-content>
                <v-list-item-title v-text="i18n.logout"></v-list-item-title>
              </v-list-item-content>
            </v-list-item>
          </v-list>
        </v-menu>
      </v-app-bar>
      <v-main>
        <v-progress-linear v-if="loading" height="10" :active="loading" indeterminate></v-progress-linear>
        <v-alert dismissible type="error" icon="fa-exclamation-triangle" v-model="error" transition="scale-transition" v-text="errorMessage"></v-alert>
        <v-alert dismissible type="warning" icon="fa-exclamation" v-model="warning" transition="scale-transition" v-text="warningMessage"></v-alert>
        <v-alert dismissible type="info" icon="fa-info" v-model="info" transition="scale-transition" v-text="infoMessage"></v-alert>
        <router-view></router-view>
      </v-main>
      <v-footer app>
        <span id="version" class="overline text-no-wrap">
          {{ i18n.version }}: {{ version }}
        </span>
        <v-spacer></v-spacer>
        <span class="overline text-no-wrap">
          &copy; {{ new Date().getFullYear() }} 
          <a class="footer" target="sos" href="https://securityonionsolutions.com/">
            Security Onion Solutions, LLC
          </a>
        </span>
        <v-spacer></v-spacer>
        <span class="overline text-no-wrap">
          <router-link id="termsLink" to="/terms" class="footer">{{ i18n.terms }}</router-link>
        </span>
      </v-footer>
    </v-app>

    <script type="text/x-template" id="page-home">
      <v-container fluid>
        <v-row>
          <v-col>
            <h2 v-text="i18n.home"></h2>
          </v-col>
        </v-row>
        <v-row>
          <v-col class="mx-auto px-12" id="change-details">
            <div  class="title" v-html="changeDetails.title"></div>
            <ul>
              <li v-for="change in changeDetails.changes" :key="change.summary" v-html="change.summary"></li>
            </ul>
          </v-col>
          <v-col class="mx-auto text-center">
            <div v-html="i18n.sponsorsIntro"></div>
            <a target="sos" href="https://securityonionsolutions.com/">
              <img v-if="!$vuetify.theme.dark" height="200" src="images/sos-logo.svg">
              <img v-if="$vuetify.theme.dark" height="200" src="images/sos-logo-white.svg">
            </a>
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-hunt">
      <v-container fluid>
        <v-row>
          <v-col cols="9">
            <h2 v-text="i18n.hunt"></h2>
          </v-col>
          <v-col cols="3" align="end">
            <h4 v-if="loaded">{{ i18n.eventTotal }} {{ totalEvents.toLocaleString() }}</h4>
            <p>
            <h5>{{ i18n.timezone }} {{ zone }}</h5>
          </v-col>
        </v-row>
        <v-row align="start">
          <v-col cols="12" md="7">
            <v-textarea clearable auto-grow :disabled="loading()" @change="notifyInputsChanged" class="mx-2" v-model="query" :hint="i18n.queryHelp" rows="1" persistent-hint="true" 
              autofocus="true" prepend-icon="fa-search" @keydown.enter.prevent="hunt" id="hunt-query-input">
              <template v-slot:prepend-inner>
                <v-menu dense bottom three-line offset-y="true">
                  <template v-slot:activator="{ on: menu }">
                    <v-tooltip bottom>
                      <template v-slot:activator="{ on: tooltip }">
                        <v-btn icon small v-on="{ ...tooltip, ...menu }" id="hunt-query-dropdown-button">
                          <v-icon>fa-angle-down</v-icon>
                        </v-btn>
                      </template>
                      <span>{{ i18n.queriesHelp }}</span>
                    </v-tooltip>
                  </template>
                  <v-list dense class="overflow-y-auto" style="max-height: 600px" id="hunt-query-dropdown-list">
                    <v-list-item v-for="query in mruQueries">
                      <v-list-item-content @click="huntQuery(query)" :style="{ cursor: 'pointer'}">
                        <v-list-item-title v-text="query"></v-list-item-title>
                        <v-list-item-subtitle>
                          <span class="text-primary">{{ i18n.mruQuery }} &mdash;</span>
                          {{ i18n.mruQueryHelp }}
                        </v-list-item-subtitle>
                      </v-list-item-content>
                    </v-list-item>
                    <v-divider></v-divider>
                    <v-list-item v-for="query in queries">
                      <v-list-item-content @click="huntQuery(query.query)" :style="{ cursor: 'pointer'}">
                        <v-list-item-title v-text="query.query"></v-list-item-title>
                        <v-list-item-subtitle>
                          <span v-if="query.name.length > 0" class="text-primary">{{ query.name }} &mdash;</span>
                          {{ query.description }}
                        </v-list-item-subtitle>
                      </v-list-item-content>
                    </v-list-item>
                  </v-list>
                </v-menu>
              </template>
            </v-textarea>
          </v-col>
          <v-col cols="12" md="5" class="d-flex flex-nowrap align-center">
            <v-text-field :disabled="loading()" v-if="relativeTimeEnabled" id="huntrelativetimevalue" @change="notifyInputsChanged" class="mx-2" 
                v-model="relativeTimeValue" :hint="i18n.relativeTimeHelp" persistent-hint="true" type="number">
              <template v-slot:prepend>
                <b-btn v-if="relativeTimeEnabled" icon x-small @click="showAbsoluteTime" id="show-absolute-time">
                  <v-icon>fa-history</v-icon>
                </b-btn>
                <div v-if="relativeTimeEnabled" class="pt-1 px-4">
                  {{ i18n.last }}
                </div>
              </template>
              <template v-slot:append-outer>
                <v-select class="my-n1 py-0" :disabled="loading()" v-if="relativeTimeEnabled" id="huntrelativetimeunit" @change="notifyInputsChanged"
                  v-model="relativeTimeUnit" :items="relativeTimeUnits"></v-select>
              </template>
            </v-text-field>
            <v-text-field :disabled="loading()" v-if="!relativeTimeEnabled" id="huntdaterange" @change="notifyInputsChanged" class="mx-2" 
              v-model="dateRange" :hint="i18n.timePickerHelp" persistent-hint="true" 
              prepend-inner-icon="fa-angle-down" @click:prepend-inner="showDateRangePicker">
              <template v-slot:prepend>
                <b-btn v-if="!relativeTimeEnabled" icon x-small @click="showRelativeTime" id="show-relative-time">
                  <v-icon>fa-calendar-alt</v-icon>
                </b-btn>
              </template>
            </v-text-field>
            <v-btn id="hunt" :disabled="loading()" color="primary" @click.stop="hunt">
              <span class="d-sm-none d-lg-inline">{{ i18n.hunt }}&nbsp;</span>
              <v-icon>fa-crosshairs</v-icon>
            </v-btn>
          </v-col>
        </v-row>
        <v-row v-if="loaded && !metricsEnabled">
          <v-col cols="12">
            <line-chart :height="chartHeight" :chartdata="timelineChartData" :options="timelineChartOptions"/>
          </v-col>
        </v-row>
        <v-row v-if="metricsEnabled">
          <v-col cols="12" md="4">
            <bar-chart id="topChart" :height="chartHeight" :chartdata="topChartData" :options="topChartOptions"/>
          </v-col>
          <v-col cols="12" md="4">
            <line-chart id="timelineChart" :height="chartHeight" :chartdata="timelineChartData" :options="timelineChartOptions"/>
          </v-col>
          <v-col cols="12" md="4">
            <bar-chart id="bottomChart":height="chartHeight" :chartdata="bottomChartData" :options="bottomChartOptions"/>
          </v-col>
        </v-row>
        <v-row v-if="metricsEnabled">
          <v-col cols="12">
            <v-data-table :search="groupByFilter" dense :sort-by.sync="groupBySortBy" :sort-desc.sync="groupBySortDesc" :footer-props="groupByFooters" 
              :items-per-page.sync="groupByItemsPerPage" must-sort :headers="groupByHeaders" :items="groupByData" :page.sync="groupByPage">
              <template v-slot:top>
                <v-container fluid>
                  <v-row>
                    <v-col cols="4">
                      <h3>{{ i18n.groups }}</h3>
                    </v-col>
                    <v-col cols="2">
                      <v-select :disabled="loading()" @change="notifyInputsChanged" v-model="groupByLimit" :items="groupByLimitOptions" :label="i18n.fetchLimit"></v-text-field>
                    </v-col>
                    <v-col cols="6">
                      <v-text-field v-model="groupByFilter" clearable prepend-icon="fa-filter" :label="i18n.filterResults" single-line hide-details></v-text-field>
                    </v-col>
                  </v-row>
                </v-container>        
              </template>
              <template v-slot:item="{ item }">
                <tr>
                  <td>
                    {{ item.count.toLocaleString() }}
                  </td>
                  <td v-for="field in groupByHeaders.slice(1)">
                    <div class="quick-action-trigger d-inline-block" v-text="item[field.value]" @click="toggleQuickAction(event, item, field.value, item[field.value])"></div>
                  </td>
                </tr>
              </template>

            </v-data-table>
          </v-col>
        </v-row>
        <v-row v-if="loaded">
          <v-col cols="12">
            <v-data-table :search="eventFilter" :sort-by.sync="sortBy" item-key="soc_id" :expanded.sync="expanded" :sort-desc.sync="sortDesc" :footer-props="footerProps" 
              :items-per-page.sync="itemsPerPage" must-sort :headers="eventHeaders" :items="eventData" show-expand :page.sync="eventPage">
              <template v-slot:top>
                <v-container fluid>
                  <v-row>
                    <v-col cols="4">
                      <h3>{{ i18n.events }}</h3>
                    </v-col>
                    <v-col cols="2">
                      <v-select :disabled="loading()" @change="notifyInputsChanged" v-model="eventLimit" :items="eventLimitOptions" :label="i18n.fetchLimit"></v-text-field>
                    </v-col>
                    <v-col cols="6">
                      <v-text-field v-model="eventFilter" clearable prepend-icon="fa-filter" :label="i18n.filterResults" single-line hide-details></v-text-field>
                    </v-col>
                  </v-row>
                </v-container>
              </template>        
              <template v-slot:item="{ item }">
                <tr>
                  <td>
                    <v-btn icon small @click="expand(item)">
                      <v-icon v-if="isExpanded(item)" :alt="i18n.eventExpand" :title="i18n.eventExpandHelp">fa-angle-down</v-icon>
                      <v-icon v-if="!isExpanded(item)" :alt="i18n.eventExpand" :title="i18n.eventExpandHelp">fa-angle-right</v-icon>
                    </v-btn>
                  </td>
                  <td v-for="field in eventHeaders">
                    <div class="quick-action-trigger d-inline-block" v-text="item[field.value]" @click="toggleQuickAction(event, item, field.value, item[field.value])"></div>
                  </td>
                </tr>
              </template>
              <template v-slot:expanded-item="{ headers, item }">
                <td :colspan="headers.length" class="py-2">
                  <v-data-table dense disable-pagination hide-default-header hide-default-footer must-sort :headers="expandedHeaders" :items="getExpandedData()">
                    <template v-slot:item="{ item }">
                      <tr>
                        <td class="expansion">
                          <div class="d-inline-block semi-transparent">
                            <v-btn :disabled="!canQuery(item.key)" icon x-small :to="buildGroupByRoute(item.key)">
                              <v-icon :alt="i18n.groupInclude" :title="i18n.groupIncludeHelp">fa-layer-group</v-icon>
                            </v-btn>
                          </div>
                          <div class="d-inline-block expansion" v-text="item.key"></div>
                        </td>
                        <td class="expansion">
                          <div class="quick-action-trigger d-inline-block expansion hardwrap" v-text="item.value" @click="toggleQuickAction(event, expanded[0], item.key, item.value)"></div>
                        </td>
                      </tr>
                    </template>
                  </v-data-table>
                </td>
              </template>
            </v-data-table>
            <v-card id="hunt-quick-action" class="quick-action" color="secondary">
              <v-card-actions>
                <v-list-item dense>
                  <v-row align="center" justify="middle">
                    <v-btn depressed tile small color="secondary" :to="filterRouteInclude" :title="i18n.filterIncludeHelp">
                      <v-icon :alt="i18n.filterInclude">fa-search-plus</v-icon>
                    </v-btn>
                    <v-btn depressed tile small color="secondary" :to="filterRouteExclude" :title="i18n.filterExcludeHelp">
                      <v-icon :alt="i18n.filterExclude">fa-search-minus</v-icon>
                    </v-btn>
                    <v-btn depressed tile small color="secondary" :to="filterRouteExact" :title="i18n.filterExactHelp">
                      <v-icon :alt="i18n.filterExact">fa-search</v-icon>
                    </v-btn>
                    <v-btn class="custom-quick-action-button" v-for="action in actions" depressed tile small color="secondary" v-if="action.enabled" :href="action.linkFormatted" :title="$root.localizeMessage(action.description)">
                      <v-icon v-if="action.icon" :class="{ 'v-icon--left': action.name }">{{ action.icon }}</v-icon>
                      {{ $root.localizeMessage(action.name) }}
                    </v-btn>
                  </v-row>
                </v-list-item>
              </v-card-actions>
            </v-card>            
          </v-col>
        </v-row>
        <v-row v-if="loaded">
          <v-col cols="6">
            <v-subheader inset>{{ i18n.eventFetchTook }} {{ fetchTimeSecs }} {{ i18n.seconds }}. {{ i18n.eventRoundTripTook }} {{ roundTripTimeSecs }} {{ i18n.seconds }}.</v-subheader>
          </v-col>
          <v-spacer></v-spacer>
          <v-col>
            <v-switch id="auto-hunt" :disabled="loading()" v-model="autohunt" dense :label="i18n.autohunt" persistent-hint="true" :hint="i18n.autohuntHint"></v-switch>
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-terms">
      <v-container fluid>
        <v-row>
          <v-col>
            <h2 v-text="i18n.terms"></h2>
            {{ i18n.licenseInfo }} (<a id="licenseLink" target="new" href="https://raw.githubusercontent.com/security-onion-solutions/securityonion-soc/master/LICENSE">GPLv2)</a>
          </v-col>
        </v-row>
        <v-row>
          <v-col v-html="i18n.termDetails">
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-downloads">
      <v-container fluid>
        <v-row>
          <v-col>
            <h2 v-text="i18n.downloads"></h2>
          </v-col>
        </v-row>
        <v-alert type="info" v-html="i18n.downloadsFirewallTip"></v-alert>
        <v-row>
          <v-col>
            <h3 v-text="i18n.downloadsLoggers" id="download-loggers"></h3>
            <ul>
              <li><a href="https://artifacts.elastic.co/downloads/beats/winlogbeat/winlogbeat-oss-7.8.1-windows-x86_64.msi" download="winlogbeat-oss-7.8.1-windows-x86_64.msi">Winlogbeat</a></li>
            </ul>
            <p></p>
            <h3 v-text="i18n.downloadsOsqueryPackages" id="osquery-packages"></h3>
            <ul>
              <li><a href="/packages/launcher.msi" download="msi-launcher.msi">MSI (Windows)</a></li>
              <li><a href="/packages/launcher.deb" download="deb-launcher.deb">DEB (Debian)</a></li>
              <li><a href="/packages/launcher.rpm" download="rpm-launcher.rpm">RPM (RPM)</a></li>
              <li><a href="/packages/launcher.pkg" download="pkg-launcher.pkg">PKG (MacOS)</a></li>
              <li><a href="/packages/launcher.flags" download="launcher.flags.txt">RPM & DEB Config Flag File</a></li>
              <li><a href="/packages/launcher-msi.flags" download="launcher-msi.flags.txt">MSI Config Flag File</a></li>
            </ul>
            <p></p>
            <div v-html="i18n.downloadsInfo"></div>
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-user">
      <v-container fluid>
        <v-row>
          <v-col>
            <h2 v-text="i18n.user"></h2>
          </v-col>
        </v-row>
        <v-row>
          <v-col>
              <v-card>
                <v-form v-model="form.valid">
                  <v-container grid-list-sm class="pa-4">
                    <v-row>
                      <v-col xs12>
                        <v-text-field v-model="form.email" :placeholder="i18n.email" autofocus="true" :rules="[rules.required]"></v-text-field>
                        <v-text-field v-model="form.firstName" :placeholder="i18n.firstName"></v-text-field>
                        <v-text-field v-model="form.lastName" :placeholder="i18n.lastName"></v-text-field>
                      </v-col>
                    </v-row>
                  </v-container>
                  <v-card-actions>
                    <v-spacer></v-spacer>
                    <v-btn :disabled="!form.valid" text color="primary" @click="updateUser" v-text="i18n.update"></v-btn>
                  </v-card-actions>
                </v-form>
              </v-card>
            </v-dialog>
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-users">
      <v-container fluid>
        <v-row>
          <v-col>
            <h2 v-text="i18n.users"></h2>
          </v-col>
        </v-row>
        <v-row>
          <v-col>
            <v-toolbar class="elevation-0" class="d-none">
              <v-btn class="action" color="blue" @click.stop="dialog = !dialog">
                <v-icon>fa-plus</v-icon>
              </v-btn>
            </v-toolbar>
            <v-dialog v-model="deleteUserDialog" persistent max-width="390">
              <v-card>
                <v-card-title class="headline" v-text="i18n.deleteUserTitle"></v-card-title>
                <v-card-text v-text="i18n.deleteUserConfirm"></v-card-text>
                <v-card-text v-text="deleteUserEmail"></v-card-text>
                <v-card-text v-text="i18n.continue"></v-card-text>
                <v-card-actions>
                  <v-spacer></v-spacer>
                  <v-btn text @click.stop="hideDeleteConfirm()" v-text="i18n.cancel"></v-btn>
                  <v-btn color="warning" text @click.stop="removeUser(deleteUserId)" v-text="i18n.delete"></v-btn>
                </v-card-actions>
              </v-card>
            </v-dialog>
            <v-data-table :sort-by.sync="sortBy" :sort-desc.sync="sortDesc" :footer-props="footerProps" 
              :items-per-page.sync="itemsPerPage" must-sort :headers="headers" :items="users">
              <template v-slot:item="props">
                <tr>
                  <td v-text="props.item.email"></td>
                  <td v-text="props.item.firstName"></td>
                  <td v-text="props.item.lastName"></td>
                  <td>
                    <v-icon v-if="props.item.status != 'locked'" v-title="i18n.loginEnabled">fa-check</v-icon>
                    <v-icon v-if="props.item.status == 'locked'" v-title="i18n.loginDisabled">fa-lock</v-icon>
                  </td>
                  <td>
                    <router-link :to="{ name: 'user', params: {id: props.item.id}}" :style="{ cursor: 'pointer'}">
                      <v-icon class="mr-2 d-none" v-title="i18n.edit">fa-edit</v-icon>
                    </router-link>
                    <v-icon class="mr-2 d-none" v-title="i18n.delete" @click.stop="showDeleteConfirm(props.item)">fa-times-circle</v-icon>
                  </td>
                </tr>
              </template>
            </v-data-table>
            <v-dialog v-model="dialog" width="800px">
              <v-card>
                <v-card-title class="lighten-4 py-4 title" v-text="i18n.addUser"></v-card-title>
                <v-form v-model="form.valid">
                  <v-container grid-list-sm class="pa-4">
                    <v-row>
                      <v-col xs12>
                        <v-text-field v-model="form.email" :placeholder="i18n.email" autofocus="true" :rules="[rules.required]"></v-text-field>
                        <v-text-field v-model="form.password" :placeholder="i18n.password" :type="showPassword ? 'text' : 'password'" 
                          @click:append="showPassword = !showPassword" :append-icon="showPassword ? 'fa-eye-slash' : 'fa-eye'" 
                          :rules="[rules.required]"></v-text-field>
                        <v-text-field v-model="form.firstName" :placeholder="i18n.firstName"></v-text-field>
                        <v-text-field v-model="form.lastName" :placeholder="i18n.lastName"></v-text-field>
                        <v-text-field name="csrf_token" v-model="form.csrfToken" class="d-none"></v-text-field>
                      </v-col>
                    </v-row>
                  </v-container>
                  <v-card-actions>
                    <v-spacer></v-spacer>
                    <v-btn text @click="dialog = false">Cancel</v-btn>
                    <v-btn :disabled="!form.valid" text color="primary" @click="submitAddUser" v-text="i18n.addUser"></v-btn>
                  </v-card-actions>
                </v-form>
              </v-card>
            </v-dialog>
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-jobs">
      <v-container fluid>
        <v-row>
          <v-col>
            <h2 v-text="i18n.jobs"></h2>
          </v-col>
        </v-row>
        <v-row>
          <v-col>
            <v-toolbar class="elevation-0" fixed>
              <v-btn color="primary" @click.stop="dialog = !dialog" id="add-pcap-job-button">
                <v-icon>fa-plus</v-icon>
              </v-btn>
            </v-toolbar>
            <v-data-table :sort-by.sync="sortBy" :sort-desc.sync="sortDesc" :footer-props="footerProps" :items-per-page.sync="itemsPerPage" 
              must-sort :headers="headers" :items="jobs">
              <template v-slot:item="props">
                <tr>
                  <td>
                    <router-link :to="{ name: 'job', params: {jobId: props.item.id}}" :style="{ cursor: 'pointer'}">
                      {{ props.item.id }}
                    </router-link>
                  </td>
                  <td>{{ props.item.createTime | formatDateTime }}</td>
                  <td>{{ props.item | formatJobUpdateTime | formatDateTime }}</td>
                  <td v-text="props.item.sensorId"></td>
                  <td><v-chip :color="props.item | colorJobStatus">{{ props.item | formatJobStatus }}</v-chip></td>
                  <td>
                    <router-link :to="{ name: 'job', params: {jobId: props.item.id}}" :style="{ cursor: 'pointer'}">
                      <v-icon class="mr-2" v-title="i18n.edit">fa-binoculars</v-icon>
                    </router-link>
                    <v-icon class="mr-2" v-title="i18n.delete" @click.stop="deleteJob(props.item)">fa-times-circle</v-icon>
                  </td>
                </tr>
              </template>
            </v-data-table>
            <v-dialog v-model="dialog" width="800px">
              <v-card id="pcap-job-dialog">
                <v-card-title class="lighten-4 py-4 title" v-text="i18n.addJob"></v-card-title>
                <v-form v-model="form.valid">
                  <v-container grid-list-sm class="pa-4">
                    <v-row>
                      <v-col xs12>
                        <v-text-field v-model="form.sensorId" :placeholder="i18n.sensorId" :hint="i18n.sensorIdHelp"></v-text-field>
                        <v-text-field v-model="form.srcIp" :placeholder="i18n.srcIp" :hint="i18n.srcIpHelp"></v-text-field>
                        <v-text-field v-model="form.srcPort" :placeholder="i18n.srcPort" :hint="i18n.srcPortHelp"></v-text-field>
                        <v-text-field v-model="form.dstIp" :placeholder="i18n.dstIp" :hint="i18n.dstIpHelp"></v-text-field>
                        <v-text-field v-model="form.dstPort" :placeholder="i18n.dstPort" :hint="i18n.dstPortHelp"></v-text-field>
                        <v-text-field v-model="form.beginTime" :placeholder="i18n.beginTime" :hint="i18n.beginTimeHelp"></v-text-field>
                        <v-text-field v-model="form.endTime" :placeholder="i18n.endTime" :hint="i18n.endTimeHelp"></v-text-field>
                      </v-col>
                    </v-row>
                  </v-container>
                  <v-card-actions>
                    <v-spacer></v-spacer>
                    <v-btn text @click="dialog = false">Cancel</v-btn>
                    <v-btn :disabled="!form.valid" text color="primary" @click="submitAddJob" v-text="i18n.addJob"></v-btn>
                  </v-card-actions>
                </v-form>
              </v-card>
            </v-dialog>
          </v-col>
        </v-row>
      </v-container>
    </script>


    <script type="text/x-template" id="page-job">
      <v-container fluid>
        <v-row>
          <v-col>
            <h2>{{ i18n.viewJob }}</h2>
          </v-col>
        </v-row>
        <v-row>
          <v-col>
            <v-expansion-panels>
              <v-expansion-panel>
                <v-expansion-panel-header>
                  <v-chip disabled>
                    <v-avatar>
                      <v-icon>fa-hashtag</v-icon>
                    </v-avatar>
                    <span id="jobDetailsId">{{ job.id }}</span>
                  </v-chip>
                  <v-chip disabled>
                    <v-avatar>
                      <v-icon>fa-ethernet</v-icon>
                    </v-avatar>
                    <span id="jobDetailsSensorId">{{ job.sensorId }}</span>
                  </v-chip>
                  <v-chip disabled v-if="job.filter">
                    <v-avatar>
                      <v-icon>fa-file-export</v-icon>
                    </v-avatar>
                    <span id="jobDetailsSrc">{{ job.filter.srcIp }}:{{ job.filter.srcPort }}</span>
                  </v-chip>
                  <v-chip disabled v-if="job.filter">
                    <v-avatar>
                      <v-icon>fa-file-import</v-icon>
                    </v-avatar>
                    <span id="jobDetailsDst">{{ job.filter.dstIp }}:{{ job.filter.dstPort }}</span>
                  </v-chip>
                </v-expansion-panel-header>
                <v-expansion-panel-content>
                  <v-container fluid grid-list-sm class="pa-4">
                    <v-row>
                      <v-col>
                        <div><span class="filter label">{{ i18n.dateQueued }}:</span> <span v-if="job.filter" class="filter value">{{ job.createTime | formatDateTime}}</span></div>
                        <div><span class="filter label">{{ i18n.dateCompleted }}:</span> <span v-if="job.filter" class="filter value">{{ job.completeTime | formatDateTime}}</span></div>
                        <div><span class="filter label">{{ i18n.beginTime }}:</span> <span v-if="job.filter" class="filter value">{{ job.filter.beginTime | formatTimestamp }}</span></div>
                        <div><span class="filter label">{{ i18n.endTime }}:</span> <span v-if="job.filter" class="filter value">{{ job.filter.endTime | formatTimestamp }}</span></div>
                      </v-col>
                    </v-row>
                  </v-container>
                </v-expansion-panel-content>
              </v-expansion-panel>
            </v-expansion-panels>
          </v-col>
        </v-row>
        <v-row v-if="job.status == 0" row>
          <v-col>
            <v-alert :value="true" color="info" icon="fa-info">
              {{ i18n.jobInProgress }}
            </v-alert>
          </v-col>
        </v-row>
        <v-row v-if="job.status == 1">
          <v-col>
            <v-toolbar fixed class="elevation-0">
              <v-text-field v-model="search" clearable prepend-icon="fa-filter" :label="i18n.filterResults" single-line hide-details></v-text-field>
              <v-spacer></v-spacer>
              <v-btn-toggle v-model="packetOptions" class="transparent" multiple>
                <v-btn value="packets" icon :title="i18n.packetStreamHelp" text @click="captureLayoutAsStream()">
                  <v-icon>fa-list</v-icon>
                </v-btn>
                <v-btn value="hex" :title="i18n.hexHelp" text>
                  {{ i18n.hex }}
                </v-btn>
                <v-btn value="unwrap" :title="i18n.unwrapHelp" text @click="toggleWrap">
                  <v-icon>fa-envelope-open-text</v-icon>
                </v-btn>
              </v-btn-toggle>
              <v-spacer></v-spacer>
              <v-btn icon @click="expandPackets(false)" :title="i18n.collapseHelp" text>
                <v-icon>fa-window-minimize</v-icon>
              </v-btn>
              <v-btn icon @click="expandPackets(true)" :title="i18n.expandHelp" text>
                <v-icon>fa-window-maximize</v-icon>
              </v-btn>
              <v-spacer></v-spacer>
              <v-btn text icon :href="downloadUrl()" download :title="i18n.downloadPackets">
                <v-icon>fa-download</v-icon>
              </v-btn>
            </v-toolbar>
            <v-data-table ref="packetTable" :sort-by.sync="sortBy" :sort-desc.sync="sortDesc" :items-per-page.sync="itemsPerPage" 
              :search="search" :footer-props="footerProps" must-sort :headers="headers" :hide-default-header="!isOptionEnabled('packets')" 
              :items="packets" item-key="number" :loading="packetsLoading" :expanded="expanded">
              <template v-slot:item="props">
                <tr @click="expandRow(props.item)" v-if="isOptionEnabled('packets')">
                  <td v-text="props.item.number"></td>
                  <td>{{ props.item.timestamp | formatTimestamp }}</td>
                  <td><v-chip :color="props.item.type | colorType">{{ props.item.type }}</v-chip></td>
                  <td>{{ props.item.srcIp }}</td>
                  <td>{{ props.item.srcPort }}</td>
                  <td>{{ props.item.dstIp }}</td>
                  <td>{{ props.item.dstPort }}</td>
                  <td><v-chip v-for="flag in props.item.flags" :color="flag | colorFlag" :key="flag">{{ flag }}</v-chip></td>
                  <td>{{ props.item.length }}</td>
                </tr>
              </template>
              <template v-slot:expanded-item="props">
                <tr v-if="isOptionEnabled('packets') || props.item.payloadOffset > 0">
                  <td :colspan="getPacketColumnSpan()" :class="getPacketClass(props.item)">
                    <pre class="hardwrap">{{ props.item | formatPacketView }}</pre>
                  </td>
                </tr>
              </template>
              <template v-slot:no-results>
                <v-alert :value="true" color="info" icon="fa-info">
                  {{ i18n.noSearchResults }}
                </v-alert>
              </template>
            </v-data-table>
            <div class="text-xs-center pt-2">
                <v-btn v-text="i18n.loadMore" @click="loadPackets()"></v-btn>
            </div>
          </v-col>
        </v-row>
        <v-row v-if="job.status == 2">
          <v-col>
            <v-alert :value="true" color="info" icon="fa-exclamation-triangle">
              {{ i18n.jobIncomplete }}
              <hr>
              {{ job.failTime | formatDateTime }}
              <br>
              {{ i18n.attempt }} {{ job.failCount }}: {{ job.failure }}
            </v-alert>
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-sensors">
      <v-container fluid>
        <v-row>
          <v-col>
            <h2 v-text="i18n.sensors"></h2>
          </v-col>
        </v-row>
        <v-row>
          <v-col>
            <v-data-table :sort-by.sync="sortBy" :sort-desc.sync="sortDesc" :footer-props="footerProps" 
              :items-per-page.sync="itemsPerPage" must-sort :headers="headers" :items="sensors">
              <template v-slot:item="props">
                <tr>
                  <td v-text="props.item.id"></td>
                  <td v-text="props.item.description"></td>
                  <td v-text="props.item.version"></td>
                  <td>{{ props.item.onlineTime | formatDateTime }}</td>
                  <td>{{ props.item.updateTime | formatDateTime }}</td>
                  <td>{{ props.item.epochTime | formatDateTime }}</td>
                  <td>{{ props.item.uptimeSeconds | formatDuration }}</td>
                </tr>
              </template>
            </v-data-table>
          </v-col>
        </v-row>
      </v-container>
    </script>

    <script type="text/x-template" id="page-settings">
        <v-form v-model="form.valid" method="post" :action="authSettingsUrl">
          <v-container v-if="showSettingsForm" fluid>
            <v-row>
              <v-col>
                <h2 v-text="i18n.settingsTitle"></h2>
              </v-col>
            </v-row>
            <v-row>
              <v-col>
                <div v-text="i18n.settingsInstructions"></div>
              </v-col>
            </v-row>
            <v-row>
              <v-col>
                <v-text-field name="password" v-model="form.password" :placeholder="i18n.passwordChange" :type="showPassword ? 'text' : 'password'" @click:append="showPassword = !showPassword" :append-icon="showPassword ? 'fa-eye-slash' : 'fa-eye'" :rules="[rules.required]"></v-text-field>
                <v-text-field :placeholder="i18n.passwordConfirm" :type="showPassword ? 'text' : 'password'" @click:append="showPassword = !showPassword" :append-icon="showPassword ? 'fa-eye-slash' : 'fa-eye'" :rules="[rules.required, rules.matches]"></v-text-field>
                <v-text-field name="csrf_token" v-model="form.csrfToken" class="d-none"></v-text-field>
              </v-col>
            </v-row>
            <v-row>
              <v-col>
                <v-btn type="submit" :disabled="!form.valid" text color="primary" v-text="i18n.save"></v-btn>
              </v-col>
            </v-row>
          </v-container>
        </v-form>
      </v-card>
    </script>

    <script src="js/external/jquery-3.5.1.min.js"></script>
    <script src="js/external/vue-2.6.11.min.js"></script>
    <script src="js/external/vue-router-3.4.3.min.js"></script>
    <script src="js/external/vuetify-v2.3.10.min.js"></script>
    <script src="js/external/axios-0.20.0.min.js"></script>
    <script src="js/external/moment-2.27.0.min.js"></script>
    <script src="js/external/moment-timezone-data-0.5.31.min.js"></script>
    <script src="js/external/chart-2.9.3.min.js"></script>
    <script src="js/external/vue-chartjs-2.7.1.min.js"></script>
    <script src="js/external/daterangepicker-3.14.1.min.js"></script>

    <script src="js/i18n.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/app.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/downloads.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/home.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/hunt.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/jobs.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/job.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/settings.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/sensors.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/terms.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/user.js?v=VERSION_PLACEHOLDER"></script>
    <script src="js/routes/users.js?v=VERSION_PLACEHOLDER"></script>
  </body>
</html>
